import{u as h,r as n,b4 as m,j as u,F as w,O as x}from"./index.e5e6c754.js";import{i as g}from"./use-immer.module.1d9a0526.js";import{u as v}from"./dataSource.f9c7deae.js";import{D as b,a as D}from"./datasource-context.3a818b3a.js";import{W as k}from"./workbenchContext.a6b76e3b.js";import"./index.esm.0df65c6e.js";import"./index.esm.e5edd667.js";function C(e,t){switch(t.type){case"fetched":return t.data;case"selected":return e;case"added":return[...e,t.data];case"changed":return e.map(s=>s.id===t.data.id?t.data:s);case"deleted":return e.filter(s=>s.id!==t.data.id);default:return e}}function O(){const e=h(),{onRefreshMenu:t}=n.exports.useContext(k),[s,l]=n.exports.useReducer(C,[]),[i,c]=n.exports.useState(),{id:a}=m(),[p,o]=g("detail"),{data:d}=v();n.exports.useEffect(()=>{if(a==="create"){i||e("/workbench/data-source/new",{replace:!0});return}if(a==="new"){c(void 0);return}o("detail")},[a]),n.exports.useEffect(()=>{a!=="create"&&a!=="new"&&(o("detail"),c(d==null?void 0:d.find(r=>r.id===Number(a))))},[d,a]);const f=(r,S,T)=>{location.pathname==="/workbench/data-source/create"?e("/workbench/data-source/new",{replace:!0}):o(r)};return u(w,{children:u(b.Provider,{value:l,children:u(D.Provider,{value:{showType:p,content:i,handleToggleDesigner:f,handleSave:r=>{t("dataSource"),c(r),o("detail"),e(`/workbench/data-source/${r.id}`,{replace:!0})},handleCreate:r=>{o("form"),c(r),e("/workbench/data-source/create",{replace:!0})}},children:u(x,{})})})})}export{O as default};
