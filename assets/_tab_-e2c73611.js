import{K as S,ag as i,u as I,X as P,r as n,ae as z,k as d,j as e,Q as u,ad as E,W as v}from"./index-9fa09868.js";import{l as H}from"./index-f6f30c68.js";import{i as U}from"./use-immer.module-126f60ca.js";import{G as A}from"./globalContext-7caf8a84.js";import{s as t}from"./subs.module-31980379.js";import{P as D}from"./index-e0c3ec96.js";import{T as R}from"./index-84d0df5b.js";import{M as q}from"./index-4a5fa0b5.js";import{T as M}from"./Table-23fbe6a6.js";import{S as B}from"./index-5582acbe.js";import"./index-6fcd784d.js";import"./index-887ab9bc.js";import"./LeftOutlined-f809c2a3.js";import"./PurePanel-01aebed2.js";import"./index-1966150e.js";import"./index-4508bc2d.js";import"./PlusOutlined-660936ea.js";import"./addEventListener-4a755e8a.js";import"./useShowArrow-88bb58bf.js";import"./DownOutlined-136b8b7b.js";import"./index-be2e8f95.js";import"./conductUtil-8dfc9f5d.js";import"./index-5c1119f6.js";import"./index-467ee2e0.js";import"./useBreakpoint-c018f912.js";import"./useForceUpdate-32a9eab8.js";import"./index-b625c514.js";import"./index-01d2493c.js";H.config({paths:{vs:"./modules/monaco-editor/min/vs"}});function ge(){const s=S(),[m]=i.useForm(),y=I(),{tab:b}=P(),[o,c]=n.useState(),[f,j]=U([]),[p,g]=n.useState(),{data:r,mutate:k}=z("/globalOperation/authenticationHookOptions",d.get);n.useEffect(()=>{d.get("/role").then(a=>{j(a)})},[p]);const C=async a=>{await d[o!=null&&o.isCreate?"post":"put"]("/role",{...a}),c(void 0),g(!p)},N=async a=>{await d.delete(`/role/${a}`),g(!p)},x=[{title:s.formatMessage({id:"ViVQNi",defaultMessage:[{type:0,value:"角色"}]}),dataIndex:"code",key:"code"},{title:s.formatMessage({id:"k+zCG7",defaultMessage:[{type:0,value:"角色描述"}]}),dataIndex:"remark",key:"remark"},{title:s.formatMessage({id:"R2D5Dv",defaultMessage:[{type:0,value:"创建时间"}]}),dataIndex:"createTime",key:"createTime"},{title:s.formatMessage({id:"UtE0dS",defaultMessage:[{type:0,value:"操作"}]}),key:4,render:(a,l)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer mr-1 pl-0 text-[#1677ff]",onClick:()=>{m.setFieldsValue(l),c(l)},children:e.jsx(u,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})}),e.jsx(D,{title:s.formatMessage({id:"nS8PfW",defaultMessage:[{type:0,value:"确定要删除?"}]}),okText:s.formatMessage({id:"r0/TUu",defaultMessage:[{type:0,value:"确定"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),onConfirm:()=>{N(l.code)},children:e.jsx("span",{className:"ml-4 cursor-pointer pl-0 text-[#1677ff]",children:e.jsx(u,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})})})]})}],{vscode:h}=n.useContext(A),[T,w]=n.useState("role");return e.jsx("div",{className:"bg-[#fbfbfc] h-full p-3",children:e.jsxs("div",{className:"relative h-full flex "+t.roleContainer,children:[T==="role"?e.jsx("div",{className:"top-2px right-0 absolute",children:e.jsx(E,{className:"h-7.5 py-0 px-4",onClick:()=>{m.setFieldsValue({code:"",remark:""}),c({isCreate:!0})},children:e.jsx("span",{className:"text-sm text-gray",children:e.jsx(u,{id:"UH1kCc",defaultMessage:[{type:0,value:"添加"}]})})})}):"",e.jsx(R,{className:"h-full w-full",renderTabBar:(a,l)=>e.jsx(l,{className:t.pillTab,...a}),onChange:w,activeKey:b,onTabClick:a=>{y(`/workbench/auth/role/${a}`)},items:[{label:s.formatMessage({id:"/F5ua7",defaultMessage:[{type:0,value:"角色管理"}]}),key:"role",children:e.jsxs("div",{className:t.tabContent,children:[o&&e.jsx(q,{open:!0,mask:!1,title:o?s.formatMessage({id:"H4GEbT",defaultMessage:[{type:0,value:"编辑角色"}]}):s.formatMessage({id:"THkRPD",defaultMessage:[{type:0,value:"添加角色"}]}),style:{top:"200px"},width:549,transitionName:"",onOk:()=>m.submit(),onCancel:()=>c(void 0),okText:s.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]}),okButtonProps:{className:t["save-btn"]},okType:"text",cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),children:e.jsxs(i,{name:"roleList",form:m,labelCol:{span:6},wrapperCol:{span:16},onFinish:a=>{C({...a})},autoComplete:"off",labelAlign:"left",className:"h-30 mt-8 ml-8",children:[e.jsx(i.Item,{label:s.formatMessage({id:"z1UqSC",defaultMessage:[{type:0,value:"角色code"}]}),name:"code",rules:[{required:!0,message:s.formatMessage({id:"53xMJk",defaultMessage:[{type:0,value:"请输入角色编码"}]})},{pattern:/^[_a-zA-Z][_a-zA-Z\d]*$/g,message:s.formatMessage({id:"C/vpUV",defaultMessage:[{type:0,value:"请输入数字、字母或下划线，第一位不能是数字"}]})}],children:e.jsx(v,{disabled:!(o!=null&&o.isCreate)})}),e.jsx(i.Item,{label:s.formatMessage({id:"k+zCG7",defaultMessage:[{type:0,value:"角色描述"}]}),name:"remark",children:e.jsx(v,{})}),e.jsx(i.Item,{name:"createTime"})]})}),e.jsx("div",{className:t["role-container-table"],children:f.length>0?e.jsx(M,{columns:x,dataSource:f,rowKey:"code",pagination:!1}):e.jsx(M,{columns:x,dataSource:[],rowKey:"code",rowClassName:(a,l)=>l%2===1?t["role-table"]:"",pagination:!1})})]})},{label:s.formatMessage({id:"ho6kY0",defaultMessage:[{type:0,value:"身份鉴权"}]}),key:"auth",children:e.jsx("div",{className:t.tabContent,children:e.jsx("div",{className:t.table,children:Object.keys(r??{}).map(a=>{var l;return e.jsxs("div",{className:t.row,children:[e.jsx("div",{className:t.name,children:a}),e.jsx(B,{checked:(l=r==null?void 0:r[a])==null?void 0:l.enabled,onChange:async F=>{await h.checkHookExist(r[a].path)&&(await d.put("/globalOperation",{apiAuthenticationHooks:{[a]:F}}),k())}}),e.jsx("div",{className:t.btn,onClick:()=>h.show(r[a].path),children:e.jsx(u,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})]},a)})})})}]})]})})}export{ge as default};
