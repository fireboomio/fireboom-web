import{r as l,K as Ee,C as Ie,p as Ne,j as r,a2 as Xe,Q as k,am as Qe,an as Ze,V as le,aB as et,R as G,W as L,ag as h,u as Re,l as xe,aE as tt,ao as me,ad as ce,k as ve,X as rt,N as nt,M as st}from"./index-85bb8031.js";import{u as at}from"./auth-8ea2ddcf.js";import{c as Te}from"./index-9649d007.js";import{i as it}from"./use-immer.module-b1dfddaf.js";import{E as Ve}from"./50x-df372b66.js";import{u as Le,g as Z}from"./variable-144a75bf.js";import{D as I}from"./index-58d80883.js";import{T as ae}from"./index-2a4f03a6.js";import{C as ee}from"./CopyOutlined-c11c973b.js";import{l as ot}from"./index-555b5ba4.js";import{m as lt}from"./utils-9b986f1e.js";import{M as ct}from"./index-a66fc756.js";import{U as ut}from"./index-bb5f3389.js";import{u as dt}from"./validate-904668ce.js";import{V as N}from"./common-7ac8785d.js";import{u as ft}from"./lock-4aa57fab.js";import{u as pt,I as mt}from"./index-8375a6c3.js";import{s as B}from"./subs.module-31980379.js";import{S as we}from"./index-03f339ac.js";import{S as $}from"./index-66168e0d.js";import"./workbenchContext-7962b30b.js";import"./index-1f66e1b5.js";import"./addEventListener-23b0fde6.js";import"./LeftOutlined-7ceb1db4.js";import"./useBreakpoint-7ea99bcb.js";import"./useForceUpdate-1e12d035.js";import"./PurePanel-25c62dc8.js";import"./index-79ebc17f.js";import"./index-f4dd4804.js";import"./useShowArrow-54ebbb87.js";import"./index-b3ff9150.js";import"./DownOutlined-844f57b8.js";l.createContext([]);l.createContext({});l.createContext({});const Ue=l.createContext({});l.createContext({});l.createContext({});const gt="_descriptions_1v9jj_1",ht={descriptions:gt};function jt({content:e}){var m,b,x,T,U;const t=Ee(),{globalSetting:s}=l.useContext(Ie),{getConfigurationValue:n}=Le(),[a,i]=it(!1),[u,p]=l.useState({}),c=()=>{i(!a)},d=w=>{Te(w),le.success(t.formatMessage({id:"J9jPRL",defaultMessage:[{type:0,value:"复制成功"}]}))};return l.useEffect(()=>{if(e.issuer){const w=n(e.issuer);w&&Ne(`${w}/.well-known/openid-configuration`).then(q=>{p(q)})}},[e.issuer,n]),e?r.jsx(r.Fragment,{children:r.jsxs("div",{className:Xe("mt-8",ht.descriptions),children:[r.jsxs(I,{bordered:!0,column:1,size:"small",children:[r.jsx(I.Item,{label:t.formatMessage({id:"YJo5EG",defaultMessage:[{type:0,value:"供应商ID"}]}),children:e.name}),r.jsxs(I.Item,{label:t.formatMessage({id:"uDcCXN",defaultMessage:[{type:0,value:"Issuer"}]}),children:[Z(e.issuer),r.jsx(ee,{className:"cursor-pointer ml-4",onClick:()=>{d(`${n(e.issuer)}`)}})]}),r.jsxs(I.Item,{label:t.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"服务发现地址"}]}),children:[`${Z(e.issuer)}/.well-known/openid-configuration`,r.jsx(ee,{className:"cursor-pointer ml-4",onClick:()=>{d(`${n(e.issuer)}/.well-known/openid-configuration`)}})]}),u.userinfo_endpoint&&r.jsxs(I.Item,{label:t.formatMessage({id:"75UFec",defaultMessage:[{type:0,value:"用户端点(自动解析)"}]}),children:[u.userinfo_endpoint,r.jsx(ee,{className:"cursor-pointer ml-4",onClick:()=>{d(u.userinfo_endpoint)}})]})]}),r.jsxs(I,{bordered:!0,column:1,size:"small",className:"mt-3",children:[r.jsxs(I.Item,{label:t.formatMessage({id:"VtOp3i",defaultMessage:[{type:0,value:"基于cookie"}]}),children:[e.oidcConfigEnabled?r.jsx(ae,{color:"success",children:r.jsx(k,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):r.jsx(ae,{color:"default",className:"text-[#999]",children:r.jsx(k,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})}),r.jsx("span",{className:"text-[#aaa] ml-1",children:r.jsx(k,{id:"BFO9oi",defaultMessage:[{type:0,value:"授权码模式"}]})})]}),r.jsx(I.Item,{label:t.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),children:Z((m=e.oidcConfig)==null?void 0:m.clientId)}),r.jsx(I.Item,{label:t.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),children:r.jsx("span",{className:"flex items-center",children:a?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:Z((b=e.oidcConfig)==null?void 0:b.clientSecret)}),r.jsx(Qe,{className:"ml-4",onClick:c})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"***********"}),r.jsx(Ze,{className:"ml-4",onClick:c})]})})}),r.jsx(I.Item,{label:t.formatMessage({id:"qGbL3R",defaultMessage:[{type:0,value:"登录回调地址"}]}),children:r.jsxs("div",{className:"flex items-center",children:[n(s.nodeOptions.publicNodeUrl),"/auth/cookie/callback/",e.name,r.jsx(ee,{className:"cursor-pointer ml-4",onClick:()=>{d(`${n(s.nodeOptions.publicNodeUrl)}/auth/cookie/callback/${e.name}`)}})]})})]}),r.jsxs(I,{bordered:!0,column:1,size:"small",className:"mt-3",children:[r.jsxs(I.Item,{label:t.formatMessage({id:"qr+6Ba",defaultMessage:[{type:0,value:"基于token"}]}),children:[e.jwksProviderEnabled?r.jsx(ae,{color:"success",children:r.jsx(k,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):r.jsx(ae,{color:"default",className:"text-[#999]",children:r.jsx(k,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})}),r.jsx("span",{className:"text-[#aaa] ml-1",children:r.jsx(k,{id:"P3/nym",defaultMessage:[{type:0,value:"隐式模式"}]})})]}),r.jsx(I.Item,{label:t.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),children:(x=e.jwksProvider)!=null&&x.jwksJson?"JSON":"URL"}),(T=e.jwksProvider)!=null&&T.jwksJson?r.jsx(I.Item,{label:t.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),children:r.jsx("pre",{className:"overflow-x-auto",children:Z((U=e.jwksProvider)==null?void 0:U.jwksJson)})}):r.jsxs(I.Item,{label:t.formatMessage({id:"xxNCEl",defaultMessage:[{type:0,value:"jwksURL(自动解析)"}]}),children:[u.jwks_uri,r.jsx(ee,{className:"cursor-pointer ml-4",onClick:()=>{d(u.jwks_uri)}})]})]})]})}):r.jsx(Ve,{})}function vt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Me(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),s.push.apply(s,n)}return s}function ke(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Me(Object(s),!0).forEach(function(n){vt(e,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Me(Object(s)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(s,n))})}return e}function bt(e,t){if(e==null)return{};var s={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(s[a]=e[a]);return s}function yt(e,t){if(e==null)return{};var s=bt(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function xt(e,t){return wt(e)||Mt(e,t)||kt(e,t)||Ot()}function wt(e){if(Array.isArray(e))return e}function Mt(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var s=[],n=!0,a=!1,i=void 0;try{for(var u=e[Symbol.iterator](),p;!(n=(p=u.next()).done)&&(s.push(p.value),!(t&&s.length===t));n=!0);}catch(c){a=!0,i=c}finally{try{!n&&u.return!=null&&u.return()}finally{if(a)throw i}}return s}}function kt(e,t){if(e){if(typeof e=="string")return Oe(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Oe(e,t)}}function Oe(e,t){(t==null||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function Ot(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ct(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function Ce(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),s.push.apply(s,n)}return s}function Se(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?Ce(Object(s),!0).forEach(function(n){Ct(e,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ce(Object(s)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(s,n))})}return e}function St(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(n){return t.reduceRight(function(a,i){return i(a)},n)}}function te(e){return function t(){for(var s=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,p=new Array(u),c=0;c<u;c++)p[c]=arguments[c];return t.apply(s,[].concat(a,p))}}}function ue(e){return{}.toString.call(e).includes("Object")}function Pt(e){return!Object.keys(e).length}function ne(e){return typeof e=="function"}function Et(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function It(e,t){return ue(t)||J("changeType"),Object.keys(t).some(function(s){return!Et(e,s)})&&J("changeField"),t}function Nt(e){ne(e)||J("selectorType")}function Rt(e){ne(e)||ue(e)||J("handlerType"),ue(e)&&Object.values(e).some(function(t){return!ne(t)})&&J("handlersType")}function Tt(e){e||J("initialIsRequired"),ue(e)||J("initialType"),Pt(e)&&J("initialContent")}function Vt(e,t){throw new Error(e[t]||e.default)}var Lt={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},J=te(Vt)(Lt),ie={changes:It,selector:Nt,handler:Rt,initial:Tt};function Ut(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ie.initial(e),ie.handler(t);var s={current:e},n=te($t)(s,t),a=te(Dt)(s),i=te(ie.changes)(e),u=te(At)(s);function p(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(m){return m};return ie.selector(d),d(s.current)}function c(d){St(n,a,i,u)(d)}return[p,c]}function At(e,t){return ne(t)?t(e.current):t}function Dt(e,t){return e.current=Se(Se({},e.current),t),t}function $t(e,t,s){return ne(t)?t(e.current):Object.keys(s).forEach(function(n){var a;return(a=t[n])===null||a===void 0?void 0:a.call(t,e.current[n])}),s}var Jt={create:Ut},qt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function Ft(e){return function t(){for(var s=this,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,p=new Array(u),c=0;c<u;c++)p[c]=arguments[c];return t.apply(s,[].concat(a,p))}}}function Wt(e){return{}.toString.call(e).includes("Object")}function zt(e){return e||Pe("configIsRequired"),Wt(e)||Pe("configType"),e.urls?(_t(),{paths:{vs:e.urls.monacoBase}}):e}function _t(){console.warn(Ae.deprecation)}function Bt(e,t){throw new Error(e[t]||e.default)}var Ae={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Pe=Ft(Bt)(Ae),Gt={config:zt},Kt=function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return function(a){return s.reduceRight(function(i,u){return u(i)},a)}};function De(e,t){return Object.keys(t).forEach(function(s){t[s]instanceof Object&&e[s]&&Object.assign(t[s],De(e[s],t[s]))}),ke(ke({},e),t)}var Ht={type:"cancelation",msg:"operation is manually canceled"};function ge(e){var t=!1,s=new Promise(function(n,a){e.then(function(i){return t?a(Ht):n(i)}),e.catch(a)});return s.cancel=function(){return t=!0},s}var Yt=Jt.create({config:qt,isInitialized:!1,resolve:null,reject:null,monaco:null}),$e=xt(Yt,2),se=$e[0],fe=$e[1];function Xt(e){var t=Gt.config(e),s=t.monaco,n=yt(t,["monaco"]);fe(function(a){return{config:De(a.config,n),monaco:s}})}function Qt(){var e=se(function(t){var s=t.monaco,n=t.isInitialized,a=t.resolve;return{monaco:s,isInitialized:n,resolve:a}});if(!e.isInitialized){if(fe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ge(he);if(window.monaco&&window.monaco.editor)return Je(window.monaco),e.resolve(window.monaco),ge(he);Kt(Zt,tr)(rr)}return ge(he)}function Zt(e){return document.body.appendChild(e)}function er(e){var t=document.createElement("script");return e&&(t.src=e),t}function tr(e){var t=se(function(n){var a=n.config,i=n.reject;return{config:a,reject:i}}),s=er("".concat(t.config.paths.vs,"/loader.js"));return s.onload=function(){return e()},s.onerror=t.reject,s}function rr(){var e=se(function(s){var n=s.config,a=s.resolve,i=s.reject;return{config:n,resolve:a,reject:i}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(s){Je(s),e.resolve(s)},function(s){e.reject(s)})}function Je(e){se().monaco||fe({monaco:e})}function nr(){return se(function(e){var t=e.monaco;return t})}var he=new Promise(function(e,t){return fe({resolve:e,reject:t})}),qe={config:Xt,init:Qt,__getMonacoInstance:nr},Fe={exports:{}},sr="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ar=sr,ir=ar;function We(){}function ze(){}ze.resetWarningCache=We;var or=function(){function e(n,a,i,u,p,c){if(c!==ir){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}e.isRequired=e;function t(){return e}var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:ze,resetWarningCache:We};return s.PropTypes=s,s};Fe.exports=or();var lr=Fe.exports;const o=et(lr);function be(){return be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},be.apply(this,arguments)}const cr={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function ur(e){let{content:t}=e;return G.createElement("div",{style:cr},t)}const je={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function _e(e){let{width:t,height:s,isEditorReady:n,loading:a,_ref:i,className:u,wrapperProps:p}=e;return G.createElement("section",be({style:{...je.wrapper,width:t,height:s}},p),!n&&G.createElement(ur,{content:a}),G.createElement("div",{ref:i,style:{...je.fullWidth,...!n&&je.hide},className:u}))}_e.propTypes={width:o.oneOfType([o.number,o.string]).isRequired,height:o.oneOfType([o.number,o.string]).isRequired,loading:o.oneOfType([o.element,o.string]).isRequired,isEditorReady:o.bool.isRequired,className:o.string,wrapperProps:o.object};var Be=l.memo(_e);function Ge(e){l.useEffect(e,[])}function R(e,t){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const n=l.useRef(!0);l.useEffect(n.current||!s?()=>{n.current=!1}:e,t)}function re(){}function de(e,t,s,n){return dr(e,n)||fr(e,t,s,n)}function dr(e,t){return e.editor.getModel(Ke(e,t))}function fr(e,t,s,n){return e.editor.createModel(t,s,n&&Ke(e,n))}function Ke(e,t){return e.Uri.parse(t)}function pr(e){return e===void 0}function He(e){let{original:t,modified:s,language:n,originalLanguage:a,modifiedLanguage:i,originalModelPath:u,modifiedModelPath:p,keepCurrentOriginalModel:c,keepCurrentModifiedModel:d,theme:m,loading:b,options:x,height:T,width:U,className:w,wrapperProps:q,beforeMount:K,onMount:H}=e;const[P,A]=l.useState(!1),[V,y]=l.useState(!0),E=l.useRef(null),O=l.useRef(null),W=l.useRef(null),C=l.useRef(H),g=l.useRef(K);Ge(()=>{const j=qe.init();return j.then(f=>(O.current=f)&&y(!1)).catch(f=>(f==null?void 0:f.type)!=="cancelation"&&console.error("Monaco initialization: error:",f)),()=>E.current?_():j.cancel()}),R(()=>{const j=E.current.getModifiedEditor();j.getOption(O.current.editor.EditorOption.readOnly)?j.setValue(s):s!==j.getValue()&&(j.executeEdits("",[{range:j.getModel().getFullModelRange(),text:s,forceMoveMarkers:!0}]),j.pushUndoStop())},[s],P),R(()=>{E.current.getModel().original.setValue(t)},[t],P),R(()=>{const{original:j,modified:f}=E.current.getModel();O.current.editor.setModelLanguage(j,a||n),O.current.editor.setModelLanguage(f,i||n)},[n,a,i],P),R(()=>{O.current.editor.setTheme(m)},[m],P),R(()=>{E.current.updateOptions(x)},[x],P);const F=l.useCallback(()=>{g.current(O.current);const j=de(O.current,t,a||n,u),f=de(O.current,s,i||n,p);E.current.setModel({original:j,modified:f})},[n,s,i,t,a,u,p]),z=l.useCallback(()=>{E.current=O.current.editor.createDiffEditor(W.current,{automaticLayout:!0,...x}),F(),O.current.editor.setTheme(m),A(!0)},[x,m,F]);l.useEffect(()=>{P&&C.current(E.current,O.current)},[P]),l.useEffect(()=>{!V&&!P&&z()},[V,P,z]);function _(){var f,M;const j=E.current.getModel();c||(f=j.original)==null||f.dispose(),d||(M=j.modified)==null||M.dispose(),E.current.dispose()}return G.createElement(Be,{width:U,height:T,isEditorReady:P,loading:b,_ref:W,className:w,wrapperProps:q})}He.propTypes={original:o.string,modified:o.string,language:o.string,originalLanguage:o.string,modifiedLanguage:o.string,originalModelPath:o.string,modifiedModelPath:o.string,keepCurrentOriginalModel:o.bool,keepCurrentModifiedModel:o.bool,theme:o.string,loading:o.oneOfType([o.element,o.string]),options:o.object,width:o.oneOfType([o.number,o.string]),height:o.oneOfType([o.number,o.string]),className:o.string,wrapperProps:o.object,beforeMount:o.func,onMount:o.func};He.defaultProps={theme:"light",loading:"Loading...",options:{},keepCurrentOriginalModel:!1,keepCurrentModifiedModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:re,onMount:re};function mr(e){const t=l.useRef();return l.useEffect(()=>{t.current=e},[e]),t.current}const oe=new Map;function ye(e){let{defaultValue:t,defaultLanguage:s,defaultPath:n,value:a,language:i,path:u,theme:p,line:c,loading:d,options:m,overrideServices:b,saveViewState:x,keepCurrentModel:T,width:U,height:w,className:q,wrapperProps:K,beforeMount:H,onMount:P,onChange:A,onValidate:V}=e;const[y,E]=l.useState(!1),[O,W]=l.useState(!0),C=l.useRef(null),g=l.useRef(null),F=l.useRef(null),z=l.useRef(P),_=l.useRef(H),j=l.useRef(null),f=l.useRef(a),M=mr(u);Ge(()=>{const v=qe.init();return v.then(S=>(C.current=S)&&W(!1)).catch(S=>(S==null?void 0:S.type)!=="cancelation"&&console.error("Monaco initialization: error:",S)),()=>g.current?Y():v.cancel()}),R(()=>{const v=de(C.current,t||a,s||i,u);v!==g.current.getModel()&&(x&&oe.set(M,g.current.saveViewState()),g.current.setModel(v),x&&g.current.restoreViewState(oe.get(u)))},[u],y),R(()=>{g.current.updateOptions(m)},[m],y),R(()=>{g.current.getOption(C.current.editor.EditorOption.readOnly)?g.current.setValue(a):a!==g.current.getValue()&&(g.current.executeEdits("",[{range:g.current.getModel().getFullModelRange(),text:a,forceMoveMarkers:!0}]),g.current.pushUndoStop())},[a],y),R(()=>{C.current.editor.setModelLanguage(g.current.getModel(),i)},[i],y),R(()=>{pr(c)||g.current.revealLine(c)},[c],y),R(()=>{C.current.editor.setTheme(p)},[p],y);const D=l.useCallback(()=>{_.current(C.current);const v=u||n,S=de(C.current,a||t,s||i,v);g.current=C.current.editor.create(F.current,{model:S,automaticLayout:!0,...m},b),x&&g.current.restoreViewState(oe.get(v)),C.current.editor.setTheme(p),E(!0)},[t,s,n,a,i,u,m,b,x,p]);l.useEffect(()=>{y&&z.current(g.current,C.current)},[y]),l.useEffect(()=>{!O&&!y&&D()},[O,y,D]),f.current=a,l.useEffect(()=>{var v,S;y&&A&&((v=j.current)==null||v.dispose(),j.current=(S=g.current)==null?void 0:S.onDidChangeModelContent(X=>{const Q=g.current.getValue();f.current!==Q&&A(Q,X)}))},[y,A]),l.useEffect(()=>{if(y){const v=C.current.editor.onDidChangeMarkers(S=>{var Q;const X=(Q=g.current.getModel())==null?void 0:Q.uri;if(X&&S.find(pe=>pe.path===X.path)){const pe=C.current.editor.getModelMarkers({resource:X});V==null||V(pe)}});return()=>{v==null||v.dispose()}}},[y,V]);function Y(){var v,S;(v=j.current)==null||v.dispose(),T?x&&oe.set(u,g.current.saveViewState()):(S=g.current.getModel())==null||S.dispose(),g.current.dispose()}return G.createElement(Be,{width:U,height:w,isEditorReady:y,loading:d,_ref:F,className:q,wrapperProps:K})}ye.propTypes={defaultValue:o.string,defaultPath:o.string,defaultLanguage:o.string,value:o.string,language:o.string,path:o.string,theme:o.string,line:o.number,loading:o.oneOfType([o.element,o.string]),options:o.object,overrideServices:o.object,saveViewState:o.bool,keepCurrentModel:o.bool,width:o.oneOfType([o.number,o.string]),height:o.oneOfType([o.number,o.string]),className:o.string,wrapperProps:o.object,beforeMount:o.func,onMount:o.func,onChange:o.func,onValidate:o.func};ye.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:re,onMount:re,onValidate:re};var gr=l.memo(ye);const hr=({schema:e,schemaUrl:t,value:s,onChange:n})=>{const[a,i]=l.useState(""),[u,p]=l.useState(!1);l.useEffect(()=>{if(s)if(typeof s=="string")i(s);else try{i(JSON.stringify(s,null,2))}catch{le.warning("输入对象不合法")}else i("")},[s]);const c=d=>{if(d){i(d);try{n==null||n(JSON.parse(d))}catch{}}else i(""),n==null||n()};return r.jsxs(r.Fragment,{children:[r.jsx(L.TextArea,{className:"text-xs",value:a,autoSize:{minRows:3,maxRows:12},onClick:()=>{p(!0)},onChange:d=>c(d.target.value)}),u&&r.jsx(ct,{mask:!1,title:null,width:720,style:{top:"10vh"},bodyStyle:{height:"60vh"},open:!0,onOk:()=>{p(!1),c==null||c(a)},onCancel:()=>p(!1),children:r.jsx(gr,{options:{fixedOverflowWidgets:!0,minimap:{enabled:!1},lineNumbers:"off",lineDecorationsWidth:0,glyphMargin:!1,formatOnPaste:!0,formatOnType:!0},defaultLanguage:"json",defaultPath:"fb://json/editor.json",onChange:d=>c(d),beforeMount:d=>{var x;const m=[];e&&m.push({uri:"http://fb/schema.json",schema:e}),t&&m.push({uri:t}),d.languages.json.jsonDefaults.setDiagnosticsOptions(!t&&!e?{...d.languages.json.jsonDefaults.diagnosticsOptions}:{validate:!0,schemas:m});const b=d.Uri.parse("fb://json/editor.json");(x=d.editor.getModel(b))==null||x.dispose(),a&&d.editor.createModel(a,"json",b)},onMount:d=>{lt(d)}})})]})},jr=hr,vr=""+new URL("Auth0-01f36d6a.png",import.meta.url).href,br=""+new URL("Authing-15098c69.png",import.meta.url).href,yr=""+new URL("Github-4d22fa0c.png",import.meta.url).href,xr=""+new URL("Keycloak-a629b1cc.png",import.meta.url).href,wr=""+new URL("OpenID-b1c149fa.png",import.meta.url).href,Mr=""+new URL("google-4099bb07.png",import.meta.url).href,kr=""+new URL("okta-271748f3.png",import.meta.url).href,Ye={name:"",createTime:"",updateTime:"",deleteTime:"",enabled:!1,issuer:{kind:N.Static,staticVariableContent:""},jwksProviderEnabled:!1,jwksProvider:{jwksJson:{kind:N.Static,staticVariableContent:""},jwksUrl:{kind:N.Static,staticVariableContent:""},userInfoCacheTtlSeconds:0,userInfoEndpoint:{kind:N.Static,staticVariableContent:""}},oidcConfigEnabled:!1,oidcConfig:{clientId:{kind:N.Static,staticVariableContent:""},clientSecret:{kind:N.Static,staticVariableContent:""},issuer:{kind:N.Static,staticVariableContent:""},queryParameters:[]}};ot.config({paths:{vs:"./modules/monaco-editor/min/vs"}});const Or=[{img:vr,link:"https://auth0.com/docs/"},{img:br,link:"https://docs.authing.cn/"},{img:yr,link:"https://docs.github.com/en/developers/apps/building-oauth-apps"},{img:xr,link:"https://www.keycloak.org/documentation.html"},{img:wr,link:"https://openid.net/developers/specs/"},{img:Mr,link:"https://developers.google.com/identity/protocols/oauth2"},{img:kr,link:"https://developer.okta.com/docs/guides"}];function Cr({content:e,onChange:t,onTest:s}){var _,j;const n=Ee(),{globalSetting:a}=l.useContext(Ie),{ruleMap:i}=dt(),{handleBottomToggleDesigner:u}=l.useContext(Ue),{getConfigurationValue:p}=Le(),[c]=h.useForm(),d=h.useWatch("name",c),m=h.useWatch(["issuer"],c),b=m?p(m):null,x=h.useWatch(["oidcConfig","clientId","kind"],c),T=h.useWatch(["oidcConfig","clientSecret","kind"],c),U=h.useWatch("jwksProviderEnabled",c),w=h.useWatch("oidcConfigEnabled",c),q=h.useWatch(["jwksProvider","jwksURL","staticVariableContent"],c),K=h.useWatch("jwks",c),H=Re(),[P,A]=l.useState({}),[V,y]=l.useState(""),E=l.useRef(""),O=pt();l.useEffect(()=>{if(e.jwksProvider.jwksJson){try{A(JSON.parse(String(e.jwksProvider.jwksJson.staticVariableContent||"{}")))}catch(f){A({}),console.error(f)}y(JSON.stringify(P))}},[e.jwksProvider]);const{loading:W,fun:C}=ft(async f=>{var D,Y,v;if(f.jwks===1)delete f.jwksProvider.jwksUrl,f.jwksProvider.jwksJson.kind=N.Static;else{if(!((D=f.jwksProvider)!=null&&D.jwksUrl)&&!((v=(Y=f.jwksProvider)==null?void 0:Y.userInfoEndpoint)!=null&&v.staticVariableContent)){le.warning(n.formatMessage({id:"aSYY8Y",defaultMessage:[{type:0,value:"未解析到jwksURL和用户端点"}]}));return}f.jwksProvider.jwksUrl.kind=N.Static,delete f.jwksProvider.jwksJson}delete f.jwks,f.enabled=!0;const M={...f};e.name?await ve.put("/authentication",M):await ve.post("/authentication",M),t(M),u("data",e.name)},[e,u,V,t]),g=l.useCallback(xe.debounce(async f=>{const M=`${f.replace(/\/+$/,"")}/.well-known/openid-configuration`;try{new URL(M)}catch{return}E.current=M,c.setFieldsValue({jwksProvider:{jwksUrl:{staticVariableContent:""},userInfoEndpoint:{staticVariableContent:""}}});const D=await Ne(M);E.current===M&&c.setFieldsValue({jwksProvider:{jwksUrl:{staticVariableContent:D.jwks_uri},userInfoEndpoint:{staticVariableContent:D.userinfo_endpoint}}})},1e3),[c]);if(l.useEffect(()=>{b&&g(b)},[g,b]),!e)return r.jsx(Ve,{});const F=e.name?e:xe.cloneDeep(Ye),z=f=>{const M=JSON.stringify(f,null,2);y(M),c.setFieldsValue({jwksProvider:{jwksJson:{kind:N.Static,staticVariableContent:M}}})};return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:`${B["db-check-setting"]}  mt-2 cursor-pointer`,children:r.jsx("span",{className:" h-5 w-19 float-right"})}),r.jsxs("div",{className:`${B["edit-form-contain"]} py-6 rounded-xl mb-4 flex`,children:[r.jsx("div",{className:"w-3/5",children:r.jsxs(h,{form:c,name:"basic",labelCol:{span:7},wrapperCol:{span:17},onFinish:C,autoComplete:"new-password",validateTrigger:"onChange",initialValues:{...F,jwks:(j=(_=e.jwksProvider)==null?void 0:_.jwksJson)!=null&&j.staticVariableContent?1:0},children:[r.jsx(h.Item,{label:n.formatMessage({id:"0zyVbu",defaultMessage:[{type:0,value:"供应商名称"}]}),name:"name",rules:[{required:!0,message:n.formatMessage({id:"YGQB4N",defaultMessage:[{type:0,value:"供应商名称不能为空"}]})},...i.name],children:r.jsx(L,{placeholder:n.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]}),autoComplete:"off",autoFocus:!0,disabled:!!e.name})}),r.jsx(mt,{formItemProps:{label:"Issuer",name:"issuer"},rules:[{required:!0,message:n.formatMessage({id:"pzponE",defaultMessage:[{type:0,value:"Issuer不能为空"}]})}],inputRender:f=>r.jsx(ut,{...f})}),r.jsx(h.Item,{label:n.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"服务发现地址"}]}),children:r.jsx(L,{value:b?`${b}/.well-known/openid-configuration`:n.formatMessage({id:"oaXH28",defaultMessage:[{type:0,value:"请先输入 Issuer 地址"}]}),disabled:!0})}),r.jsx(h.Item,{label:n.formatMessage({id:"lcCuRt",defaultMessage:[{type:0,value:"用户端点"}]}),name:["jwksProvider","userInfoEndpoint","staticVariableContent"],children:r.jsx(L,{placeholder:b?n.formatMessage({id:"plf8Wt",defaultMessage:[{type:0,value:"请输入正确的 Issuer 地址"}]}):n.formatMessage({id:"oaXH28",defaultMessage:[{type:0,value:"请先输入 Issuer 地址"}]}),disabled:!0})}),r.jsx(h.Item,{label:r.jsx("div",{className:B.switchLabel,children:n.formatMessage({id:"VtOp3i",defaultMessage:[{type:0,value:"基于cookie"}]})}),className:"pt-5",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(h.Item,{noStyle:!0,name:"oidcConfigEnabled",valuePropName:"checked",children:r.jsx(we,{checkedChildren:n.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]}),unCheckedChildren:n.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})}),r.jsx("div",{className:"ml-2 text-12px text-[#333]",children:r.jsx(k,{id:"BFO9oi",defaultMessage:[{type:0,value:"授权码模式"}]})})]})}),r.jsx(h.Item,{label:n.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),required:w,children:r.jsxs(L.Group,{compact:!0,className:"!flex",children:[r.jsx(h.Item,{name:["oidcConfig","clientId","kind"],noStyle:!0,children:r.jsxs($,{className:"flex-0 w-100px",disabled:!w,children:[r.jsx($.Option,{value:0,children:r.jsx(k,{id:"zbqD5q",defaultMessage:[{type:0,value:"值"}]})}),r.jsx($.Option,{value:1,children:r.jsx(k,{id:"txDRJz",defaultMessage:[{type:0,value:"环境变量"}]})})]})}),r.jsx(h.Item,{name:["oidcConfig","clientId",x===N.Static?"staticVariableContent":"environmentVariableName"],noStyle:!0,rules:w?[{required:!0,message:n.formatMessage({id:"Z4d9SJ",defaultMessage:[{type:0,value:"App ID不能为空"}]})}]:[],children:x===N.Static?r.jsx(L,{className:"flex-1",placeholder:n.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]}),disabled:!w}):r.jsx($,{className:"flex-1",options:O})})]})}),r.jsx(h.Item,{label:n.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),required:w,children:r.jsxs(L.Group,{compact:!0,className:"!flex",children:[r.jsx(h.Item,{name:["oidcConfig","clientSecret","kind"],noStyle:!0,children:r.jsxs($,{className:"flex-0 w-100px",disabled:!w,children:[r.jsx($.Option,{value:0,children:r.jsx(k,{id:"zbqD5q",defaultMessage:[{type:0,value:"值"}]})}),r.jsx($.Option,{value:1,children:r.jsx(k,{id:"txDRJz",defaultMessage:[{type:0,value:"环境变量"}]})})]})}),r.jsx(h.Item,{name:["oidcConfig","clientSecret",T===N.Static?"staticVariableContent":"environmentVariableName"],noStyle:!0,rules:w?[{required:!0,message:n.formatMessage({id:"wCsUWB",defaultMessage:[{type:0,value:"App Secret不能为空"}]})}]:[],children:T===N.Static?r.jsx(L,{disabled:!w,className:"flex-1",placeholder:n.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]})}):r.jsx($,{className:"flex-1",options:O})})]})}),d&&w&&r.jsx(h.Item,{label:n.formatMessage({id:"qGbL3R",defaultMessage:[{type:0,value:"登录回调地址"}]}),children:r.jsxs("div",{className:"flex items-center",children:[p(a.nodeOptions.publicNodeUrl),"/auth/cookie/callback/",d,r.jsx(tt,{className:"cursor-pointer ml-4",onClick:()=>{Te(`${p(a.nodeOptions.publicNodeUrl)}/auth/cookie/callback/${d}`),le.success(n.formatMessage({id:"J9jPRL",defaultMessage:[{type:0,value:"复制成功"}]}))}})]})}),r.jsx(h.Item,{label:r.jsx("div",{className:B.switchLabel,children:n.formatMessage({id:"LWXiI7",defaultMessage:[{type:0,value:"基于Token"}]})}),className:"pt-5",children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(h.Item,{noStyle:!0,name:"jwksProviderEnabled",valuePropName:"checked",children:r.jsx(we,{checkedChildren:n.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]}),unCheckedChildren:n.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})}),r.jsx("div",{className:"ml-2 text-12px text-[#333]",children:r.jsx(k,{id:"P3/nym",defaultMessage:[{type:0,value:"隐式模式"}]})})]})}),r.jsx(h.Item,{label:n.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),name:"jwks",children:r.jsxs(me.Group,{disabled:!U,children:[r.jsx(me,{value:0,children:"URL"}),r.jsx(me,{value:1,children:"JSON"})]})}),K===1?r.jsx(h.Item,{label:n.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),className:"mb-5",name:["jwksProvider","jwksJson","staticVariableContent"],children:r.jsx(jr,{value:P,onChange:z})}):r.jsx(h.Item,{label:n.formatMessage({id:"kXy8jI",defaultMessage:[{type:0,value:"jwksURL"}]}),name:["jwksProvider","jwksUrl","staticVariableContent"],children:r.jsx(L,{disabled:!0,suffix:r.jsx("div",{className:"cursor-pointer",onClick:()=>{window.open(q,"_blank")},children:r.jsx(k,{id:"m7E2Te",defaultMessage:[{type:0,value:"访问"}]})})})}),r.jsxs(h.Item,{wrapperCol:{offset:4,span:16},children:[r.jsx(ce,{className:"btn-cancel",onClick:()=>{if(!(e!=null&&e.name)){H(-1);return}u("data",e.name)},children:r.jsx("span",{children:r.jsx(k,{id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})}),r.jsx(ce,{loading:W,className:"ml-4 btn-save",onClick:()=>{c.submit()},children:r.jsx(k,{id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]})})]})]})}),r.jsxs("div",{className:`w-2/5 ${B.supportList}`,children:[r.jsx("div",{className:"title",children:n.formatMessage({id:"DzVs1L",defaultMessage:[{type:0,value:"我们支持"}]})}),Or.map((f,M)=>r.jsx("a",{className:B.supportItem,href:f.link,target:"_blank",rel:"noreferrer",children:r.jsx("img",{src:f.img,alt:"",className:"w-40"})},M))]})]})]})}function on(){const[e,t]=l.useState(),[s,n]=l.useState(!1),a=Re(),{name:i}=rt(),u=nt(),{doTest:p}=at("#/workbench/userInfo");l.useEffect(()=>{if(i==="new"){n(!0),t(Ye);return}ve.get("/authentication").then(m=>{m.forEach(b=>{b.name===i&&(n(!1),t(b))})})},[i]),l.useEffect(()=>{i!=="create"&&i!=="new"&&(n(!1),t(u==null?void 0:u.find(m=>m.name===i)))},[u,i]);const c=m=>{st(),t(m),a(`/workbench/auth/${m.name}`)},d=()=>{p(e.name)};return r.jsxs("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",r.jsxs("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[r.jsx("img",{src:"./assets/icon/oidc.svg",className:"h-14px mr-1.5 w-14px",alt:"文件"}),(e==null?void 0:e.name)||r.jsx(k,{id:"AR/s6m",defaultMessage:[{type:0,value:"创建身份认证器"}]}),r.jsx("div",{className:"flex-1"}),!s&&r.jsxs(r.Fragment,{children:[(e==null?void 0:e.oidcConfigEnabled)&&r.jsx(ce,{className:"btn-test  mr-4",onClick:d,children:r.jsx(k,{id:"mPsm6o",defaultMessage:[{type:0,value:"测试"}]})}),r.jsx(ce,{className:"btn-save  mr-11",onClick:()=>n(!0),children:r.jsx(k,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})]})]}),r.jsx("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 pl-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:r.jsx(Ue.Provider,{value:{handleBottomToggleDesigner:()=>n(!s)},children:e?s?r.jsx(Cr,{content:e,onChange:c,onTest:d}):r.jsx(jt,{content:e}):""})})]})}export{on as default};
