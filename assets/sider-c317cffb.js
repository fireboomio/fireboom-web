import{K as C,a5 as I,r as a,V as w,k as L,j as r,a2 as R}from"./index-2fb02a8c.js";import{f as b,a as A}from"./fireBoomAPIOperator-c06df61f.js";import{M as T}from"./fireBoomConstants-acaaa4c8.js";import{f as k}from"./prismaRelation-585a4b7b.js";import{i as P,g as _}from"./datasource-6af9cbec.js";import{s as u}from"./index.module-37c81887.js";import{S as $}from"./index-380485cb.js";import"./toNumber-a0cb7f17.js";import"./ServiceDiscovery-84c5cb0d.js";import"./useShowArrow-3e0211e3.js";import"./index-ddb88086.js";import"./DownOutlined-45d5cf34.js";import"./PurePanel-34dddae5.js";function W(f){const v=C(),m=I(),[s,d]=a.useState(),[n,p]=a.useState(),[i,N]=a.useState([]),[h,j]=a.useState(""),[c,E]=a.useState(),l=a.useRef(!1),g=a.useRef(),t=a.useMemo(()=>m&&m.filter(e=>P(e)&&e.enabled),[m]);a.useEffect(()=>{var e;t&&(t.length===0&&f.onEmpty(),t.find(o=>o.name===s)||d((e=t==null?void 0:t[0])==null?void 0:e.name))},[t,s]),a.useEffect(()=>{x()},[s]);async function x(){if(!s)return;g.current=s;const e=w.loading(v.formatMessage({id:"9YT9eI",defaultMessage:[{type:0,value:"正在加载模型列表"}]}));try{const o=await L.get(`/datasource/graphql/${s}`,{timeout:15e3}),[D,M]=await Promise.all([b(s,{crud:!0}),A(s,{crud:!0}).catch(()=>"")]);if(g.current===s){j(o);const S=(D.datamodel.models??[]).filter(y=>y.name!==T);N(S),p(S[0]),E(k(M)),l.current=!0}}catch(o){console.error(o)}e()}return a.useEffect(()=>{!n||!t||!l.current||f.onSelectedModelChange(n,t.find(e=>e.name===s),i,c==null?void 0:c[n.name],h)},[s,n,h,t,i,c]),t?r.jsxs("div",{className:"common-form "+u.sider,children:[r.jsxs("div",{className:"flex w-full items-center",children:[r.jsx($,{value:s,onChange:e=>{l.current=!1,d(e)},className:"flex-1",options:t.map(e=>{const o=_(e);return{name:e.name,label:r.jsxs("div",{className:"flex items-center",children:[r.jsx("img",{className:"h-3 mr-1 w-3",alt:e.name,src:o}),e.name]}),value:e.name}})}),r.jsx("div",{className:"cursor-pointer flex bg-[#f7f7f7] h-28px ml-1 w-28px items-center justify-center",onClick:x,children:r.jsx("img",{width:18,height:18,src:"./assets/refresh.svg",alt:"刷新"})})]}),r.jsx("div",{className:"py-5px overflow-y-auto pa",children:i.map(e=>r.jsxs("div",{className:R({[u.siderItem]:!0,[u.siderItemActive]:(n==null?void 0:n.name)===e.name}),onClick:()=>p(e),children:[r.jsx("img",{className:"mr-3",src:"./assets/model.svg",alt:"刷新"}),e.name]},e.name))})]}):null}export{W as default};
