import{r as o,K as Me,C as we,p as ke,j as t,a2 as We,Q as k,am as ze,an as Be,V as ne,aB as Ge,R as B,W as L,ag as g,u as Ce,l as he,aJ as Ke,ao as ce,ad as ae,k as pe,X as Ye,N as Xe,M as He}from"./index-0c7e8d7d.js";import{u as Qe}from"./auth-a1faabaa.js";import{c as Se}from"./index-e1a71c89.js";import{i as Ze}from"./use-immer.module-9c2e87f8.js";import{E as Oe}from"./50x-0790c0b6.js";import{u as Ne,g as Q}from"./variable-55825bbf.js";import{D as I}from"./index-7d010c6d.js";import{T as re}from"./index-e1f7e251.js";import{C as Z}from"./CopyOutlined-9efed48d.js";import{i as et,l as tt}from"./index-2e322739.js";import{m as rt}from"./utils-9b986f1e.js";import{M as st}from"./index-7ede27b0.js";import{U as nt}from"./index-ae4210a9.js";import{u as at}from"./validate-392331cb.js";import{V as P}from"./common-7ac8785d.js";import{u as it}from"./lock-3a97aa67.js";import{u as ot,I as lt}from"./index-eae42abb.js";import{s as z}from"./subs.module-31980379.js";import{S as je}from"./index-74c28314.js";import{S as J}from"./index-1faff6af.js";import"./workbenchContext-bf63acf0.js";import"./index-fed5bc65.js";import"./addEventListener-fcc5b370.js";import"./LeftOutlined-2fe2174d.js";import"./useBreakpoint-8bc9fbe5.js";import"./useForceUpdate-4bdfd302.js";import"./PurePanel-b8585a50.js";import"./index-daaccdc7.js";import"./index-da7ccb38.js";import"./useShowArrow-96b13a20.js";import"./index-09a86a4a.js";import"./DownOutlined-7f6a39b1.js";o.createContext([]);o.createContext({});o.createContext({});const Ee=o.createContext({});o.createContext({});o.createContext({});const ct="_descriptions_1v9jj_1",ut={descriptions:ct};function dt({content:e}){var h,b,y,T,U;const r=Me(),{globalSetting:n}=o.useContext(we),{getConfigurationValue:s}=Ne(),[a,l]=Ze(!1),[u,p]=o.useState({}),c=()=>{l(!a)},f=M=>{Se(M),ne.success(r.formatMessage({id:"J9jPRL",defaultMessage:[{type:0,value:"复制成功"}]}))};return o.useEffect(()=>{if(e.issuer){const M=s(e.issuer);M&&ke(`${M}/.well-known/openid-configuration`).then(q=>{p(q)})}},[e.issuer,s]),e?t.jsx(t.Fragment,{children:t.jsxs("div",{className:We("mt-8",ut.descriptions),children:[t.jsxs(I,{bordered:!0,column:1,size:"small",children:[t.jsx(I.Item,{label:r.formatMessage({id:"YJo5EG",defaultMessage:[{type:0,value:"供应商ID"}]}),children:e.name}),t.jsxs(I.Item,{label:r.formatMessage({id:"uDcCXN",defaultMessage:[{type:0,value:"Issuer"}]}),children:[Q(e.issuer),t.jsx(Z,{className:"cursor-pointer ml-4",onClick:()=>{f(`${s(e.issuer)}`)}})]}),t.jsxs(I.Item,{label:r.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"服务发现地址"}]}),children:[`${Q(e.issuer)}/.well-known/openid-configuration`,t.jsx(Z,{className:"cursor-pointer ml-4",onClick:()=>{f(`${s(e.issuer)}/.well-known/openid-configuration`)}})]}),u.userinfo_endpoint&&t.jsxs(I.Item,{label:r.formatMessage({id:"75UFec",defaultMessage:[{type:0,value:"用户端点(自动解析)"}]}),children:[u.userinfo_endpoint,t.jsx(Z,{className:"cursor-pointer ml-4",onClick:()=>{f(u.userinfo_endpoint)}})]})]}),t.jsxs(I,{bordered:!0,column:1,size:"small",className:"mt-3",children:[t.jsxs(I.Item,{label:r.formatMessage({id:"VtOp3i",defaultMessage:[{type:0,value:"基于cookie"}]}),children:[e.oidcConfigEnabled?t.jsx(re,{color:"success",children:t.jsx(k,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):t.jsx(re,{color:"default",className:"text-[#999]",children:t.jsx(k,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})}),t.jsx("span",{className:"text-[#aaa] ml-1",children:t.jsx(k,{id:"BFO9oi",defaultMessage:[{type:0,value:"授权码模式"}]})})]}),t.jsx(I.Item,{label:r.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),children:Q((h=e.oidcConfig)==null?void 0:h.clientId)}),t.jsx(I.Item,{label:r.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),children:t.jsx("span",{className:"flex items-center",children:a?t.jsxs(t.Fragment,{children:[t.jsx("span",{children:Q((b=e.oidcConfig)==null?void 0:b.clientSecret)}),t.jsx(ze,{className:"ml-4",onClick:c})]}):t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"***********"}),t.jsx(Be,{className:"ml-4",onClick:c})]})})}),t.jsx(I.Item,{label:r.formatMessage({id:"qGbL3R",defaultMessage:[{type:0,value:"登录回调地址"}]}),children:t.jsxs("div",{className:"flex items-center",children:[s(n.nodeOptions.publicNodeUrl),"/auth/cookie/callback/",e.name,t.jsx(Z,{className:"cursor-pointer ml-4",onClick:()=>{f(`${s(n.nodeOptions.publicNodeUrl)}/auth/cookie/callback/${e.name}`)}})]})})]}),t.jsxs(I,{bordered:!0,column:1,size:"small",className:"mt-3",children:[t.jsxs(I.Item,{label:r.formatMessage({id:"qr+6Ba",defaultMessage:[{type:0,value:"基于token"}]}),children:[e.jwksProviderEnabled?t.jsx(re,{color:"success",children:t.jsx(k,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):t.jsx(re,{color:"default",className:"text-[#999]",children:t.jsx(k,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})}),t.jsx("span",{className:"text-[#aaa] ml-1",children:t.jsx(k,{id:"P3/nym",defaultMessage:[{type:0,value:"隐式模式"}]})})]}),t.jsx(I.Item,{label:r.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),children:(y=e.jwksProvider)!=null&&y.jwksJson?"JSON":"URL"}),(T=e.jwksProvider)!=null&&T.jwksJson?t.jsx(I.Item,{label:r.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),children:t.jsx("pre",{className:"overflow-x-auto",children:Q((U=e.jwksProvider)==null?void 0:U.jwksJson)})}):t.jsxs(I.Item,{label:r.formatMessage({id:"xxNCEl",defaultMessage:[{type:0,value:"jwksURL(自动解析)"}]}),children:[u.jwks_uri,t.jsx(Z,{className:"cursor-pointer ml-4",onClick:()=>{f(u.jwks_uri)}})]})]})]})}):t.jsx(Oe,{})}function ft(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function ve(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function be(e){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?ve(Object(n),!0).forEach(function(s){ft(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function pt(e,r){if(e==null)return{};var n={},s=Object.keys(e),a,l;for(l=0;l<s.length;l++)a=s[l],!(r.indexOf(a)>=0)&&(n[a]=e[a]);return n}function mt(e,r){if(e==null)return{};var n=pt(e,r),s,a;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)s=l[a],!(r.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function gt(e,r){return ht(e)||jt(e,r)||vt(e,r)||bt()}function ht(e){if(Array.isArray(e))return e}function jt(e,r){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],s=!0,a=!1,l=void 0;try{for(var u=e[Symbol.iterator](),p;!(s=(p=u.next()).done)&&(n.push(p.value),!(r&&n.length===r));s=!0);}catch(c){a=!0,l=c}finally{try{!s&&u.return!=null&&u.return()}finally{if(a)throw l}}return n}}function vt(e,r){if(e){if(typeof e=="string")return xe(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xe(e,r)}}function xe(e,r){(r==null||r>e.length)&&(r=e.length);for(var n=0,s=new Array(r);n<r;n++)s[n]=e[n];return s}function bt(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var xt={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function yt(e){return function r(){for(var n=this,s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,p=new Array(u),c=0;c<u;c++)p[c]=arguments[c];return r.apply(n,[].concat(a,p))}}}function Mt(e){return{}.toString.call(e).includes("Object")}function wt(e){return e||ye("configIsRequired"),Mt(e)||ye("configType"),e.urls?(kt(),{paths:{vs:e.urls.monacoBase}}):e}function kt(){console.warn(Ie.deprecation)}function Ct(e,r){throw new Error(e[r]||e.default)}var Ie={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},ye=yt(Ct)(Ie),St={config:wt},Ot=function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return function(a){return n.reduceRight(function(l,u){return u(l)},a)}};function Pe(e,r){return Object.keys(r).forEach(function(n){r[n]instanceof Object&&e[n]&&Object.assign(r[n],Pe(e[n],r[n]))}),be(be({},e),r)}var Nt={type:"cancelation",msg:"operation is manually canceled"};function ue(e){var r=!1,n=new Promise(function(s,a){e.then(function(l){return r?a(Nt):s(l)}),e.catch(a)});return n.cancel=function(){return r=!0},n}var Et=et.create({config:xt,isInitialized:!1,resolve:null,reject:null,monaco:null}),Re=gt(Et,2),te=Re[0],oe=Re[1];function It(e){var r=St.config(e),n=r.monaco,s=mt(r,["monaco"]);oe(function(a){return{config:Pe(a.config,s),monaco:n}})}function Pt(){var e=te(function(r){var n=r.monaco,s=r.isInitialized,a=r.resolve;return{monaco:n,isInitialized:s,resolve:a}});if(!e.isInitialized){if(oe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ue(de);if(window.monaco&&window.monaco.editor)return Te(window.monaco),e.resolve(window.monaco),ue(de);Ot(Rt,Vt)(Lt)}return ue(de)}function Rt(e){return document.body.appendChild(e)}function Tt(e){var r=document.createElement("script");return e&&(r.src=e),r}function Vt(e){var r=te(function(s){var a=s.config,l=s.reject;return{config:a,reject:l}}),n=Tt("".concat(r.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=r.reject,n}function Lt(){var e=te(function(n){var s=n.config,a=n.resolve,l=n.reject;return{config:s,resolve:a,reject:l}}),r=window.require;r.config(e.config),r(["vs/editor/editor.main"],function(n){Te(n),e.resolve(n)},function(n){e.reject(n)})}function Te(e){te().monaco||oe({monaco:e})}function Ut(){return te(function(e){var r=e.monaco;return r})}var de=new Promise(function(e,r){return oe({resolve:e,reject:r})}),Ve={config:It,init:Pt,__getMonacoInstance:Ut},Le={exports:{}},At="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Dt=At,Jt=Dt;function Ue(){}function Ae(){}Ae.resetWarningCache=Ue;var qt=function(){function e(s,a,l,u,p,c){if(c!==Jt){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}e.isRequired=e;function r(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:Ae,resetWarningCache:Ue};return n.PropTypes=n,n};Le.exports=qt();var $t=Le.exports;const i=Ge($t);function me(){return me=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},me.apply(this,arguments)}const _t={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function Ft(e){let{content:r}=e;return B.createElement("div",{style:_t},r)}const fe={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function De(e){let{width:r,height:n,isEditorReady:s,loading:a,_ref:l,className:u,wrapperProps:p}=e;return B.createElement("section",me({style:{...fe.wrapper,width:r,height:n}},p),!s&&B.createElement(Ft,{content:a}),B.createElement("div",{ref:l,style:{...fe.fullWidth,...!s&&fe.hide},className:u}))}De.propTypes={width:i.oneOfType([i.number,i.string]).isRequired,height:i.oneOfType([i.number,i.string]).isRequired,loading:i.oneOfType([i.element,i.string]).isRequired,isEditorReady:i.bool.isRequired,className:i.string,wrapperProps:i.object};var Je=o.memo(De);function qe(e){o.useEffect(e,[])}function R(e,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const s=o.useRef(!0);o.useEffect(s.current||!n?()=>{s.current=!1}:e,r)}function ee(){}function ie(e,r,n,s){return Wt(e,s)||zt(e,r,n,s)}function Wt(e,r){return e.editor.getModel($e(e,r))}function zt(e,r,n,s){return e.editor.createModel(r,n,s&&$e(e,s))}function $e(e,r){return e.Uri.parse(r)}function Bt(e){return e===void 0}function _e(e){let{original:r,modified:n,language:s,originalLanguage:a,modifiedLanguage:l,originalModelPath:u,modifiedModelPath:p,keepCurrentOriginalModel:c,keepCurrentModifiedModel:f,theme:h,loading:b,options:y,height:T,width:U,className:M,wrapperProps:q,beforeMount:G,onMount:K}=e;const[N,A]=o.useState(!1),[V,x]=o.useState(!0),E=o.useRef(null),C=o.useRef(null),_=o.useRef(null),S=o.useRef(K),m=o.useRef(G);qe(()=>{const j=Ve.init();return j.then(d=>(C.current=d)&&x(!1)).catch(d=>(d==null?void 0:d.type)!=="cancelation"&&console.error("Monaco initialization: error:",d)),()=>E.current?W():j.cancel()}),R(()=>{const j=E.current.getModifiedEditor();j.getOption(C.current.editor.EditorOption.readOnly)?j.setValue(n):n!==j.getValue()&&(j.executeEdits("",[{range:j.getModel().getFullModelRange(),text:n,forceMoveMarkers:!0}]),j.pushUndoStop())},[n],N),R(()=>{E.current.getModel().original.setValue(r)},[r],N),R(()=>{const{original:j,modified:d}=E.current.getModel();C.current.editor.setModelLanguage(j,a||s),C.current.editor.setModelLanguage(d,l||s)},[s,a,l],N),R(()=>{C.current.editor.setTheme(h)},[h],N),R(()=>{E.current.updateOptions(y)},[y],N);const $=o.useCallback(()=>{m.current(C.current);const j=ie(C.current,r,a||s,u),d=ie(C.current,n,l||s,p);E.current.setModel({original:j,modified:d})},[s,n,l,r,a,u,p]),F=o.useCallback(()=>{E.current=C.current.editor.createDiffEditor(_.current,{automaticLayout:!0,...y}),$(),C.current.editor.setTheme(h),A(!0)},[y,h,$]);o.useEffect(()=>{N&&S.current(E.current,C.current)},[N]),o.useEffect(()=>{!V&&!N&&F()},[V,N,F]);function W(){var d,w;const j=E.current.getModel();c||(d=j.original)==null||d.dispose(),f||(w=j.modified)==null||w.dispose(),E.current.dispose()}return B.createElement(Je,{width:U,height:T,isEditorReady:N,loading:b,_ref:_,className:M,wrapperProps:q})}_e.propTypes={original:i.string,modified:i.string,language:i.string,originalLanguage:i.string,modifiedLanguage:i.string,originalModelPath:i.string,modifiedModelPath:i.string,keepCurrentOriginalModel:i.bool,keepCurrentModifiedModel:i.bool,theme:i.string,loading:i.oneOfType([i.element,i.string]),options:i.object,width:i.oneOfType([i.number,i.string]),height:i.oneOfType([i.number,i.string]),className:i.string,wrapperProps:i.object,beforeMount:i.func,onMount:i.func};_e.defaultProps={theme:"light",loading:"Loading...",options:{},keepCurrentOriginalModel:!1,keepCurrentModifiedModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:ee,onMount:ee};function Gt(e){const r=o.useRef();return o.useEffect(()=>{r.current=e},[e]),r.current}const se=new Map;function ge(e){let{defaultValue:r,defaultLanguage:n,defaultPath:s,value:a,language:l,path:u,theme:p,line:c,loading:f,options:h,overrideServices:b,saveViewState:y,keepCurrentModel:T,width:U,height:M,className:q,wrapperProps:G,beforeMount:K,onMount:N,onChange:A,onValidate:V}=e;const[x,E]=o.useState(!1),[C,_]=o.useState(!0),S=o.useRef(null),m=o.useRef(null),$=o.useRef(null),F=o.useRef(N),W=o.useRef(K),j=o.useRef(null),d=o.useRef(a),w=Gt(u);qe(()=>{const v=Ve.init();return v.then(O=>(S.current=O)&&_(!1)).catch(O=>(O==null?void 0:O.type)!=="cancelation"&&console.error("Monaco initialization: error:",O)),()=>m.current?Y():v.cancel()}),R(()=>{const v=ie(S.current,r||a,n||l,u);v!==m.current.getModel()&&(y&&se.set(w,m.current.saveViewState()),m.current.setModel(v),y&&m.current.restoreViewState(se.get(u)))},[u],x),R(()=>{m.current.updateOptions(h)},[h],x),R(()=>{m.current.getOption(S.current.editor.EditorOption.readOnly)?m.current.setValue(a):a!==m.current.getValue()&&(m.current.executeEdits("",[{range:m.current.getModel().getFullModelRange(),text:a,forceMoveMarkers:!0}]),m.current.pushUndoStop())},[a],x),R(()=>{S.current.editor.setModelLanguage(m.current.getModel(),l)},[l],x),R(()=>{Bt(c)||m.current.revealLine(c)},[c],x),R(()=>{S.current.editor.setTheme(p)},[p],x);const D=o.useCallback(()=>{W.current(S.current);const v=u||s,O=ie(S.current,a||r,n||l,v);m.current=S.current.editor.create($.current,{model:O,automaticLayout:!0,...h},b),y&&m.current.restoreViewState(se.get(v)),S.current.editor.setTheme(p),E(!0)},[r,n,s,a,l,u,h,b,y,p]);o.useEffect(()=>{x&&F.current(m.current,S.current)},[x]),o.useEffect(()=>{!C&&!x&&D()},[C,x,D]),d.current=a,o.useEffect(()=>{var v,O;x&&A&&((v=j.current)==null||v.dispose(),j.current=(O=m.current)==null?void 0:O.onDidChangeModelContent(X=>{const H=m.current.getValue();d.current!==H&&A(H,X)}))},[x,A]),o.useEffect(()=>{if(x){const v=S.current.editor.onDidChangeMarkers(O=>{var H;const X=(H=m.current.getModel())==null?void 0:H.uri;if(X&&O.find(le=>le.path===X.path)){const le=S.current.editor.getModelMarkers({resource:X});V==null||V(le)}});return()=>{v==null||v.dispose()}}},[x,V]);function Y(){var v,O;(v=j.current)==null||v.dispose(),T?y&&se.set(u,m.current.saveViewState()):(O=m.current.getModel())==null||O.dispose(),m.current.dispose()}return B.createElement(Je,{width:U,height:M,isEditorReady:x,loading:f,_ref:$,className:q,wrapperProps:G})}ge.propTypes={defaultValue:i.string,defaultPath:i.string,defaultLanguage:i.string,value:i.string,language:i.string,path:i.string,theme:i.string,line:i.number,loading:i.oneOfType([i.element,i.string]),options:i.object,overrideServices:i.object,saveViewState:i.bool,keepCurrentModel:i.bool,width:i.oneOfType([i.number,i.string]),height:i.oneOfType([i.number,i.string]),className:i.string,wrapperProps:i.object,beforeMount:i.func,onMount:i.func,onChange:i.func,onValidate:i.func};ge.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:ee,onMount:ee,onValidate:ee};var Kt=o.memo(ge);const Yt=({schema:e,schemaUrl:r,value:n,onChange:s})=>{const[a,l]=o.useState(""),[u,p]=o.useState(!1);o.useEffect(()=>{if(n)if(typeof n=="string")l(n);else try{l(JSON.stringify(n,null,2))}catch{ne.warning("输入对象不合法")}else l("")},[n]);const c=f=>{if(f){l(f);try{s==null||s(JSON.parse(f))}catch{}}else l(""),s==null||s()};return t.jsxs(t.Fragment,{children:[t.jsx(L.TextArea,{className:"text-xs",value:a,autoSize:{minRows:3,maxRows:12},onClick:()=>{p(!0)},onChange:f=>c(f.target.value)}),u&&t.jsx(st,{mask:!1,title:null,width:720,style:{top:"10vh"},bodyStyle:{height:"60vh"},open:!0,onOk:()=>{p(!1),c==null||c(a)},onCancel:()=>p(!1),children:t.jsx(Kt,{options:{fixedOverflowWidgets:!0,minimap:{enabled:!1},lineNumbers:"off",lineDecorationsWidth:0,glyphMargin:!1,formatOnPaste:!0,formatOnType:!0},defaultLanguage:"json",defaultPath:"fb://json/editor.json",onChange:f=>c(f),beforeMount:f=>{var y;const h=[];e&&h.push({uri:"http://fb/schema.json",schema:e}),r&&h.push({uri:r}),f.languages.json.jsonDefaults.setDiagnosticsOptions(!r&&!e?{...f.languages.json.jsonDefaults.diagnosticsOptions}:{validate:!0,schemas:h});const b=f.Uri.parse("fb://json/editor.json");(y=f.editor.getModel(b))==null||y.dispose(),a&&f.editor.createModel(a,"json",b)},onMount:f=>{rt(f)}})})]})},Xt=Yt,Ht=""+new URL("Auth0-01f36d6a.png",import.meta.url).href,Qt=""+new URL("Authing-15098c69.png",import.meta.url).href,Zt=""+new URL("Github-4d22fa0c.png",import.meta.url).href,er=""+new URL("Keycloak-a629b1cc.png",import.meta.url).href,tr=""+new URL("OpenID-b1c149fa.png",import.meta.url).href,rr=""+new URL("google-4099bb07.png",import.meta.url).href,sr=""+new URL("okta-271748f3.png",import.meta.url).href,Fe={name:"",createTime:"",updateTime:"",deleteTime:"",enabled:!1,issuer:{kind:P.Static,staticVariableContent:""},jwksProviderEnabled:!1,jwksProvider:{jwksJson:{kind:P.Static,staticVariableContent:""},jwksUrl:{kind:P.Static,staticVariableContent:""},userInfoCacheTtlSeconds:0,userInfoEndpoint:{kind:P.Static,staticVariableContent:""}},oidcConfigEnabled:!1,oidcConfig:{clientId:{kind:P.Static,staticVariableContent:""},clientSecret:{kind:P.Static,staticVariableContent:""},issuer:{kind:P.Static,staticVariableContent:""},queryParameters:[]}};tt.config({paths:{vs:"./modules/monaco-editor/min/vs"}});const nr=[{img:Ht,link:"https://auth0.com/docs/"},{img:Qt,link:"https://docs.authing.cn/"},{img:Zt,link:"https://docs.github.com/en/developers/apps/building-oauth-apps"},{img:er,link:"https://www.keycloak.org/documentation.html"},{img:tr,link:"https://openid.net/developers/specs/"},{img:rr,link:"https://developers.google.com/identity/protocols/oauth2"},{img:sr,link:"https://developer.okta.com/docs/guides"}];function ar({content:e,onChange:r,onTest:n}){var W,j;const s=Me(),{globalSetting:a}=o.useContext(we),{ruleMap:l}=at(),{handleBottomToggleDesigner:u}=o.useContext(Ee),{getConfigurationValue:p}=Ne(),[c]=g.useForm(),f=g.useWatch("name",c),h=g.useWatch(["issuer"],c),b=h?p(h):null,y=g.useWatch(["oidcConfig","clientId","kind"],c),T=g.useWatch(["oidcConfig","clientSecret","kind"],c),U=g.useWatch("jwksProviderEnabled",c),M=g.useWatch("oidcConfigEnabled",c),q=g.useWatch(["jwksProvider","jwksURL","staticVariableContent"],c),G=g.useWatch("jwks",c),K=Ce(),[N,A]=o.useState({}),[V,x]=o.useState(""),E=o.useRef(""),C=ot();o.useEffect(()=>{if(e.jwksProvider.jwksJson){try{A(JSON.parse(String(e.jwksProvider.jwksJson.staticVariableContent||"{}")))}catch(d){A({}),console.error(d)}x(JSON.stringify(N))}},[e.jwksProvider]);const{loading:_,fun:S}=it(async d=>{var D,Y,v;if(d.jwks===1)delete d.jwksProvider.jwksUrl,d.jwksProvider.jwksJson.kind=P.Static;else{if(!((D=d.jwksProvider)!=null&&D.jwksUrl)&&!((v=(Y=d.jwksProvider)==null?void 0:Y.userInfoEndpoint)!=null&&v.staticVariableContent)){ne.warning(s.formatMessage({id:"aSYY8Y",defaultMessage:[{type:0,value:"未解析到jwksURL和用户端点"}]}));return}d.jwksProvider.jwksUrl.kind=P.Static,delete d.jwksProvider.jwksJson}delete d.jwks,d.enabled=!0;const w={...d};e.name?await pe.put("/authentication",w):await pe.post("/authentication",w),r(w),u("data",e.name)},[e,u,V,r]),m=o.useCallback(he.debounce(async d=>{const w=`${d.replace(/\/+$/,"")}/.well-known/openid-configuration`;try{new URL(w)}catch{return}E.current=w,c.setFieldsValue({jwksProvider:{jwksUrl:{staticVariableContent:""},userInfoEndpoint:{staticVariableContent:""}}});const D=await ke(w);E.current===w&&c.setFieldsValue({jwksProvider:{jwksUrl:{staticVariableContent:D.jwks_uri},userInfoEndpoint:{staticVariableContent:D.userinfo_endpoint}}})},1e3),[c]);if(o.useEffect(()=>{b&&m(b)},[m,b]),!e)return t.jsx(Oe,{});const $=e.name?e:he.cloneDeep(Fe),F=d=>{const w=JSON.stringify(d,null,2);x(w),c.setFieldsValue({jwksProvider:{jwksJson:{kind:P.Static,staticVariableContent:w}}})};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`${z["db-check-setting"]}  mt-2 cursor-pointer`,children:t.jsx("span",{className:" h-5 w-19 float-right"})}),t.jsxs("div",{className:`${z["edit-form-contain"]} py-6 rounded-xl mb-4 flex`,children:[t.jsx("div",{className:"w-3/5",children:t.jsxs(g,{form:c,name:"basic",labelCol:{span:7},wrapperCol:{span:17},onFinish:S,autoComplete:"new-password",validateTrigger:"onChange",initialValues:{...$,jwks:(j=(W=e.jwksProvider)==null?void 0:W.jwksJson)!=null&&j.staticVariableContent?1:0},children:[t.jsx(g.Item,{label:s.formatMessage({id:"0zyVbu",defaultMessage:[{type:0,value:"供应商名称"}]}),name:"name",rules:[{required:!0,message:s.formatMessage({id:"YGQB4N",defaultMessage:[{type:0,value:"供应商名称不能为空"}]})},...l.name],children:t.jsx(L,{placeholder:s.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]}),autoComplete:"off",autoFocus:!0,disabled:!!e.name})}),t.jsx(lt,{formItemProps:{label:"Issuer",name:"issuer"},rules:[{required:!0,message:s.formatMessage({id:"pzponE",defaultMessage:[{type:0,value:"Issuer不能为空"}]})}],inputRender:d=>t.jsx(nt,{...d})}),t.jsx(g.Item,{label:s.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"服务发现地址"}]}),children:t.jsx(L,{value:b?`${b}/.well-known/openid-configuration`:s.formatMessage({id:"oaXH28",defaultMessage:[{type:0,value:"请先输入 Issuer 地址"}]}),disabled:!0})}),t.jsx(g.Item,{label:s.formatMessage({id:"lcCuRt",defaultMessage:[{type:0,value:"用户端点"}]}),name:["jwksProvider","userInfoEndpoint","staticVariableContent"],children:t.jsx(L,{placeholder:b?s.formatMessage({id:"plf8Wt",defaultMessage:[{type:0,value:"请输入正确的 Issuer 地址"}]}):s.formatMessage({id:"oaXH28",defaultMessage:[{type:0,value:"请先输入 Issuer 地址"}]}),disabled:!0})}),t.jsx(g.Item,{label:t.jsx("div",{className:z.switchLabel,children:s.formatMessage({id:"VtOp3i",defaultMessage:[{type:0,value:"基于cookie"}]})}),className:"pt-5",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(g.Item,{noStyle:!0,name:"oidcConfigEnabled",valuePropName:"checked",children:t.jsx(je,{checkedChildren:s.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]}),unCheckedChildren:s.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})}),t.jsx("div",{className:"ml-2 text-12px text-[#333]",children:t.jsx(k,{id:"BFO9oi",defaultMessage:[{type:0,value:"授权码模式"}]})})]})}),t.jsx(g.Item,{label:s.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),required:M,children:t.jsxs(L.Group,{compact:!0,className:"!flex",children:[t.jsx(g.Item,{name:["oidcConfig","clientId","kind"],noStyle:!0,children:t.jsxs(J,{className:"flex-0 w-100px",disabled:!M,children:[t.jsx(J.Option,{value:0,children:t.jsx(k,{id:"zbqD5q",defaultMessage:[{type:0,value:"值"}]})}),t.jsx(J.Option,{value:1,children:t.jsx(k,{id:"txDRJz",defaultMessage:[{type:0,value:"环境变量"}]})})]})}),t.jsx(g.Item,{name:["oidcConfig","clientId",y===P.Static?"staticVariableContent":"environmentVariableName"],noStyle:!0,rules:M?[{required:!0,message:s.formatMessage({id:"Z4d9SJ",defaultMessage:[{type:0,value:"App ID不能为空"}]})}]:[],children:y===P.Static?t.jsx(L,{className:"flex-1",placeholder:s.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]}),disabled:!M}):t.jsx(J,{className:"flex-1",options:C})})]})}),t.jsx(g.Item,{label:s.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),required:M,children:t.jsxs(L.Group,{compact:!0,className:"!flex",children:[t.jsx(g.Item,{name:["oidcConfig","clientSecret","kind"],noStyle:!0,children:t.jsxs(J,{className:"flex-0 w-100px",disabled:!M,children:[t.jsx(J.Option,{value:0,children:t.jsx(k,{id:"zbqD5q",defaultMessage:[{type:0,value:"值"}]})}),t.jsx(J.Option,{value:1,children:t.jsx(k,{id:"txDRJz",defaultMessage:[{type:0,value:"环境变量"}]})})]})}),t.jsx(g.Item,{name:["oidcConfig","clientSecret",T===P.Static?"staticVariableContent":"environmentVariableName"],noStyle:!0,rules:M?[{required:!0,message:s.formatMessage({id:"wCsUWB",defaultMessage:[{type:0,value:"App Secret不能为空"}]})}]:[],children:T===P.Static?t.jsx(L,{disabled:!M,className:"flex-1",placeholder:s.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]})}):t.jsx(J,{className:"flex-1",options:C})})]})}),f&&M&&t.jsx(g.Item,{label:s.formatMessage({id:"qGbL3R",defaultMessage:[{type:0,value:"登录回调地址"}]}),children:t.jsxs("div",{className:"flex items-center",children:[p(a.nodeOptions.publicNodeUrl),"/auth/cookie/callback/",f,t.jsx(Ke,{className:"cursor-pointer ml-4",onClick:()=>{Se(`${p(a.nodeOptions.publicNodeUrl)}/auth/cookie/callback/${f}`),ne.success(s.formatMessage({id:"J9jPRL",defaultMessage:[{type:0,value:"复制成功"}]}))}})]})}),t.jsx(g.Item,{label:t.jsx("div",{className:z.switchLabel,children:s.formatMessage({id:"LWXiI7",defaultMessage:[{type:0,value:"基于Token"}]})}),className:"pt-5",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(g.Item,{noStyle:!0,name:"jwksProviderEnabled",valuePropName:"checked",children:t.jsx(je,{checkedChildren:s.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]}),unCheckedChildren:s.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})}),t.jsx("div",{className:"ml-2 text-12px text-[#333]",children:t.jsx(k,{id:"P3/nym",defaultMessage:[{type:0,value:"隐式模式"}]})})]})}),t.jsx(g.Item,{label:s.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),name:"jwks",children:t.jsxs(ce.Group,{disabled:!U,children:[t.jsx(ce,{value:0,children:"URL"}),t.jsx(ce,{value:1,children:"JSON"})]})}),G===1?t.jsx(g.Item,{label:s.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),className:"mb-5",name:["jwksProvider","jwksJson","staticVariableContent"],children:t.jsx(Xt,{value:N,onChange:F})}):t.jsx(g.Item,{label:s.formatMessage({id:"kXy8jI",defaultMessage:[{type:0,value:"jwksURL"}]}),name:["jwksProvider","jwksUrl","staticVariableContent"],children:t.jsx(L,{disabled:!0,suffix:t.jsx("div",{className:"cursor-pointer",onClick:()=>{window.open(q,"_blank")},children:t.jsx(k,{id:"m7E2Te",defaultMessage:[{type:0,value:"访问"}]})})})}),t.jsxs(g.Item,{wrapperCol:{offset:4,span:16},children:[t.jsx(ae,{className:"btn-cancel",onClick:()=>{if(!(e!=null&&e.name)){K(-1);return}u("data",e.name)},children:t.jsx("span",{children:t.jsx(k,{id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})}),t.jsx(ae,{loading:_,className:"ml-4 btn-save",onClick:()=>{c.submit()},children:t.jsx(k,{id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]})})]})]})}),t.jsxs("div",{className:`w-2/5 ${z.supportList}`,children:[t.jsx("div",{className:"title",children:s.formatMessage({id:"DzVs1L",defaultMessage:[{type:0,value:"我们支持"}]})}),nr.map((d,w)=>t.jsx("a",{className:z.supportItem,href:d.link,target:"_blank",rel:"noreferrer",children:t.jsx("img",{src:d.img,alt:"",className:"w-40"})},w))]})]})]})}function Jr(){const[e,r]=o.useState(),[n,s]=o.useState(!1),a=Ce(),{name:l}=Ye(),u=Xe(),{doTest:p}=Qe("#/workbench/userInfo");o.useEffect(()=>{if(l==="new"){s(!0),r(Fe);return}pe.get("/authentication").then(h=>{h.forEach(b=>{b.name===l&&(s(!1),r(b))})})},[l]),o.useEffect(()=>{l!=="create"&&l!=="new"&&(s(!1),r(u==null?void 0:u.find(h=>h.name===l)))},[u,l]);const c=h=>{He(),r(h),a(`/workbench/auth/${h.name}`)},f=()=>{p(e.name)};return t.jsxs("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",t.jsxs("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[t.jsx("img",{src:"./assets/icon/oidc.svg",className:"h-14px mr-1.5 w-14px",alt:"文件"}),(e==null?void 0:e.name)||t.jsx(k,{id:"AR/s6m",defaultMessage:[{type:0,value:"创建身份认证器"}]}),t.jsx("div",{className:"flex-1"}),!n&&t.jsxs(t.Fragment,{children:[(e==null?void 0:e.oidcConfigEnabled)&&t.jsx(ae,{className:"btn-test  mr-4",onClick:f,children:t.jsx(k,{id:"mPsm6o",defaultMessage:[{type:0,value:"测试"}]})}),t.jsx(ae,{className:"btn-save  mr-11",onClick:()=>s(!0),children:t.jsx(k,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})]})]}),t.jsx("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 pl-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:t.jsx(Ee.Provider,{value:{handleBottomToggleDesigner:()=>s(!n)},children:e?n?t.jsx(ar,{content:e,onChange:c,onTest:f}):t.jsx(dt,{content:e}):""})})]})}export{Jr as default};
