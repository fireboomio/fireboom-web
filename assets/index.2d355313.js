import{r as m,j as e,$ as Ve,a0 as he,d as ce,ba as Ge,m as U,c as j,f as l,k as He,F as v,I as E,br as Ye,b4 as Xe,B as P,u as ye,Z as r,h as we,b9 as We,R as Qe,g as pe}from"./index.e5e6c754.js";import{a as ie,D as Je}from"./datasource-context.3a818b3a.js";import{I as ne}from"./index.60d20720.js";import{S as Fe}from"./index.6926b693.js";import{u as Ke}from"./index.esm.e5edd667.js";import{W as Re}from"./workbenchContext.a6b76e3b.js";import{A as qe,u as ea}from"./index.5f2defea.js";import{I as aa,u as sa}from"./index.9c69eadb.js";import{l as Oe}from"./Editor.c970b515.js";import{i as B}from"./use-immer.module.1d9a0526.js";import{D as b}from"./index.a76d6f2a.js";import{M as oe}from"./index.6f73eb32.js";import{R as Ee}from"./index.8958a719.js";import"./iconUtil.31c13224.js";import"./index.5e1fa168.js";import{U as Me}from"./index.e308af9d.js";import{S as R}from"./index.daad23d2.js";import{E as De}from"./50x.11335713.js";import{u as ta}from"./useEnvOptions.b8beba26.js";import{p as la}from"./db.84db3282.js";import{u as ua}from"./uploadLocal.f4ca9d85.js";import"./index.67bc873e.js";import{P as ra}from"./index.6fa46df0.js";import{T as ia}from"./Table.08c4f5f5.js";import{C as na}from"./index.3e81d184.js";import"./conductUtil.03f406cc.js";import"./index.0cfa4828.js";import"./Tree.4b4dd3c6.js";import{E as da}from"./index.1d15c994.js";import{g as oa,T as ve}from"./index.b6cece06.js";import{C as de}from"./Collapse.3bf6cf6c.js";import{S as me}from"./index.8fd962f9.js";import{F as A}from"./FormTooltip.a240d273.js";import{H as ca}from"./constant.e50476cd.js";import{P as Ue}from"./PlusOutlined.5b3e3b8c.js";import{T as Ce}from"./index.94b2fb2c.js";import{a as ma}from"./get.131f9f4f.js";import"./css.7dd30b7b.js";import"./DialogWrap.947e0e2f.js";import"./KeyCode.9c493596.js";import"./pickAttrs.c5bbb5fc.js";import"./RightOutlined.73e4cc97.js";import"./path.2dc76f8c.js";import"./difference.6d57e3ed.js";import"./_baseUniq.d23dbdee.js";import"./flatten.8e198855.js";import"./omit.afdf8a34.js";import"./_baseClone.e2094da0.js";import"./_baseGet.6a7418c9.js";import"./dayjs.min.fccffbb3.js";import"./getDataOrAriaProps.e48b8c96.js";import"./Overflow.321ca619.js";import"./DownOutlined.75881d1e.js";import"./useForceUpdate.09faac07.js";import"./DeleteOutlined.d0f28ba8.js";import"./index.esm.0df65c6e.js";import"./index.e54b5c9c.js";var pa={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};const fa=pa;var Pe=function(F,a){return e(Ve,{...he(he({},F),{},{ref:a,icon:fa})})};Pe.displayName="CaretRightOutlined";const Ne=m.exports.forwardRef(Pe);var ga={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-circle",theme:"filled"};const ha=ga;var je=function(F,a){return e(Ve,{...he(he({},F),{},{ref:a,icon:ha})})};je.displayName="PlusCircleFilled";const va=m.exports.forwardRef(je);Oe.config({paths:{vs:"/modules/monaco-editor/min/vs"}});function ya({content:s}){m.exports.useContext(ie),m.exports.useContext(Je);const[F,a]=B(s.name==""),[q,i]=B(""),{onRefreshMenu:N}=m.exports.useContext(Re),x=s.config;return m.exports.useEffect(()=>{a(s.name=="")},[s]),m.exports.useEffect(()=>{i(x.schema)},[s.config.schema]),e(aa,{onChangeEnable:()=>{N("dataSource")},hookPath:`customize/${s.name}`,defaultLanguage:"typescript"},s.name)}const Fa="_monaco_1n7bn_64",Ma="_modal_1n7bn_72",_e={"connect-edit-btn":"_connect-edit-btn_1n7bn_1","connect-check-btn":"_connect-check-btn_1n7bn_20","connect-check-btn-common":"_connect-check-btn-common_1n7bn_39","db-check-setting":"_db-check-setting_1n7bn_49","form-contain":"_form-contain_1n7bn_57",monaco:Fa,"db-setting-table":"_db-setting-table_1n7bn_68",modal:Ma},ba="_table_1srlq_1",Ea={table:ba};function Ae({beforeUpload:s,setUploadPath:F,setVisible:a,basePath:q,upType:i}){var K;const N=ce(),[x,k]=m.exports.useState([]),[_,$]=m.exports.useState(!1),[y,W]=m.exports.useState(""),I={name:"file",action:"/api/v1/file/uploadFile",headers:Ge(),data:{type:i},showUploadList:!1,beforeUpload:s,onChange(c){var D;c.file.status!=="uploading"&&console.log(c.file,c.fileList),c.file.status==="done"?(U.success(`${c.file.name} ${N.formatMessage({id:"C4HPJc",defaultMessage:[{type:0,value:"\u4E0A\u4F20\u6210\u529F"}]})}`),$(!_)):c.file.status==="error"&&U.error(((D=c.file.response)==null?void 0:D.message)||`${c.file.name} ${N.formatMessage({id:"R8Yt/D",defaultMessage:[{type:0,value:"\u4E0A\u4F20\u5931\u8D25"}]})}`)}},Q=(c,D)=>{D==null||D.stopPropagation(),z(c.name),$(!_)},d=c=>{c==null||c.stopPropagation()};m.exports.useEffect(()=>{let c;i===1?c=[".json",".yaml",".yml"]:i===2?c=[".db"]:i===3&&(c=[".graphql"]),j.get(`/file/${i}`,{params:{names:c}}).then(D=>{k(D.files)})},[_,i]);function z(c){j.delete("/file/removeFile",{data:{name:c,type:`${i}`}})}const G=[{title:N.formatMessage({id:"o8HwKf",defaultMessage:[{type:0,value:"\u6587\u4EF6\u540D"}]}),dataIndex:"name",key:"name",className:"cursor-pointer"},{title:N.formatMessage({id:"o9bMHL",defaultMessage:[{type:0,value:"\u5927\u5C0F"}]}),dataIndex:"size",key:"size",width:100},{title:N.formatMessage({id:"799kEA",defaultMessage:[{type:0,value:"\u4FEE\u6539\u65F6\u95F4"}]}),dataIndex:"modifyTime",key:"modifyTime",width:180},{title:N.formatMessage({id:"TDqc4L",defaultMessage:[{type:0,value:"\u6743\u9650"}]}),dataIndex:"permission",key:"permission",width:80},{title:"",dataIndex:"icon",key:"icon",width:80,render:(c,D)=>l("div",{className:"flex items-center justify-between",onClick:T=>T.stopPropagation(),children:[e(ra,{title:N.formatMessage({id:"LzQ0Lw",defaultMessage:[{type:0,value:"\u786E\u8BA4\u5220\u9664\uFF1F"}]}),onConfirm:T=>Q(D,T),onCancel:d,okText:N.formatMessage({id:"yOMNOj",defaultMessage:[{type:0,value:"\u662F"}]}),cancelText:N.formatMessage({id:"P/eul9",defaultMessage:[{type:0,value:"\u5426"}]}),children:e("img",{alt:"shanchu",src:"assets/iconfont/shanchu.svg",style:{height:"1em",width:"1em",fontSize:"16px",color:"#f6595b"},className:"cursor-pointer"})}),e("a",{href:`/api/v1/file/downloadFile?type=${i}&fileName=${D.name}&auth-key=${He()}`,children:e("img",{alt:"xiazai",src:"assets/iconfont/xiazai.svg",style:{height:"1em",width:"1em",fontSize:"22px"},className:"cursor-pointer"})})]})}];return l(v,{children:[l("div",{className:"flex mb-3 justify-between",children:[e(E,{style:{height:26},className:"h-26px max-w-328px",addonBefore:e(ne,{height:14,width:14,src:"/assets/folder.svg",alt:"\u76EE\u5F55",preview:!1}),defaultValue:(K={1:"./upload/oas",2:"./wundergraph/.wundergraph",3:"./upload/graphql"}[i])!=null?K:"",readOnly:!0}),l(Me,{...I,className:"cursor-pointer flex m-auto h-6 mr-3 w-18 items-center justify-center",children:[e(ne,{height:16,width:16,src:"/assets/upload.svg",alt:"\u4E0A\u4F20",preview:!1}),"\u9009\u62E9\u6587\u4EF6"]}),e(E,{value:y,onChange:c=>W(c.target.value),addonBefore:e(Ye,{}),style:{width:228,height:26}})]}),e(ia,{className:Ea.table,columns:G,dataSource:x.filter(c=>c.name.includes(y)),pagination:!1,scroll:{x:738,y:455},rowKey:c=>c.name,onRow:c=>({onClick:D=>{F(`${c.name}`),a(!1)},onDoubleClick:D=>{},onContextMenu:D=>{},onMouseEnter:D=>{},onMouseLeave:D=>{}})})]})}const Ba="_head_i7tcr_1",Ca="_btn_i7tcr_5",Be={head:Ba,btn:Ca,"ant-select":"_ant-select_i7tcr_13","ant-select-selector":"_ant-select-selector_i7tcr_13"};Oe.config({paths:{vs:"/modules/monaco-editor/min/vs"}});const Na=({replaceJSON:s,initSchema:F,content:a,onSave:q})=>{const i=ce(),{id:N}=Xe(),[x,k]=B([]),[_,$]=m.exports.useState([]),[y,W]=m.exports.useState([]),[I,Q]=m.exports.useState([]),[d,z]=m.exports.useState([]),[G,K]=m.exports.useState(F),[c,D]=m.exports.useState(null);m.exports.useEffect(()=>{!s||k(s.map((u,p)=>({id:p.toString(),table:u.table,field:u.field,resType:u.resType,inputType:u.inputType,isOpen:(u==null?void 0:u.isOpen)||!1})))},[s]),m.exports.useEffect(()=>{if(!!G)try{const u=oa(G,{noLocation:!0}).definitions,p=u.filter(f=>f.kind==="InputObjectTypeDefinition").map(f=>({label:f.name.value,value:f.name.value}));Q(p);const o=u.filter(f=>f.kind==="ObjectTypeDefinition").map(f=>({label:f.name.value,value:f.name.value}));z(o)}catch{return}},[G]),m.exports.useEffect(()=>{j.get(`/prisma/dmf/${N!=null?N:""}`,{timeout:15e3}).then(u=>{const p=(u.models||[]).map(o=>({name:o.name,fields:o.fields.map(f=>({name:f.name,title:f.title}))}));return $(p),p}).then(u=>W(u.map(p=>({label:p.name,value:p.name}))))},[N]);function T(u){var o;const p=(o=_.find(f=>f.name===u.table))==null?void 0:o.fields;return p==null?void 0:p.map(f=>({label:f.name,value:f.name}))}function L(u,p){k(o=>{const f=o.find(t=>t.id===p.id);f.table=u})}function O(u,p){k(o=>{const f=o.find(t=>t.id===p.id);f.field=u})}function ee(u,p){k(o=>{const f=o.find(t=>t.id===p.id);f.inputType=u})}function C(u,p){k(o=>{const f=o.find(t=>t.id===p.id);f.resType=u})}function se(u,p){k(o=>{const f=o.find(t=>t.id===p.id);f.isOpen=u})}function ue(){k(u=>u.concat({id:Date.now().toString(),table:"",field:"",resType:"",inputType:"",isOpen:!0}))}function te(){const u={...a,config:{...a.config,replaceJSONTypeFieldConfiguration:x,schemaExtension:G}};j.put("/dataSource",u).then(p=>{q(u),p&&U.success(i.formatMessage({id:"WHN1dG",defaultMessage:[{type:0,value:"\u4FDD\u5B58\u6210\u529F\uFF01"}]}))})}function H(u){k(p=>p.filter(o=>o.id!==u.id))}return l("div",{className:"flex gap-6 h-[calc(100vh_-_190px)]",children:[l("div",{className:"w-2/5",children:[e("div",{className:`${Be.head}`,children:e("span",{children:i.formatMessage({id:"UxBXdV",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49\u7C7B\u578B"}]})})}),e(da,{language:"graphql",value:G,onChange:u=>K(u!=null?u:"")})]}),l("div",{className:"w-3/5",children:[l("div",{className:`${Be.head} !pr-3 flex items-center justify-between`,children:[e("span",{children:i.formatMessage({id:"96YcwE",defaultMessage:[{type:0,value:"\u5B57\u6BB5\u7C7B\u578B\u6620\u5C04"}]})}),l(P,{size:"small",className:`${Be.btn} flex items-center justify-evenly cursor-pointer`,onClick:te,children:[e("img",{alt:"baocun",src:"assets/iconfont/baocun.svg",style:{height:"1em",width:"1em",color:"#5F6269"}}),e("span",{className:"text-sm",children:i.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})]}),l("div",{className:"relative py-3 px-3.5 bg-[#FFFFFF]",children:[e(va,{onClick:ue,className:"absolute right-2 top-1 z-2 cursor-pointer !text-[#649FFF]"}),l("table",{className:"w-full bg-[#FFFFFFFF] disable-common-select",children:[e("thead",{className:"leading-38px bg-[#5F62690D]",children:l("tr",{className:"",children:[e("th",{children:i.formatMessage({id:"F3wzck",defaultMessage:[{type:0,value:"\u8868"}]})}),e("th",{children:i.formatMessage({id:"z0QaYJ",defaultMessage:[{type:0,value:"\u5B57\u6BB5"}]})}),e("th",{children:i.formatMessage({id:"tmMwuy",defaultMessage:[{type:0,value:"\u54CD\u5E94\u7C7B\u578B"}]})}),e("th",{children:i.formatMessage({id:"xc9ERZ",defaultMessage:[{type:0,value:"\u8F93\u5165\u7C7B\u578B"}]})}),e("th",{children:i.formatMessage({id:"8mYf5w",defaultMessage:[{type:0,value:"\u662F\u5426\u5F00\u542F"}]})}),e("th",{})]})}),e("tbody",{children:x.map((u,p)=>l("tr",{onMouseEnter:()=>D(p),onMouseLeave:()=>D(null),className:`${c===p?"bg-[#F8F8F9FF]":""} h-45px`,children:[e("td",{children:e(R,{className:"disable-common-select",defaultValue:u.table,style:{width:120},bordered:!1,options:y,value:u.table,onChange:o=>L(o,u)})}),e("td",{children:e(R,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:T(u),value:u.field,onChange:o=>O(o,u)})}),e("td",{children:e(R,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:d,value:u.resType,onChange:o=>C(o,u)})}),e("td",{children:e(R,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:I,value:u.inputType,onChange:o=>ee(o,u)})}),e("td",{children:e(Fe,{className:"w-8 h-2",checked:u.isOpen,onChange:o=>se(o,u)})}),e("td",{children:e("img",{alt:"shanchu",src:"assets/iconfont/shanchu.svg",style:{height:"1em",width:"1em"},onClick:()=>H(u)})})]},p))})]})]})]})]})},wa=Na,Da=/^(([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5]))$/,Aa="/static/upload/sqlite";function xa({content:s,type:F}){var ae,le,xe,ke,Ie,Se,Te;const a=ce(),q=ye(),{handleToggleDesigner:i,handleSave:N}=m.exports.useContext(ie),[x,k]=B(!1),[_,$]=B(!1),[y]=r.useForm(),W=r.useWatch(["userName","kind"],y),I=r.useWatch(["password","kind"],y),Q=r.useWatch("appendType",y),d=s.config;B({});const[z,G]=B(!0),[K,c]=B([]),[D,T]=B(""),[L,O]=B(!1),ee=ta(),C=d.dbType,se=h=>{y.setFieldValue(["databaseUrl","val"],h),y.setFieldValue(["databaseUrl","kind"],"0")},ue=h=>{T(h)};m.exports.useEffect(()=>{we("/env").then(h=>h.filter(M=>M.isDel===0).map(M=>({label:M.key,value:M.key}))).then(h=>c(h))},[]);const te=String(s==null?void 0:s.config.dbType).toLowerCase(),H={mysql:{pattern:/^mysql:\/\/.{1,120}$/g,message:a.formatMessage({id:"eiRag+",defaultMessage:[{type:0,value:"\u4EE5 mysql:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D"}]}),required:!0},postgresql:{pattern:/^postgresql:\/\/.{1,115}$/g,message:a.formatMessage({id:"0aGQa4",defaultMessage:[{type:0,value:"\u4EE5 postgresql:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D"}]}),required:!0},mongodb:{pattern:/^mongodb:\/\/.{1,118}$/g,message:a.formatMessage({id:"x0YFe8",defaultMessage:[{type:0,value:"\u4EE5 mongodb:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D"}]}),required:!0}}[te],u=m.exports.useRef(""),p=async()=>{oe.info({title:a.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u540D\u79F0"}]}),content:e(E,{autoFocus:!0,placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),onChange:h=>{u.current=h.target.value}}),okText:"\u786E\u5B9A",onOk:async()=>{const h=u.current.trim().replace(/\.db$/,"").trim();if(!h)return U.error(a.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u540D\u79F0"}]}));const M=U.loading(a.formatMessage({id:"Oww89Y",defaultMessage:[{type:0,value:"\u4E0A\u4F20\u4E2D"}]}));try{await ua("2","",h+".db"),se(h+".db")}finally{M()}}})},o=C==="SQLite"?e(r.Item,{rules:[{required:!0,message:a.formatMessage({id:"6RphVF",defaultMessage:[{type:0,value:"\u8BF7\u4E0A\u4F20\u6587\u4EF6"}]})}],label:e(v,{children:e("span",{children:"\u8DEF\u5F84"})}),colon:!1,name:["databaseUrl","val"],style:{marginBottom:"20px"},children:l("div",{className:"flex",children:[e(r.Item,{name:["databaseUrl","val"],noStyle:!0,children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),onClick:()=>O(!0),suffix:e("a",{onClick:()=>O(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}),e(P,{className:"ml-4",onClick:p,children:a.formatMessage({id:"BtZh7z",defaultMessage:[{type:0,value:"\u521B\u5EFA"}]})})]})}):e(r.Item,{label:a.formatMessage({id:"6B0EzP",defaultMessage:[{type:0,value:"\u8FDE\u63A5URL"}]}),children:e(E.Group,{compact:!0,children:z?e(r.Item,{name:["databaseUrl","val"],noStyle:!0,rules:H?[H]:[],children:e(E,{style:{width:"80%"},placeholder:a.formatMessage({id:"uj6mcB",defaultMessage:[{type:0,value:"\u793A\u4F8B: "},{type:1,value:"dbProtocal"},{type:0,value:"://user:password@localhost/db-name"}]},{dbProtocal:te})})},1):e(r.Item,{name:["databaseUrl","val"],noStyle:!0,rules:[],children:e(R,{className:"w-1/5",style:{width:"80%"},options:K,value:D,onChange:ue})},2)})}),f=l(v,{children:[e(r.Item,{label:a.formatMessage({id:"Rj34mG",defaultMessage:[{type:0,value:"\u4E3B\u673A:"}]}),name:"host",rules:[{required:!0,message:a.formatMessage({id:"aYUJpY",defaultMessage:[{type:0,value:"\u4E3B\u673A\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]})}],children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{label:a.formatMessage({id:"w1CbbR",defaultMessage:[{type:0,value:"\u6570\u636E\u5E93\u540D:"}]}),name:"dbName",rules:[{required:!0,message:a.formatMessage({id:"2FVy0L",defaultMessage:[{type:0,value:"\u6570\u636E\u5E93\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_-]*$","g"),message:a.formatMessage({id:"VmsX4o",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}]})}],children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{label:a.formatMessage({id:"4rbyCQ",defaultMessage:[{type:0,value:"\u7AEF\u53E3:"}]}),name:"port",rules:[{required:!0,message:a.formatMessage({id:"ND/EcE",defaultMessage:[{type:0,value:"\u7AEF\u53E3\u53F7\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:Da,message:a.formatMessage({id:"Ksj+aW",defaultMessage:[{type:0,value:"\u7AEF\u53E3\u8303\u56F4\u4E3A0-9999"}]})}],children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{label:a.formatMessage({id:"+l43TG",defaultMessage:[{type:0,value:"\u7528\u6237:"}]}),children:e(E.Group,{compact:!0,className:"!flex",children:e(r.Item,{name:["userName","val"],noStyle:!0,rules:[{required:!0,message:a.formatMessage({id:"9SBdsw",defaultMessage:[{type:0,value:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:a.formatMessage({id:"VmsX4o",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}]})}],children:String(W)!=="1"?e(E,{className:"flex-1",placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(R,{className:"flex-1",options:ee})})})}),e(r.Item,{label:a.formatMessage({id:"zq/lNp",defaultMessage:[{type:0,value:"\u5BC6\u7801:"}]}),children:e(E.Group,{compact:!0,className:"!flex",children:e(r.Item,{name:["password","val"],noStyle:!0,children:String(I)!=="1"?e(E,{className:"flex-1",placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(R,{className:"flex-1",options:ee})})})})]}),[t,n]=B(o);if(m.exports.useEffect(()=>{F==="form"&&y.resetFields(),n(d.appendType=="1"?f:o)},[s,F]),m.exports.useEffect(()=>{n(Q=="1"?f:o)},[W,I]),m.exports.useEffect(()=>{n(o)},[z]),!s)return e(De,{});const g=async h=>{const M={...d,...h};M.databaseUrl===void 0?M.databaseUrl={}:M.databaseUrl.kind===void 0&&(M.databaseUrl.kind="0");let Z;if(s.id)Z={...s,config:M,name:h.apiNamespace},await j.put("/dataSource",Z);else{const re={...s,config:M,name:h.apiNamespace};Reflect.deleteProperty(re,"id");const be=await j.post("/dataSource",re);s.id=be,Z=s}N(Z)},V=h=>{console.log("Failed:",h)},w=h=>{const M=y.getFieldsValue();if(h.databaseUrl){const re=la(M.databaseUrl.val);if(re){const{username:be,password:$e,host:ze,port:Le,dbName:Ze}=re;y.setFieldValue(["userName","val"],be),y.setFieldValue(["password","val"],$e),y.setFieldValue("host",ze),y.setFieldValue("port",Le),y.setFieldValue("dbName",Ze)}}else(h.userName||h.password||h.host||h.port||h.dbName)&&y.setFieldValue(["databaseUrl","val"],`${s.config.dbSchema}://${M.userName.val}${M.password.val?`:${M.password.val}`:""}@${M.host}:${M.port}/${M.dbName}`);const Z=y.getFieldsError().some(({errors:re})=>re.length);k(Z)},Y=h=>{const M={...d,...y.getFieldsValue()};M.databaseUrl===void 0?M.databaseUrl={}:M.databaseUrl.kind===void 0&&(M.databaseUrl.kind="0"),j.post("/checkDBConn",{sourceType:s.sourceType,config:M}).then(Z=>{Z!=null&&Z.status?U.success(a.formatMessage({id:"JDIfhr",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u6210\u529F"}]})):U.error((Z==null?void 0:Z.msg)||a.formatMessage({id:"9yQugt",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u5931\u8D25"}]}))})},X=h=>{switch(h){case"0":n(o);break;case"1":n(f);break;default:n("");break}};return l(v,{children:[e(oe,{className:_e.modal,title:null,footer:null,open:L,onOk:()=>O(!1),onCancel:()=>O(!1),width:920,destroyOnClose:!0,children:e(Ae,{basePath:Aa,setUploadPath:se,setVisible:O,upType:2,beforeUpload:h=>{const M=h.name.endsWith(".db");return M||U.error(a.formatMessage({id:"cJXZNP",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u4E0A\u4F20 db \u683C\u5F0F\u6587\u4EF6"}]})),M||Me.LIST_IGNORE}})}),F==="detail"?l("div",{children:[e("div",{className:"flex py-10px justify-end",children:e("div",{className:"cursor-pointer flex bg-[#F9F9F9] rounded-2px h-22px text-[#E92E5E] w-21 items-center justify-center",onClick:()=>i("setting",s.id),children:a.formatMessage({id:"lliahm",defaultMessage:[{type:0,value:"\u66F4\u591A\u8BBE\u7F6E"}]})})}),e("div",{children:l(b,{bordered:!0,column:1,size:"small",children:[e(b.Item,{label:a.formatMessage({id:"TACLOV",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u540D"}]}),children:d.apiNamespace}),e(b.Item,{label:a.formatMessage({id:"niiUfh",defaultMessage:[{type:0,value:"\u6570\u636E\u5E93\u7C7B\u578B"}]}),children:d.dbType}),C==="SQLite"?e(b.Item,{label:a.formatMessage({id:"5euLB8",defaultMessage:[{type:0,value:"\u8DEF\u5F84"}]}),children:(le=(ae=d.databaseUrl)==null?void 0:ae.val)!=null?le:""}):l(v,{children:[C==="MongoDB"?e(v,{}):e(b.Item,{label:a.formatMessage({id:"DLG2Yy",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u7C7B\u578B"}]}),children:d.appendType=="0"?"\u8FDE\u63A5URL":d.appendType=="1"?"\u8FDE\u63A5\u53C2\u6570":""}),d.appendType=="1"?l(v,{children:[e(b.Item,{label:a.formatMessage({id:"h7JHIR",defaultMessage:[{type:0,value:"\u4E3B\u673A"}]}),children:d.host}),e(b.Item,{label:a.formatMessage({id:"PI0Ele",defaultMessage:[{type:0,value:"\u7AEF\u53E3"}]}),children:d.port}),e(b.Item,{label:a.formatMessage({id:"qNTQ6L",defaultMessage:[{type:0,value:"\u6570\u636E\u5E93\u540D"}]}),children:d.dbName}),e(b.Item,{label:a.formatMessage({id:"eL3Qi6",defaultMessage:[{type:0,value:"\u7528\u6237"}]}),children:(xe=d.userName)==null?void 0:xe.val}),e(b.Item,{label:a.formatMessage({id:"Pdx/YD",defaultMessage:[{type:0,value:"\u5BC6\u7801"}]}),children:_?l("span",{children:[(ke=d.password)==null?void 0:ke.val,e("img",{alt:"xiaoyanjing-chakan",src:"assets/iconfont/xiaoyanjing-chakan.svg",style:{height:"1em",width:"1em"},onClick:()=>$(!_)})]}):l("span",{children:["**********",e("img",{alt:"xiaoyanjing-yincang",src:"assets/iconfont/xiaoyanjing-yincang.svg",style:{height:"1em",width:"1em"},onClick:()=>$(!_)})]})})]}):e(v,{children:e(b.Item,{label:a.formatMessage({id:"6B0EzP",defaultMessage:[{type:0,value:"\u8FDE\u63A5URL"}]}),children:(Ie=d.databaseUrl)==null?void 0:Ie.val})})]})]})})]}):F==="form"?e("div",{children:e("div",{className:`${_e["form-contain"]} py-6 rounded-xl mb-4`,children:l(r,{form:y,style:{width:"90%"},name:"basic",labelCol:{span:4},wrapperCol:{span:12},onFinish:h=>void g(h),onFinishFailed:V,onValuesChange:w,validateTrigger:["onBlur","onChange"],autoComplete:"new-password",labelAlign:"right",initialValues:{apiNamespace:d.apiNamespace,dbType:d.dbType,appendType:d.appendType||"0",host:d.host,dbName:d.dbName,port:d.port,userName:d.userName||{kind:"0"},password:d.password||{kind:"0"},databaseUrl:{kind:((Se=d.databaseUrl)==null?void 0:Se.kind)||"0",val:(Te=d.databaseUrl)==null?void 0:Te.val}},children:[e(r.Item,{hidden:!0,name:["databaseUrl"],children:e(E,{})}),e(r.Item,{hidden:!0,name:["userName"],children:e(E,{})}),e(r.Item,{hidden:!0,name:["password"],children:e(E,{})}),e(r.Item,{hidden:!0,name:"port",children:e(E,{})}),e(r.Item,{hidden:!0,name:"dbName",children:e(E,{})}),e(r.Item,{hidden:!0,name:"host",children:e(E,{})}),e(r.Item,{label:a.formatMessage({id:"RagALW",defaultMessage:[{type:0,value:"\u540D\u79F0:"}]}),name:"apiNamespace",rules:[{required:!0,message:a.formatMessage({id:"mfZMW6",defaultMessage:[{type:0,value:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:a.formatMessage({id:"VmsX4o",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}]})}],children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),autoComplete:"off",autoFocus:!0})}),C==="SQLite"||C==="MongoDB"?e(v,{}):e(r.Item,{label:a.formatMessage({id:"V8cvxi",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u7C7B\u578B:"}]}),name:"appendType",children:l(Ee.Group,{onChange:h=>X(h.target.value),children:[e(Ee,{value:"0",style:{marginRight:"50px"},children:a.formatMessage({id:"6B0EzP",defaultMessage:[{type:0,value:"\u8FDE\u63A5URL"}]})}),e(Ee,{value:"1",children:a.formatMessage({id:"RP3X0u",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u53C2\u6570"}]})})]})}),t,l(r.Item,{wrapperCol:{offset:4,span:16},children:[e(P,{className:"btn-cancel",onClick:()=>{s.id?i("detail",s.id,s.sourceType):q("/workbench/data-source/new")},children:e("span",{children:a.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"\u53D6\u6D88"}]})})}),e(P,{className:"ml-4 btn-test",onClick:()=>Y(),children:a.formatMessage({id:"mPsm6o",defaultMessage:[{type:0,value:"\u6D4B\u8BD5"}]})}),e(P,{className:"ml-4 btn-save",onClick:()=>{y.submit()},children:a.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})]})})}):e(wa,{onSave:h=>{N({...h})},content:s,initSchema:d.schemaExtension,replaceJSON:d.replaceJSONTypeFieldConfiguration})]})}const ka="_modal_1y1rp_56",S={"edit-btn":"_edit-btn_1y1rp_1","switch-check-btn":"_switch-check-btn_1y1rp_20","descriptions-box":"_descriptions-box_1y1rp_26","collapse-box":"_collapse-box_1y1rp_29","form-icon":"_form-icon_1y1rp_35","label-style":"_label-style_1y1rp_39","connect-check-btn-common":"_connect-check-btn-common_1y1rp_43","table-contain":"_table-contain_1y1rp_53",modal:ka},fe=s=>e(ne,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[s]}),Ia="/static/upload/oas",Sa=ca.map(s=>({label:s,value:s}));function Ta({content:s,type:F}){var f;const a=ce(),q=ye(),i=s.config,{handleSave:N,handleToggleDesigner:x}=m.exports.useContext(ie);B({});const[k,_]=B({});B(!1);const[$,y]=B(!1),[W,I]=B(!1),[Q,d]=B(!0),[z,G]=B([]),[K,c]=B(""),[D,T]=B(!1),[L]=r.useForm(),{Option:O}=R,{Panel:ee}=de,C=/^https?:\/\/[-.\w\d:/]+$/i;m.exports.useEffect(()=>{y(!!i.loadSchemaFromString)},[F]),m.exports.useEffect(()=>{L.resetFields()},[s,F]),m.exports.useEffect(()=>{we("/env").then(t=>t.filter(n=>n.isDel===0).map(n=>({label:n.key,value:n.key}))).then(t=>G(t))},[]);const se=async t=>{var V;t.headers=(V=t.headers)==null?void 0:V.filter(w=>w.key!=null);const n={...t};let g;if(s.id)g={...s,config:n,name:t.apiNameSpace},await j.put("/dataSource",g);else{const w={...s,config:n,name:t.apiNameSpace},Y=await j.post("/dataSource",w);s.id=Y,g=s}N(g)},ue=t=>{console.log("Failed:",t)},te=t=>{switch(t){case"0":d(!0),_({pattern:/^.{1,2000}$/g,message:a.formatMessage({id:"mPmxv/",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E2000\u7684\u975E\u7A7A\u503C"}]})});return;case"1":d(!1);return;case"2":d(!0),_({pattern:/^\w+$/g,message:a.formatMessage({id:"aUGOy3",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u975E\u7A7A\u503C"}]})});return;default:return}},H=[],u=t=>{_({type:"array",validator(n,g){if(!!g)return g.every(V=>V.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/g))?Promise.resolve():Promise.reject(a.formatMessage({id:"TFEmmD",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"}]}))}})};function p(){var n;const t=L.getFieldsValue();t.headers=(n=t.headers)==null?void 0:n.filter(g=>g.key!=null),j.post("/checkDBConn",{sourceType:3,config:t}).then(g=>{g!=null&&g.status?U.success(a.formatMessage({id:"JDIfhr",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u6210\u529F"}]})):U.error((g==null?void 0:g.msg)||a.formatMessage({id:"9yQugt",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u5931\u8D25"}]}))})}const o=t=>{L.setFieldValue("loadSchemaFromString",t)};return s?l(v,{children:[F==="detail"?l(v,{children:[e("div",{className:"flex mb-8 justify-center",children:l(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]}),e(A,{title:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})})]})}),className:"justify-start",children:i.apiNameSpace}),e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"oyIdrj",defaultMessage:[{type:0,value:"Graphql \u7AEF\u70B9"}]}),e(A,{title:a.formatMessage({id:"oyIdrj",defaultMessage:[{type:0,value:"Graphql \u7AEF\u70B9"}]})})]})}),className:"justify-start",children:i.url}),i!=null&&i.loadSchemaFromString?l(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"CVx5RX",defaultMessage:[{type:0,value:"\u6307\u5B9ASchema"}]}),e(A,{title:a.formatMessage({id:"CVx5RX",defaultMessage:[{type:0,value:"\u6307\u5B9ASchema"}]})})]})}),className:"justify-start",children:[e("img",{alt:"wenjian1",src:"assets/iconfont/wenjian1.svg",style:{height:"1em",width:"1em"}})," ",i.loadSchemaFromString]}):""]})}),e("div",{className:"font-medium text-base mb-3 ml-3",children:a.formatMessage({id:"23wB4T",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u5934"}]})}),e("div",{className:`${S["table-contain"]} mb-8`,children:e(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((f=i==null?void 0:i.headers)!=null?f:[]).map(({key:t="",kind:n="",val:g=""})=>e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[t,e(A,{title:t})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:fe(n)}),e("div",{className:"flex-1 ml-2 min-w-0",children:g})]})},t))})}),e(de,{ghost:!0,bordered:!1,defaultActiveKey:["1"],expandIcon:({isActive:t})=>e("img",{alt:"xiala",src:"assets/iconfont/xiala.svg",style:{height:"1em",width:"1em",transform:t?"":"rotate(-90deg)"}}),className:`${S["collapse-box"]} site-collapse-custom-collapse bg-light-50`,children:e(ee,{header:a.formatMessage({id:"lliahm",defaultMessage:[{type:0,value:"\u66F4\u591A\u8BBE\u7F6E"}]}),className:"site-collapse-custom-panel",children:e("div",{className:"flex mb-8 justify-center",children:l(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"unbHGZ",defaultMessage:[{type:0,value:"\u662F\u5426\u5185\u90E8"}]}),e(A,{title:a.formatMessage({id:"unbHGZ",defaultMessage:[{type:0,value:"\u662F\u5426\u5185\u90E8"}]})})]})}),className:"justify-start",children:i.internal?e(ve,{color:"green",children:a.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"\u5F00\u542F"}]})}):e(ve,{color:"red",children:a.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"\u5173\u95ED"}]})})}),e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"dUiZuI",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"}]}),e(A,{title:a.formatMessage({id:"dUiZuI",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"}]})})]})}),className:"justify-start",children:i.customFloatScalars}),e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"qJFIkj",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"}]}),e(A,{title:a.formatMessage({id:"qJFIkj",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"}]})})]})}),className:"justify-start",children:i.customIntScalars}),e(b.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"Eaqhfe",defaultMessage:[{type:0,value:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"}]}),e(A,{title:a.formatMessage({id:"Eaqhfe",defaultMessage:[{type:0,value:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"}]})})]})}),className:"justify-start",children:i.skipRenameRootFields})]})})},"1")})]}):e(v,{children:l("div",{className:"rounded-xl mb-4 py-6",children:[l(r,{form:L,name:"basic",labelCol:{span:4},wrapperCol:{span:10},onFinish:t=>void se(t),onFinishFailed:ue,autoComplete:"off",validateTrigger:["onBlur","onChange"],className:"ml-3",labelAlign:"right",initialValues:{apiNameSpace:i.apiNameSpace,url:i.url,loadSchemaFromString:i.loadSchemaFromString,internal:i.internal,customFloatScalars:i.customFloatScalars,customIntScalars:i.customIntScalars,skipRenameRootFields:i.skipRenameRootFields,headers:i.headers||[],agreement:!0},children:[e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]}),":",e(A,{title:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})})]})}),colon:!1,style:{marginBottom:"20px"},name:"apiNameSpace",rules:[{required:!0,message:a.formatMessage({id:"mfZMW6",defaultMessage:[{type:0,value:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:a.formatMessage({id:"VmsX4o",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}]})}],children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"oyIdrj",defaultMessage:[{type:0,value:"Graphql \u7AEF\u70B9"}]}),":",e(A,{title:a.formatMessage({id:"oyIdrj",defaultMessage:[{type:0,value:"Graphql \u7AEF\u70B9"}]})})]})}),colon:!1,required:!0,rules:[{required:!0,message:a.formatMessage({id:"hF6ZoL",defaultMessage:[{type:0,value:"\u7AEF\u70B9\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:C,message:a.formatMessage({id:"io7fqu",defaultMessage:[{type:0,value:"\u8BF7\u586B\u5199\u89C4\u8303\u57DF\u540D"}]})}],style:{marginBottom:"20px"},name:"url",children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{name:"agreement",label:" ",valuePropName:"checked",children:e(na,{onChange:()=>{y(!$)},children:a.formatMessage({id:"jUwANU",defaultMessage:[{type:0,value:"\u901A\u8FC7\u53D1\u9001\u6307\u4EE4,\u81EA\u52A8\u5185\u7701Schema"}]})})}),$?"":e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"CVx5RX",defaultMessage:[{type:0,value:"\u6307\u5B9ASchema"}]}),":",e(A,{title:a.formatMessage({id:"CVx5RX",defaultMessage:[{type:0,value:"\u6307\u5B9ASchema"}]})})]})}),colon:!1,name:"loadSchemaFromString",required:!0,style:{marginBottom:"48px"},children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),onClick:()=>T(!0),suffix:e("a",{onClick:()=>T(!0),children:a.formatMessage({id:"qVDSm2",defaultMessage:[{type:0,value:"\u6D4F\u89C8"}]})}),readOnly:!0})}),l("div",{className:"text-lg mb-3 ml-3",children:[a.formatMessage({id:"23wB4T",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u5934"}]}),":"]}),e(r.Item,{wrapperCol:{span:24},children:e(r.List,{name:"headers",children:(t,{add:n,remove:g},{errors:V})=>l(v,{children:[t.map((w,Y)=>l(me,{align:"baseline",style:{display:"flex"},children:[e(r.Item,{className:"w-52.5",name:[w.name,"key"],children:e(qe,{options:Sa,filterOption:(X,ae)=>{var le;return((le=ae==null?void 0:ae.label)!=null?le:"").includes(X)},placeholder:a.formatMessage({id:"23wB4T",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u5934"}]})})}),e(r.Item,{className:"w-40",name:[w.name,"kind"],children:l(R,{onChange:te,children:[l(O,{value:"0",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:fe("0")}),a.formatMessage({id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})]}),l(O,{value:"1",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:fe("1")}),a.formatMessage({id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})]}),l(O,{value:"2",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:fe("2")}),a.formatMessage({id:"6UDCIR",defaultMessage:[{type:0,value:"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"}]})]})]})}),e(r.Item,{className:"flex-0 w-135",name:[w.name,"val"],rules:L.getFieldValue(["headers",w.name,"kind"])==="0"?[{pattern:/^.{1,2000}$/g,message:a.formatMessage({id:"mPmxv/",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E2000\u7684\u975E\u7A7A\u503C"}]})}]:[],children:L.getFieldValue(["headers",w.name,"kind"])==="0"?e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(R,{className:"w-1/5",style:{width:"80%"},options:z,value:K,onChange:X=>c(X)})}),e(ne,{alt:"\u6E05\u9664",width:14,height:14,preview:!1,src:"/assets/clear.png",className:"cursor-pointer",onClick:()=>g(Y)})]},w.key)),l(r.Item,{wrapperCol:{span:16},children:[e(P,{type:"dashed",onClick:()=>{d(!0),n({kind:"0"})},icon:e(Ue,{}),className:"text-gray-500/60 w-1/1",children:a.formatMessage({id:"ZRU2jE",defaultMessage:[{type:0,value:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}]})}),e(r.ErrorList,{errors:V})]})]})})}),e(de,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:t})=>e(Ne,{rotate:t?90:0}),className:`${S["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:l(ee,{header:a.formatMessage({id:"lliahm",defaultMessage:[{type:0,value:"\u66F4\u591A\u8BBE\u7F6E"}]}),className:"site-collapse-custom-panel",children:[e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"unbHGZ",defaultMessage:[{type:0,value:"\u662F\u5426\u5185\u90E8"}]}),e(A,{title:a.formatMessage({id:"unbHGZ",defaultMessage:[{type:0,value:"\u662F\u5426\u5185\u90E8"}]})})]})}),valuePropName:"checked",name:"internal",colon:!1,style:{marginBottom:"20px"},children:e(Fe,{className:S["switch-edit-btn"],size:"small"})}),e(r.Item,{label:e("div",{className:"",children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"dUiZuI",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"}]}),e(A,{title:a.formatMessage({id:"dUiZuI",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"}]})})]})}),name:"customFloatScalars",rules:[k],colon:!1,style:{marginBottom:"20px"},children:e(R,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:H})}),e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"qJFIkj",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"}]}),e(A,{title:a.formatMessage({id:"qJFIkj",defaultMessage:[{type:0,value:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"}]})})]})}),name:"customIntScalars",rules:[k],colon:!1,style:{marginBottom:"20px"},children:e(R,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:H})}),e(r.Item,{label:e("div",{children:l("span",{className:S["label-style"],children:[a.formatMessage({id:"Eaqhfe",defaultMessage:[{type:0,value:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"}]}),e(A,{title:a.formatMessage({id:"Eaqhfe",defaultMessage:[{type:0,value:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"}]})})]})}),colon:!1,style:{marginBottom:"20px"},name:"skipRenameRootFields",rules:[k],children:e(R,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:H})})]},"1")})]}),e(r.Item,{wrapperCol:{offset:3,span:16},children:l("div",{className:"flex mt-5 w-40 justify-center items-center",children:[e(P,{className:"btn-cancel ml-4",onClick:()=>{s.id?x("detail",s.id,s.sourceType):q("/workbench/data-source/new")},children:e("span",{children:a.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"\u53D6\u6D88"}]})})}),e(P,{className:"btn-test ml-4",onClick:()=>{p()},children:a.formatMessage({id:"mPsm6o",defaultMessage:[{type:0,value:"\u6D4B\u8BD5"}]})}),e(P,{className:"btn-save ml-4",onClick:()=>{L.submit()},children:s.name==""?a.formatMessage({id:"BtZh7z",defaultMessage:[{type:0,value:"\u521B\u5EFA"}]}):a.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})})]})}),e(oe,{className:S.modal,title:null,footer:null,open:D,onOk:()=>T(!1),onCancel:()=>T(!1),width:920,children:e(Ae,{basePath:Ia,setUploadPath:o,setVisible:T,upType:3,beforeUpload:t=>{console.log(t.name);const n=t.name.endsWith(".graphql");return n||U.error(a.formatMessage({id:"CP8WcX",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u4E0A\u4F20 graphql \u683C\u5F0F\u6587\u4EF6"}]})),n||Me.LIST_IGNORE}})}),e(oe,{title:"GraphiQL",open:W,onOk:()=>I(!1),onCancel:()=>I(!1),footer:null,centered:!0,bodyStyle:{height:"90vh"},width:"90vw"})]}):e(De,{})}const _a="_modal_4l36t_42",J={"switch-check-btn":"_switch-check-btn_4l36t_1","switch-edit-btn":"_switch-edit-btn_4l36t_7","form-icon":"_form-icon_4l36t_13","connect-check-btn-common":"_connect-check-btn-common_4l36t_17","table-contain":"_table-contain_4l36t_27","redoc-container":"_redoc-container_4l36t_30",modal:_a},ge=s=>e(ne,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[s]}),Va="/static/upload/oas",{TabPane:Ra}=Ce;function qa({content:s,type:F}){var o,f;const a=ce(),q=ye(),{handleToggleDesigner:i,handleSave:N}=m.exports.useContext(ie),[x]=r.useForm();B(!1);const[k,_]=B(!1);B(1);const[$,y]=B({});B(!0);const[W,I]=B(!0),[Q,d]=m.exports.useState([]),[z,G]=B([]),[K,c]=B(""),[D,T]=B(!1),L=t=>{x.setFieldValue("filePath",t),x.validateFields(["filePath"]),O(t)},O=t=>{We.get(`/api/v1/file/downloadFile?type=${1}&fileName=${encodeURIComponent(t)}`).then(n=>{var V,w,Y;const g=(V=ma(n,"data.servers"))!=null?V:[];x.getFieldValue("baseURL")||x.setFieldsValue({baseURL:(Y=(w=g[0])==null?void 0:w.url)!=null?Y:""}),d(g.map(X=>{var ae,le;return{label:(ae=X==null?void 0:X.url)!=null?ae:"",value:(le=X==null?void 0:X.url)!=null?le:""}}))}).catch(n=>{console.error(n),d([])})};m.exports.useEffect(()=>{var t,n;x.resetFields(),F==="form"&&((t=s==null?void 0:s.config)==null?void 0:t.filePath)&&O((n=s==null?void 0:s.config)==null?void 0:n.filePath)},[s,F]),m.exports.useEffect(()=>{we("/env").then(t=>t.filter(n=>n.isDel===0).map(n=>({label:n.key,value:n.key}))).then(t=>G(t))},[]);const ee=t=>{c(t)};if(!s)return e(De,{});const C=s.config,se=t=>{var n,g;switch(t){case"0":I(!0),y({pattern:/^.{1,128}$/g,message:a.formatMessage({id:"BX00L6",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]})});return;case"1":I(!1),c((g=(n=z.at(0))==null?void 0:n.label)!=null?g:"");return;case"2":I(!0),y({pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:a.formatMessage({id:"TFEmmD",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"}]})});return;default:return}},ue=async t=>{var V;t.headers=(V=t.headers)==null?void 0:V.filter(w=>w.key!=null);const n={...t};let g;if(s.id)g={...s,config:n,name:t.apiNameSpace},await j.put("/dataSource",g);else{const w={...s,config:n,name:t.apiNameSpace},Y=await j.post("/dataSource",w);s.id=Y,g=s}N(g)},te=t=>{throw U.error(a.formatMessage({id:"NzT9mX",defaultMessage:[{type:0,value:"\u63D0\u4EA4\u5931\u8D25"}]})),t},{Option:H}=R,{Panel:u}=de,p=t=>{t==="1"&&(I(!0),y({pattern:/^.{1,128}$/g,message:a.formatMessage({id:"BX00L6",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]})}))};return x.getFieldValue("jwtType"),l(v,{children:[e(oe,{className:J.modal,title:null,footer:null,open:D,onOk:()=>T(!1),onCancel:()=>T(!1),width:920,children:e(Ae,{basePath:Va,setUploadPath:L,setVisible:T,upType:1,beforeUpload:t=>{const n=t.name.endsWith(".json")||t.name.endsWith(".yaml")||t.name.endsWith(".yml");return n||U.error(a.formatMessage({id:"2P6VLX",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u4E0A\u4F20 json \u6216 yaml \u683C\u5F0F\u6587\u4EF6"}]})),n||Me.LIST_IGNORE}})}),F==="detail"?l(v,{children:[e("div",{className:"flex mb-8 justify-center",children:l(b,{bordered:!0,column:1,size:"small",className:J["descriptions-box"],children:[e(b.Item,{label:e(v,{children:l("span",{className:J["label-style"],children:[a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})," ",e(A,{title:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})})]})}),className:"justify-start",children:C.apiNameSpace}),e(b.Item,{label:e(v,{children:l("span",{className:J["label-style"],children:[a.formatMessage({id:"jPMqvu",defaultMessage:[{type:0,value:"\u6307\u5B9A OAS"}]}),e(A,{title:a.formatMessage({id:"jPMqvu",defaultMessage:[{type:0,value:"\u6307\u5B9A OAS"}]})})]})}),children:l("div",{className:"flex items-center",children:[e(ne,{src:"/assets/upload-file.png",width:14,height:14,alt:"\u6587\u4EF6",preview:!1}),e("span",{className:"ml-2 text-11px text-[#909399]",children:C.filePath})]})}),e(b.Item,{label:e(v,{children:l("span",{className:J["label-style"],children:[a.formatMessage({id:"1Y05V3",defaultMessage:[{type:0,value:"Rest \u7AEF\u70B9"}]}),e(A,{title:a.formatMessage({id:"1Y05V3",defaultMessage:[{type:0,value:"Rest \u7AEF\u70B9"}]})})]})}),className:"justify-start",children:C.baseURL})]})}),e("div",{className:"tabs-form",children:e(Ce,{defaultActiveKey:"1",items:[{key:"1",label:a.formatMessage({id:"23wB4T",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u5934"}]}),children:e(b,{className:"mb-8",bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((o=C==null?void 0:C.headers)!=null?o:[]).map(({key:t="",kind:n="",val:g=""})=>e(b.Item,{label:e("div",{children:l("span",{className:J["label-style"],children:[t,e(A,{title:t})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:ge(n)}),e("div",{className:"flex-1 ml-2 min-w-0",children:g})]})},t))})}]})}),e(de,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:t})=>e(Ne,{rotate:t?90:0}),className:`${J["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:e(u,{header:a.formatMessage({id:"lliahm",defaultMessage:[{type:0,value:"\u66F4\u591A\u8BBE\u7F6E"}]}),className:"site-collapse-custom-panel",children:e(b,{bordered:!0,column:1,size:"small",children:e(b.Item,{label:e("span",{className:J["label-style"],children:a.formatMessage({id:"BbdcOe",defaultMessage:[{type:0,value:"\u662F\u5426\u72B6\u6001\u8054\u5408"}]})}),className:"justify-start",children:C.statusCodeUnions?e(ve,{color:"green",children:a.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"\u5F00\u542F"}]})}):e(ve,{color:"red",children:a.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"\u5173\u95ED"}]})})})})},"1")}),e(oe,{centered:!0,open:k,onCancel:()=>_(!1),destroyOnClose:!0,width:"80%",bodyStyle:{height:"885px",overflow:"auto"},footer:null,children:e("div",{className:J["redoc-container"],children:k&&C.filePath&&e("iframe",{title:"rapi",src:`/#/rapi-frame?url=/upload/oas/${(f=C.filePath)!=null?f:""}`,width:"100%",height:"100%",className:"border-none"})})})]}):e(v,{children:e("div",{className:"rounded-xl mb-4 py-6",children:l(r,{form:x,name:"basic",labelCol:{span:3},wrapperCol:{span:11},onFinish:t=>ue(t),onFinishFailed:te,autoComplete:"off",validateTrigger:["onBlur","onChange"],labelAlign:"right",className:"ml-3",initialValues:{apiNameSpace:C.apiNameSpace,baseURL:C.baseURL,headers:C.headers||[],statusCodeUnions:C.statusCodeUnions,secret:C.secret||{kind:"0"},filePath:C.filePath||"",tokenPoint:C.tokenPoint,jwtType:C.jwtType},children:[e(r.Item,{label:l(v,{children:[e("span",{children:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})}),e(A,{title:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]})})]}),rules:[{required:!0,message:a.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u540D\u79F0"}]})},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:a.formatMessage({id:"TFEmmD",defaultMessage:[{type:0,value:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"}]})}],name:"apiNameSpace",colon:!1,style:{marginBottom:"20px"},children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(r.Item,{rules:[{required:!0,message:a.formatMessage({id:"1GUffX",defaultMessage:[{type:0,value:"\u8BF7\u4E0A\u4F20 OAS \u6587\u4EF6"}]})}],label:l(v,{children:[e("span",{children:a.formatMessage({id:"jPMqvu",defaultMessage:[{type:0,value:"\u6307\u5B9A OAS"}]})}),e(A,{title:a.formatMessage({id:"Bjvcv9",defaultMessage:[{type:0,value:"\u6307\u5B9AOAS"}]})})]}),colon:!1,name:"filePath",style:{marginBottom:"20px"},children:e(E,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),onClick:()=>T(!0),suffix:e("a",{onClick:()=>T(!0),children:a.formatMessage({id:"qVDSm2",defaultMessage:[{type:0,value:"\u6D4F\u89C8"}]})}),readOnly:!0})}),e(r.Item,{label:l(v,{children:[e("span",{children:a.formatMessage({id:"1Y05V3",defaultMessage:[{type:0,value:"Rest \u7AEF\u70B9"}]})}),e(A,{title:a.formatMessage({id:"1Y05V3",defaultMessage:[{type:0,value:"Rest \u7AEF\u70B9"}]})})]}),rules:[{required:!0,type:"url",message:a.formatMessage({id:"qVqrPb",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u8F93\u5165\u94FE\u63A5"}]})}],name:"baseURL",colon:!1,style:{marginBottom:"20px"},children:e(qe,{options:Q,filterOption:(t,n)=>!0,placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e("div",{className:"tabs-form",children:e(Ce,{defaultActiveKey:"1",className:"ml-3",onChange:p,children:e(Ra,{tab:a.formatMessage({id:"23wB4T",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u5934"}]}),children:e(r.Item,{wrapperCol:{xs:{span:24},sm:{span:24}},children:e(r.List,{name:"headers",children:(t,{add:n,remove:g},{errors:V})=>l(v,{children:[t.map((w,Y)=>l(me,{align:"baseline",children:[e(r.Item,{className:"w-52.5",wrapperCol:{span:24},name:[w.name,"key"],children:e(E,{})}),e(r.Item,{className:"w-40",wrapperCol:{span:24},name:[w.name,"kind"],children:l(R,{onChange:se,children:[e(H,{value:"0",children:l(me,{children:[e("span",{children:ge("0")}),a.formatMessage({id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})]})}),e(H,{value:"1",children:l(me,{children:[e("span",{children:ge("1")}),a.formatMessage({id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})]})}),e(H,{value:"2",children:l(me,{children:[e("span",{children:ge("2")}),a.formatMessage({id:"6UDCIR",defaultMessage:[{type:0,value:"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"}]})]})})]})}),e(r.Item,{className:"w-135",wrapperCol:{span:24},name:[w.name,"val"],rules:x.getFieldValue(["headers",w.name,"kind"])==="0"?[{pattern:/^.{1,128}$/g,message:a.formatMessage({id:"BX00L6",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]})}]:[],children:x.getFieldValue(["headers",w.name,"kind"])==="0"?e(E,{style:{width:"80%"},placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(R,{className:"w-1/5",style:{width:"80%"},options:z,value:K,onChange:ee})}),e("img",{alt:"guanbi",src:"assets/iconfont/guanbi.svg",style:{height:"1em",width:"1em"},onClick:()=>g(Y)})]},w.key)),l(r.Item,{wrapperCol:{span:16},children:[e(P,{type:"dashed",onClick:()=>{I(!0),n({kind:"0"})},icon:e(Ue,{}),className:"text-gray-500/60 w-1/1",children:a.formatMessage({id:"ZRU2jE",defaultMessage:[{type:0,value:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}]})}),e(r.ErrorList,{errors:V})]})]})})})},"1")})}),e(de,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:t})=>e(Ne,{rotate:t?90:0}),children:e(u,{header:a.formatMessage({id:"0D60ha",defaultMessage:[{type:0,value:"\u66F4\u591A"}]}),className:"site-collapse-custom-panel",children:e(r.Item,{label:e(v,{children:l("span",{className:J["label-style"],children:[a.formatMessage({id:"BbdcOe",defaultMessage:[{type:0,value:"\u662F\u5426\u72B6\u6001\u8054\u5408"}]}),e(A,{title:a.formatMessage({id:"BbdcOe",defaultMessage:[{type:0,value:"\u662F\u5426\u72B6\u6001\u8054\u5408"}]})})]})}),name:"statusCodeUnions",colon:!1,style:{marginBottom:0},valuePropName:"checked",children:e(Fe,{className:J["switch-edit-btn"],size:"small"})})},"1")}),e(r.Item,{wrapperCol:{offset:3,span:16},children:l("div",{className:"flex mt-10 w-160px justify-center items-center",children:[e(P,{className:"btn-cancel  ml-4",onClick:()=>{s.id?i("detail",s.id,s.sourceType):q("/workbench/data-source/new")},children:e("span",{children:a.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"\u53D6\u6D88"}]})})}),e(P,{className:"btn-save ml-4",onClick:()=>x.submit(),children:s.name==""?a.formatMessage({id:"BtZh7z",defaultMessage:[{type:0,value:"\u521B\u5EFA"}]}):a.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})})]})})})]})}function Oa({content:s,showType:F}){const{handleSave:a}=m.exports.useContext(ie),q=ce(),{mutate:i}=Ke(),{handleToggleDesigner:N}=m.exports.useContext(ie),{onRefreshMenu:x}=m.exports.useContext(Re),[k,_]=Qe.useState(!1),$=ye(),{loading:y,fun:W}=ea(async()=>{if(!!s){if(s){const d={...s,switch:s.switch^1};await j.put("/dataSource",d),a(d)}s.sourceType===4&&sa(`customize/${s.name}`,!!s.switch)}},[s]);if(!s)return null;let I="/assets/icon/db-other.svg";switch(s==null?void 0:s.sourceType){case 1:I={mysql:"/assets/icon/mysql.svg",pgsql:"/assets/icon/pg.svg",graphql:"/assets/icon/graphql.svg",mongodb:"/assets/icon/mongodb.svg",rest:"/assets/icon/rest.svg",sqlite:"/assets/icon/sqlite.svg"}[String(s.config.dbType).toLowerCase()]||I;break;case 2:I="/assets/icon/rest.svg";break;case 3:I="/assets/icon/graphql.svg";break}const Q=async d=>{if(!d.match(/^\w[a-zA-Z0-9_]*$/)){U.error(q.formatMessage({id:"0o/d0Y",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u5B57\u6BCD\u3001\u6570\u5B57\u6216\u4E0B\u5212\u7EBF"}]}));return}const z={...s,name:d};await j.put("/dataSource",z),x("dataSource"),_(!1),await i(["/dataSource",String(s.id)])};return l("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",l("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[F==="setting"?l(v,{children:[l("div",{className:"cursor-pointer flex bg-[#F9F9F9FF] mr-6 py-0.5 px-2 items-center justify-evenly",onClick:()=>N("detail"),children:[e(ne,{width:12,height:7,src:"/assets/back.svg",alt:"\u8FD4\u56DE",preview:!1}),e("span",{className:"ml-1",children:e(pe,{id:"NGs9sO",defaultMessage:[{type:0,value:"\u8FD4\u56DE"}]})})]}),e("div",{className:"font-medium",children:e(pe,{id:"aUe2XA",defaultMessage:[{type:0,value:"\u9AD8\u7EA7\u8BBE\u7F6E"}]})})]}):l(v,{children:[e("img",{className:"h-14px mr-1.5 w-14px",src:I,alt:"\u6570\u636E\u6E90"}),F==="detail"?k?e(E,{onBlur:d=>Q(d.target.value),onPressEnter:d=>Q(d.target.value),style:{width:"200px"},defaultValue:s==null?void 0:s.name,autoFocus:!0,placeholder:q.formatMessage({id:"8AtCIp",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90\u540D"}]})}):l(v,{children:[s==null?void 0:s.name,e("span",{onClick:()=>_(!0),className:"cursor-pointer ml-3",children:e("img",{alt:"bianji",src:"assets/iconfont/bianji.svg",style:{height:"1em",width:"1em"}})})]}):(s==null?void 0:s.name)||q.formatMessage({id:"UmVV8s",defaultMessage:[{type:0,value:"\u65B0\u5EFA\u6570\u636E\u6E90"}]})]}),e("div",{className:"flex-1"}),F==="detail"?l(v,{children:[s.sourceType!==4?e(Fe,{loading:y,checked:(s==null?void 0:s.switch)===1,checkedChildren:q.formatMessage({id:"ZUPzqr",defaultMessage:[{type:0,value:"\u5F00\u542F"}]}),unCheckedChildren:q.formatMessage({id:"47GdDb",defaultMessage:[{type:0,value:"\u5173\u95ED"}]}),onChange:W,className:"!mr-4"}):null,s.sourceType===1?e(P,{className:"btn-test !ml-4",onClick:()=>$(`/workbench/modeling/${s==null?void 0:s.id}`),children:e(pe,{id:"esvors",defaultMessage:[{type:0,value:"\u8BBE\u8BA1"}]})}):e(v,{}),s.sourceType!==4?e(v,{children:e(P,{className:"btn-save !ml-4 mr-11",onClick:()=>N("form"),children:e(pe,{id:"CLqPBU",defaultMessage:[{type:0,value:"\u7F16\u8F91"}]})})}):e(v,{})]}):null]}),e("div",{className:"bg-white  flex-1 mx-3 mt-3 min-h-0 px-8 pt-5 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:s.sourceType===1?e(xa,{content:s,type:F}):s.sourceType===2?e(qa,{content:s,type:F}):s.sourceType===3?e(Ta,{content:s,type:F}):s.sourceType===4?e(ya,{content:s}):e(v,{})})]})}function $s(){const{showType:s,content:F}=m.exports.useContext(ie);return e(Oa,{showType:s,content:F})}export{$s as default};
