import{c as le,aV as ie,d as H,r as l,e as ne,f as P,aT as ce,bG as de,dQ as me,ac as ue,dv as pe,dR as fe,bT as ge,d5 as he,cT as be,c6 as xe,c7 as ve,dS as ye,K as L,j as t,ad as M,Q as w,u as Ce,ag as j,a4 as Se,W as je,V as E,k as _,a7 as Ie,X as Me}from"./index-e23f2223.js";import{i as V}from"./use-immer.module-4cb1830e.js";import{g as $}from"./variable-91e6e252.js";import{D as C}from"./index-10d51d42.js";import{I as N}from"./index-a73efee4.js";import{u as we}from"./validate-f9ecd65f.js";import{W as $e}from"./workbenchContext-b49089c6.js";import{u as Ne}from"./lock-6df64501.js";import{S as z}from"./index-61965600.js";import"./common-7ac8785d.js";import"./useBreakpoint-b69ed978.js";import"./useForceUpdate-b3b49820.js";import"./index-ea05c07e.js";import"./index-27b087ac.js";import"./useShowArrow-12d59a8d.js";import"./index-7fdf62f6.js";import"./DownOutlined-a9c475b8.js";import"./PurePanel-08b7f9fd.js";import"./index-8823ff70.js";const k=(e,s,o,r,a)=>({background:e,border:`${H(r.lineWidth)} ${r.lineType} ${s}`,[`${a}-icon`]:{color:o}}),ke=e=>{const{componentCls:s,motionDurationSlow:o,marginXS:r,marginSM:a,fontSize:c,fontSizeLG:n,lineHeight:p,borderRadiusLG:f,motionEaseInOutCirc:u,withDescriptionIconSize:v,colorText:S,colorTextHeading:y,withDescriptionPadding:d,defaultPadding:m}=e;return{[s]:Object.assign(Object.assign({},ie(e)),{position:"relative",display:"flex",alignItems:"center",padding:m,wordWrap:"break-word",borderRadius:f,[`&${s}-rtl`]:{direction:"rtl"},[`${s}-content`]:{flex:1,minWidth:0},[`${s}-icon`]:{marginInlineEnd:r,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:p},"&-message":{color:y},[`&${s}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${o} ${u}, opacity ${o} ${u},
        padding-top ${o} ${u}, padding-bottom ${o} ${u},
        margin-bottom ${o} ${u}`},[`&${s}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${s}-with-description`]:{alignItems:"flex-start",padding:d,[`${s}-icon`]:{marginInlineEnd:a,fontSize:v,lineHeight:0},[`${s}-message`]:{display:"block",marginBottom:r,color:y,fontSize:n},[`${s}-description`]:{display:"block",color:S}},[`${s}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},_e=e=>{const{componentCls:s,colorSuccess:o,colorSuccessBorder:r,colorSuccessBg:a,colorWarning:c,colorWarningBorder:n,colorWarningBg:p,colorError:f,colorErrorBorder:u,colorErrorBg:v,colorInfo:S,colorInfoBorder:y,colorInfoBg:d}=e;return{[s]:{"&-success":k(a,r,o,e,s),"&-info":k(d,y,S,e,s),"&-warning":k(p,n,c,e,s),"&-error":Object.assign(Object.assign({},k(v,u,f,e,s)),{[`${s}-description > pre`]:{margin:0,padding:0}})}}},Ee=e=>{const{componentCls:s,iconCls:o,motionDurationMid:r,marginXS:a,fontSizeIcon:c,colorIcon:n,colorIconHover:p}=e;return{[s]:{"&-action":{marginInlineStart:a},[`${s}-close-icon`]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:c,lineHeight:H(c),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${o}-close`]:{color:n,transition:`color ${r}`,"&:hover":{color:p}}},"&-close-text":{color:n,transition:`color ${r}`,"&:hover":{color:p}}}}},Pe=e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:`${e.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${e.paddingMD}px ${e.paddingContentHorizontalLG}px`}),Le=le("Alert",e=>[ke(e),_e(e),Ee(e)],Pe);var A=globalThis&&globalThis.__rest||function(e,s){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&s.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)s.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(o[r[a]]=e[r[a]]);return o};const Fe={success:pe,info:fe,error:ge,warning:he},Be=e=>{const{icon:s,prefixCls:o,type:r}=e,a=Fe[r]||null;return s?me(s,l.createElement("span",{className:`${o}-icon`},s),()=>({className:P(`${o}-icon`,{[s.props.className]:s.props.className})})):l.createElement(a,{className:`${o}-icon`})},De=e=>{const{isClosable:s,prefixCls:o,closeIcon:r,handleClose:a,ariaProps:c}=e,n=r===!0||r===void 0?l.createElement(ue,null):r;return s?l.createElement("button",Object.assign({type:"button",onClick:a,className:`${o}-close-icon`,tabIndex:0},c),n):null},Oe=e=>{const{description:s,prefixCls:o,message:r,banner:a,className:c,rootClassName:n,style:p,onMouseEnter:f,onMouseLeave:u,onClick:v,afterClose:S,showIcon:y,closable:d,closeText:m,closeIcon:h,action:B}=e,W=A(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action"]),[D,U]=l.useState(!1),G=l.useRef(null),{getPrefixCls:K,direction:Q,alert:i}=l.useContext(ne),g=K("alert",o),[X,Z,Y]=Le(g),J=b=>{var x;U(!0),(x=e.onClose)===null||x===void 0||x.call(e,b)},O=l.useMemo(()=>e.type!==void 0?e.type:a?"warning":"info",[e.type,a]),ee=l.useMemo(()=>typeof d=="object"&&d.closeIcon||m?!0:typeof d=="boolean"?d:h!==!1&&h!==null&&h!==void 0?!0:!!(i!=null&&i.closable),[m,h,d,i==null?void 0:i.closable]),T=a&&y===void 0?!0:y,se=P(g,`${g}-${O}`,{[`${g}-with-description`]:!!s,[`${g}-no-icon`]:!T,[`${g}-banner`]:!!a,[`${g}-rtl`]:Q==="rtl"},i==null?void 0:i.className,c,n,Y,Z),te=ce(W,{aria:!0,data:!0}),oe=l.useMemo(()=>{var b,x;return typeof d=="object"&&d.closeIcon?d.closeIcon:m||(h!==void 0?h:typeof(i==null?void 0:i.closable)=="object"&&(!((b=i==null?void 0:i.closable)===null||b===void 0)&&b.closeIcon)?(x=i==null?void 0:i.closable)===null||x===void 0?void 0:x.closeIcon:i==null?void 0:i.closeIcon)},[h,d,m,i==null?void 0:i.closeIcon]),re=l.useMemo(()=>{const b=d??(i==null?void 0:i.closable);return typeof b=="object"?A(b,["closeIcon"]):{}},[d,i==null?void 0:i.closable]);return X(l.createElement(de,{visible:!D,motionName:`${g}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:b=>({maxHeight:b.offsetHeight}),onLeaveEnd:S},b=>{let{className:x,style:ae}=b;return l.createElement("div",Object.assign({ref:G,"data-show":!D,className:P(se,x),style:Object.assign(Object.assign(Object.assign({},i==null?void 0:i.style),p),ae),onMouseEnter:f,onMouseLeave:u,onClick:v,role:"alert"},te),T?l.createElement(Be,{description:s,icon:e.icon,prefixCls:g,type:O}):null,l.createElement("div",{className:`${g}-content`},r?l.createElement("div",{className:`${g}-message`},r):null,s?l.createElement("div",{className:`${g}-description`},s):null),B?l.createElement("div",{className:`${g}-action`},B):null,l.createElement(De,{isClosable:ee,prefixCls:g,closeIcon:oe,handleClose:J,ariaProps:re}))}))},q=Oe;let Te=function(e){function s(){var o;return ve(this,s),o=ye(this,s,arguments),o.state={error:void 0,info:{componentStack:""}},o}return be(s,e),xe(s,[{key:"componentDidCatch",value:function(r,a){this.setState({error:r,info:a})}},{key:"render",value:function(){const{message:r,description:a,children:c}=this.props,{error:n,info:p}=this.state,f=p&&p.componentStack?p.componentStack:null,u=typeof r>"u"?(n||"").toString():r,v=typeof a>"u"?f:a;return n?l.createElement(q,{type:"error",message:u,description:l.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},v)}):c}}])}(l.Component);const ze=Te,R=q;R.ErrorBoundary=ze;const Ae=R;l.createContext([]);l.createContext({});l.createContext({});const F=l.createContext({}),He=""+new URL("file-90b07208.svg",import.meta.url).href,Ve="_supportList_k47rm_86",qe="_supportItem_k47rm_96",I={"save-btn":"_save-btn_k47rm_1","center-btn":"_center-btn_k47rm_19","switch-check-btn":"_switch-check-btn_k47rm_27","ssl-open-btn":"_ssl-open-btn_k47rm_34","ssl-close-btn":"_ssl-close-btn_k47rm_47","switch-set-btn":"_switch-set-btn_k47rm_64","form-contain":"_form-contain_k47rm_71","panel-style":"_panel-style_k47rm_74","form-item-icon":"_form-item-icon_k47rm_81",supportList:Ve,supportItem:qe};function Re({content:e}){const s=L(),[o,r]=V(!1);return t.jsx(t.Fragment,{children:t.jsx("div",{className:"pr-110px",children:t.jsxs(C,{bordered:!0,column:1,size:"small",children:[t.jsx(C.Item,{label:s.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"名称"}]}),children:e==null?void 0:e.name}),t.jsx(C.Item,{label:s.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"服务地址"}]}),children:$(e==null?void 0:e.endpoint)}),t.jsx(C.Item,{label:s.formatMessage({id:"WfVg3t",defaultMessage:[{type:0,value:"APP ID"}]}),children:$(e==null?void 0:e.accessKeyID)}),t.jsx(C.Item,{label:s.formatMessage({id:"FYqDZK",defaultMessage:[{type:0,value:"APP Secret"}]}),children:$(e==null?void 0:e.secretAccessKey,{enableVisible:!0,visible:o,onVisibleChange:a=>{r(a)}})}),t.jsx(C.Item,{label:s.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"区域"}]}),children:$(e==null?void 0:e.bucketLocation)}),t.jsx(C.Item,{label:s.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"桶名称"}]}),children:$(e==null?void 0:e.bucketName)}),t.jsx(C.Item,{label:s.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"开启SSL"}]}),children:e!=null&&e.useSSL?t.jsx(M,{className:I["ssl-open-btn"],children:t.jsx(w,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):t.jsx(M,{className:I["ssl-close-btn"],children:t.jsx(w,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})})]})})})}const We=""+new URL("ali-d7c63952.png",import.meta.url).href,Ue=""+new URL("google-4099bb07.png",import.meta.url).href,Ge=""+new URL("minio-e7f537ea.png",import.meta.url).href,Ke=""+new URL("tencent-a92b2b75.png",import.meta.url).href,Qe=[{img:We,link:"https://help.aliyun.com/product/31815.html"},{img:Ke,link:"https://cloud.tencent.com/document/product/436"},{img:Ue,link:"https://cloud.google.com/storage/docs"},{img:Ge,link:"https://docs.min.io/docs/minio-quickstart-guide.html"}];function Xe({content:e,showErr:s}){console.log(e);const o=L(),{ruleMap:r}=we(),{handleSwitch:a}=l.useContext(F),c=Ce();l.useContext($e);const[n]=j.useForm(),[p,f]=l.useState(!1),u=Se(),{loading:v,fun:S}=Ne(async m=>{if(u!=null&&u.find(h=>h.name===m.name&&h.name!==(e==null?void 0:e.name))){E.error(o.formatMessage({id:"gZoAue",defaultMessage:[{type:0,value:"名称不能重复"}]}));return}e?await _.put("/storage",m):await _.post("/storage",m),await Ie(),c(`/workbench/storage/${m.name}`,{replace:!0}),a("detail",m.name)},[e,a,o,c,u]),y=m=>{E.error(o.formatMessage({id:"7MUg0d",defaultMessage:[{type:0,value:"保存失败！"}]}))},d=async()=>{f(!0);const m=n.getFieldsValue();try{await _.post("/storageClient/ping",m),E.success(o.formatMessage({id:"JDIfhr",defaultMessage:[{type:0,value:"连接成功"}]}))}catch{}f(!1)};return t.jsxs("div",{className:`${I["form-contain"]} flex`,children:[t.jsxs("div",{className:"flex-1",children:[s&&t.jsx("div",{className:"-mt-4 pb-4",children:t.jsx(Ae,{className:"w-full",message:t.jsx(w,{id:"p7ywbO",defaultMessage:[{type:0,value:"配置信息有误，无法连接，请修改后再试"}]}),type:"error"})}),t.jsxs(j,{form:n,name:"basic",labelCol:{span:7},wrapperCol:{span:17},onFinish:S,onFinishFailed:y,autoComplete:"off",validateTrigger:"onBlur",className:"ml-3",initialValues:{enabled:!0,...e},children:[t.jsx(j.Item,{name:"enabled",hidden:!0,valuePropName:"checked",children:t.jsx(z,{defaultChecked:!0})}),t.jsx(j.Item,{label:o.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"名称"}]}),rules:[{required:!0,message:o.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"请输入名称"}]})},...r.name],name:"name",children:t.jsx(je,{disabled:!!(e!=null&&e.name),placeholder:o.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]})})}),t.jsx(N,{formItemProps:{name:"endpoint",label:o.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"服务地址"}]})},required:!0,inputProps:{addonBefore:"http(s)://"}}),t.jsx(N,{formItemProps:{name:"accessKeyID",label:"App ID"},required:!0}),t.jsx(N,{formItemProps:{name:"secretAccessKey",label:"App Secret"},required:!0}),t.jsx(N,{formItemProps:{name:"bucketLocation",label:o.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"区域"}]})},required:!0}),t.jsx(N,{formItemProps:{name:"bucketName",label:o.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"桶名称"}]})},required:!0}),t.jsx(j.Item,{label:o.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"开启SSL"}]}),style:{marginTop:"29px"},name:"useSSL",valuePropName:"checked",children:t.jsx(z,{className:I["switch-set-btn"],size:"small"})}),t.jsxs(j.Item,{wrapperCol:{offset:7,span:17},children:[t.jsx(M,{className:"btn-cancel",onClick:()=>{if(!(e!=null&&e.name)){c(-1);return}a("detail",e==null?void 0:e.name)},children:t.jsx("span",{children:o.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})}),t.jsx(M,{className:"ml-4 btn-test",onClick:()=>d(),loading:p,children:t.jsx(w,{id:"mPsm6o",defaultMessage:[{type:0,value:"测试"}]})}),t.jsx(M,{loading:v,className:"ml-4 btn-save",onClick:()=>n.submit(),children:t.jsx(w,{id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]})})]})]})]}),t.jsxs("div",{className:`w-2/5 ${I.supportList}`,children:[t.jsx("div",{className:"title",children:o.formatMessage({id:"DzVs1L",defaultMessage:[{type:0,value:"我们支持"}]})}),Qe.map((m,h)=>t.jsx("a",{className:I.supportItem,href:m.link,target:"_blank",rel:"noreferrer",children:t.jsx("img",{src:m.img,alt:"",className:"w-40"})},h))]})]})}function Ze({content:e,showType:s,showErr:o}){const r=L(),{handleSwitch:a}=l.useContext(F);return t.jsxs("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[t.jsxs("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[t.jsx("img",{src:He,className:"h-14px mr-1.5 w-14px",alt:"文件"}),(e==null?void 0:e.name)||r.formatMessage({id:"32k+gD",defaultMessage:[{type:0,value:"创建文件存储"}]}),t.jsx("div",{className:"flex-1"}),s==="detail"?t.jsx(t.Fragment,{children:t.jsx(M,{className:"btn-save  ml-4 mr-11",onClick:()=>a("form",e==null?void 0:e.name),children:t.jsx(w,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})}):null]}),t.jsx("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 px-8 pt-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:s==="detail"?t.jsx(Re,{content:e}):s==="form"?t.jsx(Xe,{content:e,showErr:o}):""})]})}function bs(){const{name:e}=Me(),[s,o]=V("detail"),[r,a]=l.useState(),[c,n]=l.useState(!1);l.useEffect(()=>{if(e==="new"){o("form"),a(void 0),n(!1);return}else e===sessionStorage.getItem("storageError")?(sessionStorage.removeItem("storageError"),n(!0),o("form")):(n(!1),o("detail"))},[e,o]),l.useEffect(()=>{s==="detail"&&c&&n(!1),e!=="new"&&_.get(`/storage/${e}`).then(f=>{a(f)})},[e,c,s]);function p(f,u){o(f)}return t.jsx(t.Fragment,{children:t.jsx(F.Provider,{value:{handleSwitch:p},children:t.jsx(Ze,{showType:s,content:r,showErr:c})})})}export{bs as default};
