import{d as D,r as t,m as L,c as l,f as n,j as r}from"./index.e5e6c754.js";import"./iconUtil.31c13224.js";import"./index.5e1fa168.js";import{S as N}from"./index.daad23d2.js";import{c as I}from"./clsx.m.70024c70.js";import{a as k}from"./prismaRelation.3cb2ec20.js";import{s as d}from"./index.module.e663a310.js";import"./KeyCode.9c493596.js";import"./pickAttrs.c5bbb5fc.js";import"./Overflow.321ca619.js";import"./DownOutlined.75881d1e.js";import"./get.131f9f4f.js";import"./_baseGet.6a7418c9.js";import"./fireboom-prisma-ast.esm.6ae74454.js";import"./_createAggregator.87a98d7b.js";import"./_baseClone.e2094da0.js";import"./flatten.8e198855.js";import"./_baseSet.aed078ba.js";import"./uniq.2129c997.js";import"./_baseUniq.d23dbdee.js";import"./difference.6d57e3ed.js";import"./groupBy.88271069.js";function Z(p){const S=D(),[u,x]=t.exports.useState([]),[a,f]=t.exports.useState(),[o,g]=t.exports.useState(),[v,y]=t.exports.useState([]),[q,w]=t.exports.useState(""),[c,b]=t.exports.useState();t.exports.useEffect(()=>{C()},[]),t.exports.useEffect(()=>{h()},[a]);async function h(){var s;if(!a)return;const e=L.loading(S.formatMessage({id:"9YT9eI",defaultMessage:[{type:0,value:"\u6B63\u5728\u52A0\u8F7D\u6A21\u578B\u5217\u8868"}]}));try{const i=await l.get(`/prisma/nativeSDL/${a}`,{timeout:15e3});w(i);const m=await l.get(`/prisma/dmf/${a}`,{timeout:15e3});y(m.models||[]),g((s=m.models)==null?void 0:s[0]),b(k(m.schemaContent))}catch(i){console.error(i)}e()}t.exports.useEffect(()=>{!o||p.onSelectedModelChange(o,u.find(e=>e.id===a),v,c==null?void 0:c[o.name],q)},[o]);const C=async()=>{var s;const e=await l.get("/dataSource?datasourceType=1");x(e),(!(e!=null&&e.length)||(e==null?void 0:e.length)<=0)&&p.onEmpty(),e.find(i=>i.id===a)||f((s=e==null?void 0:e[0])==null?void 0:s.id)};return n("div",{className:"common-form "+d.sider,children:[n("div",{className:"flex w-full items-center",children:[r(N,{value:a,onChange:e=>{f(e)},className:"flex-1",options:u.map(e=>{let s="/assets/icon/db-other.svg";switch(e.sourceType){case 1:s={mysql:"/assets/icon/mysql.svg",pgsql:"/assets/icon/pg.svg",graphql:"/assets/icon/graphql.svg",mongodb:"/assets/icon/mongodb.svg",rest:"/assets/icon/rest.svg",sqlite:"/assets/icon/sqlite.svg"}[String(e.config.dbType).toLowerCase()]||s;break;case 2:s="/assets/icon/rest.svg";break;case 3:s="/assets/icon/graphql.svg";break}return{name:e.name,label:n("div",{className:"flex items-center",children:[r("img",{className:"h-3 mr-1 w-3",alt:e.name,src:s}),e.name]}),value:e.id}})}),r("div",{className:"cursor-pointer flex bg-[#f7f7f7] h-28px ml-1 w-28px items-center justify-center",onClick:h,children:r("img",{width:18,height:18,src:"/assets/refresh.svg",alt:"\u5237\u65B0"})})]}),r("div",{className:"py-5px overflow-y-auto pa",children:v.map(e=>n("div",{className:I({[d.siderItem]:!0,[d.siderItemActive]:(o==null?void 0:o.name)===e.name}),onClick:()=>g(e),children:[r("img",{className:"mr-3",src:"/assets/model.svg",alt:"\u5237\u65B0"}),e.name]},e.name))})]})}export{Z as default};
