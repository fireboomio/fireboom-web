import{P as Q,K as S,r as h,j as n,W as C,V as L,Y as M,ae as U,k as x,u as y,a6 as D,l as j}from"./index-e23f2223.js";import{G as N}from"./globalContext-79fdce0b.js";import{u as F,D as t,i as G}from"./datasource-e384a503.js";import{u as b}from"./validate-f9ecd65f.js";import{M as A}from"./index-fa478bf1.js";import{a as B}from"./datasource-context-a1fe99af.js";import"./ServiceDiscovery-59c29267.js";import"./PurePanel-08b7f9fd.js";function R(){const{modal:o}=Q.useApp(),c=S(),i=h.useRef(null);return async l=>new Promise((m,u)=>{setTimeout(()=>{var s,p;return(p=(s=i.current)==null?void 0:s.focus)==null?void 0:p.call(s)},100);let r="";const{destroy:d}=o.confirm({title:l.title,content:n.jsx(C,{ref:i,autoFocus:!0,onChange:s=>{r=s.target.value},placeholder:c.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]})}),onOk:()=>{m({confirm:!0,value:r})},onCancel:()=>{m({confirm:!1})},okButtonProps:{onClick:()=>{if(l.validator){const s=l.validator(r);if(s){L.error(s);return}}d(),m({confirm:!0,value:r})}}})})}function I(){const{validateName:o}=b(),{checkSupport:c}=F(),i=S(),l=M(),m=U("/sdk/enabledServer",x),{vscode:u}=h.useContext(N),r=y(),d=R();return{addScript:async(p,f)=>{var v;if(!u.isHookServerSelected)await A.confirm({title:i.formatMessage({id:"LWSLHa",defaultMessage:[{type:0,value:"温馨提示"}]}),content:i.formatMessage({id:"fFqCvL",defaultMessage:[{type:0,value:"当前未选择钩子语言，是否前往创建？"}]}),onOk(){r("/workbench/sdk-template")}});else if(await c(f.split("/").pop())){const{confirm:k,value:a}=await d({title:i.formatMessage({id:"Sn73Ef",defaultMessage:[{type:0,value:"请输入 "},{type:1,value:"name"},{type:0,value:"名称"}]},{name:p}),validator:e=>f!==l.customize?o(e.replace(/\//g,"")):o(e)});if(!k)return;await u.show(`${f}/${a}${(v=m.data)==null?void 0:v.extension}`)&&L.info(i.formatMessage({id:"qd+Bp3",defaultMessage:[{type:0,value:"数据源创建成功，请在编辑完成后重启钩子服务"}]}))}}}}const E=""+new URL("ali-c0340600.svg",import.meta.url).href,q=""+new URL("CockroachDB-2c178614.svg",import.meta.url).href,T=""+new URL("Function-a35bd677.svg",import.meta.url).href,_=""+new URL("GraphalAPI-7740e296.svg",import.meta.url).href,z=""+new URL("GraphQL-123d0ecd.svg",import.meta.url).href,$=""+new URL("MongoDB-491466e8.svg",import.meta.url).href,H=""+new URL("MySQL-1461110d.svg",import.meta.url).href,K=""+new URL("Planetscale-7a27b09b.svg",import.meta.url).href,V=""+new URL("PostgreSQL-2a7e38b3.svg",import.meta.url).href,W=""+new URL("Prisma-ad410772.svg",import.meta.url).href,O=""+new URL("Proxy-5cb1e38c.svg",import.meta.url).href,X=""+new URL("RabbitMQ-2a742049.svg",import.meta.url).href,J=""+new URL("RESTAPI-7b64fc68.svg",import.meta.url).href,Y=""+new URL("RocketMQ-58d7dabc.svg",import.meta.url).href,Z=""+new URL("SQLite-48a4dbe0.svg",import.meta.url).href,ee=""+new URL("SQLServer-bda97784.svg",import.meta.url).href,te="_title_uzrpy_1",ae="_coming_uzrpy_9",w={title:te,coming:ae};function ne(){const o=S(),c=M(),{addScript:i}=I(),{validateName:l}=b(),m=y(),u=R(),r=async()=>{const{confirm:a,value:e}=await u({title:o.formatMessage({id:"hH1NyL",defaultMessage:[{type:0,value:"请输入 "},{type:1,value:"name"},{type:0,value:" 数据源名称"}]},{name:"Prisma"}),validator:g=>l(g)});if(a)try{await x.post("/datasource",{name:e,kind:t.Prisma,enabled:!1,customDatabase:{databaseUrl:{staticVariableContent:`${e}.prisma`}}}),await D(),m(`/workbench/data-source/${e}`)}catch{}},d=[{name:"API",items:[{name:"REST API",icon:J,kind:t.Restful,isCustom:!0},{name:"GraphQL API",icon:_,kind:t.Graphql}]},{name:o.formatMessage({id:"p6z/hH",defaultMessage:[{type:0,value:"数据库"}]}),items:[{name:"MySQL",icon:H,kind:t.MySQL},{name:"Sqlite",icon:Z,kind:t.SQLite},{name:"PostgreSQL",icon:V,kind:t.PostgreSQL},{name:"SQL Server",icon:ee,kind:t.SQLServer},{name:"MongoDB",icon:$,kind:t.MongoDB},{name:"Prisma",icon:W,kind:t.Prisma,onClick:r},{name:"CockroachDB",icon:q,kind:t.Unsupported,coming:!0},{name:"Plantscale",icon:K,kind:t.Unsupported,coming:!0}]},{name:o.formatMessage({id:"tFmMiG",defaultMessage:[{type:0,value:"消息队列"}]}),items:[{name:"RabbitMQ",icon:X,coming:!0,kind:t.Unsupported},{name:"RocketMQ",icon:Y,coming:!0,kind:t.Unsupported},{name:o.formatMessage({id:"tXvcEA",defaultMessage:[{type:0,value:"阿里云物联网平台"}]}),icon:E,coming:!0,kind:t.Unsupported}]},{name:o.formatMessage({id:"K0wvJU",defaultMessage:[{type:0,value:"脚本"}]}),items:[{name:"GraphQL",icon:z,onClick:()=>i("GraphQL 数据源",c.customize)},{name:"Function",icon:T,onClick:()=>i("Function 接口",c.function)},{name:"Proxy",icon:O,onClick:()=>i("Proxy 接口",c.proxy)}]}],{handleCreate:s,handleSave:p}=h.useContext(B),[f,v]=h.useState([]);async function k(a){var g;if(a.onClick)return a.onClick();let e;a.name.startsWith("example_")?e=f.find(P=>P.name===name):(e={name:"",kind:a.kind,enabled:!1},a.kind===t.Restful?e.customRest={baseUrl:"",headers:{},oasFilepath:""}:a.kind===t.Graphql?e.customGraphql={customized:!1,endpoint:"",headers:{},schemaFilepath:""}:G(a)&&(e.customDatabase={kind:0})),await((g=e.onSelect)==null?void 0:g.call(e)),s(j.omit(e,["onSelect"]))}return n.jsx(n.Fragment,{children:d.map(a=>n.jsxs("div",{className:"mb-12",children:[n.jsx("div",{className:`text-lg ${w.title}`,children:n.jsx("span",{className:"pl-2.5",children:a.name})}),n.jsx("div",{className:"flex flex-wrap my-4 gap-x-9.5 gap-y-5 items-center",children:a.items.map(e=>n.jsxs("div",{className:"border rounded cursor-pointer flex bg-[#F8F9FD] border-gray-300/20 min-w-53 py-9px pl-4 transition-shadow text-[#333333] w-53 items-center relative hover:shadow-lg",onClick:()=>!e.coming&&k(e),children:[n.jsx("div",{className:"bg-white rounded-3xl h-7 shadow w-7 inline-flex items-center justify-center",children:n.jsx("img",{alt:"",src:e.icon})}),n.jsx("span",{className:"ml-3"+(e.coming?" text-[#787D8B]":""),children:e.name}),e.coming&&n.jsx("div",{className:w.coming,children:o.formatMessage({id:"Xx+23S",defaultMessage:[{type:0,value:"即将"}]})})]},e.name))})]},a.name))})}function de(){return n.jsx("div",{className:"h-full p-3 pb-0",children:n.jsx("div",{className:"bg-white h-full pt-5.5 pl-5.5 overflow-auto",children:n.jsx(ne,{})})})}export{de as default};
