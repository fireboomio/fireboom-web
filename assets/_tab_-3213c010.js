import{K as S,ag as i,u as I,X as P,r as n,ae as z,k as d,j as e,Q as u,ad as E,W as v}from"./index-8fcf9617.js";import{l as H}from"./index-a9e2b670.js";import{i as U}from"./use-immer.module-e08025f6.js";import{G as A}from"./globalContext-cecb5145.js";import{s as t}from"./subs.module-31980379.js";import{P as D}from"./index-47715de1.js";import{T as R}from"./index-a598a5a2.js";import{M as q}from"./index-47514322.js";import{T as M}from"./Table-a2abadc7.js";import{S as B}from"./index-32253ab8.js";import"./index-c6d5171d.js";import"./index-e75fb219.js";import"./LeftOutlined-1d6a1c51.js";import"./PurePanel-43f1e3ae.js";import"./index-2832b555.js";import"./index-232bd61d.js";import"./PlusOutlined-0c5d9e7a.js";import"./addEventListener-cfbf19c4.js";import"./useShowArrow-48f750eb.js";import"./DownOutlined-477a4df2.js";import"./index-28a5ab96.js";import"./conductUtil-59c07978.js";import"./index-ac0270f4.js";import"./index-717c59ab.js";import"./useBreakpoint-7e6dd639.js";import"./useForceUpdate-fbce3ff8.js";import"./index-1dd4ef3f.js";import"./index-f236deb7.js";H.config({paths:{vs:"./modules/monaco-editor/min/vs"}});function ge(){const s=S(),[m]=i.useForm(),y=I(),{tab:b}=P(),[o,c]=n.useState(),[f,j]=U([]),[p,g]=n.useState(),{data:r,mutate:k}=z("/globalOperation/authenticationHookOptions",d.get);n.useEffect(()=>{d.get("/role").then(a=>{j(a)})},[p]);const C=async a=>{await d[o!=null&&o.isCreate?"post":"put"]("/role",{...a}),c(void 0),g(!p)},N=async a=>{await d.delete(`/role/${a}`),g(!p)},x=[{title:s.formatMessage({id:"ViVQNi",defaultMessage:[{type:0,value:"角色"}]}),dataIndex:"code",key:"code"},{title:s.formatMessage({id:"k+zCG7",defaultMessage:[{type:0,value:"角色描述"}]}),dataIndex:"remark",key:"remark"},{title:s.formatMessage({id:"R2D5Dv",defaultMessage:[{type:0,value:"创建时间"}]}),dataIndex:"createTime",key:"createTime"},{title:s.formatMessage({id:"UtE0dS",defaultMessage:[{type:0,value:"操作"}]}),key:4,render:(a,l)=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer mr-1 pl-0 text-[#1677ff]",onClick:()=>{m.setFieldsValue(l),c(l)},children:e.jsx(u,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})}),e.jsx(D,{title:s.formatMessage({id:"nS8PfW",defaultMessage:[{type:0,value:"确定要删除?"}]}),okText:s.formatMessage({id:"r0/TUu",defaultMessage:[{type:0,value:"确定"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),onConfirm:()=>{N(l.code)},children:e.jsx("span",{className:"ml-4 cursor-pointer pl-0 text-[#1677ff]",children:e.jsx(u,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})})})]})}],{vscode:h}=n.useContext(A),[T,w]=n.useState("role");return e.jsx("div",{className:"bg-[#fbfbfc] h-full p-3",children:e.jsxs("div",{className:"relative h-full flex "+t.roleContainer,children:[T==="role"?e.jsx("div",{className:"top-2px right-0 absolute",children:e.jsx(E,{className:"h-7.5 py-0 px-4",onClick:()=>{m.setFieldsValue({code:"",remark:""}),c({isCreate:!0})},children:e.jsx("span",{className:"text-sm text-gray",children:e.jsx(u,{id:"UH1kCc",defaultMessage:[{type:0,value:"添加"}]})})})}):"",e.jsx(R,{className:"h-full w-full",renderTabBar:(a,l)=>e.jsx(l,{className:t.pillTab,...a}),onChange:w,activeKey:b,onTabClick:a=>{y(`/workbench/auth/role/${a}`)},items:[{label:s.formatMessage({id:"/F5ua7",defaultMessage:[{type:0,value:"角色管理"}]}),key:"role",children:e.jsxs("div",{className:t.tabContent,children:[o&&e.jsx(q,{open:!0,mask:!1,title:o?s.formatMessage({id:"H4GEbT",defaultMessage:[{type:0,value:"编辑角色"}]}):s.formatMessage({id:"THkRPD",defaultMessage:[{type:0,value:"添加角色"}]}),style:{top:"200px"},width:549,transitionName:"",onOk:()=>m.submit(),onCancel:()=>c(void 0),okText:s.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]}),okButtonProps:{className:t["save-btn"]},okType:"text",cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),children:e.jsxs(i,{name:"roleList",form:m,labelCol:{span:6},wrapperCol:{span:16},onFinish:a=>{C({...a})},autoComplete:"off",labelAlign:"left",className:"h-30 mt-8 ml-8",children:[e.jsx(i.Item,{label:s.formatMessage({id:"z1UqSC",defaultMessage:[{type:0,value:"角色code"}]}),name:"code",rules:[{required:!0,message:s.formatMessage({id:"53xMJk",defaultMessage:[{type:0,value:"请输入角色编码"}]})},{pattern:/^[_a-zA-Z][_a-zA-Z\d]*$/g,message:s.formatMessage({id:"C/vpUV",defaultMessage:[{type:0,value:"请输入数字、字母或下划线，第一位不能是数字"}]})}],children:e.jsx(v,{disabled:!(o!=null&&o.isCreate)})}),e.jsx(i.Item,{label:s.formatMessage({id:"k+zCG7",defaultMessage:[{type:0,value:"角色描述"}]}),name:"remark",children:e.jsx(v,{})}),e.jsx(i.Item,{name:"createTime"})]})}),e.jsx("div",{className:t["role-container-table"],children:f.length>0?e.jsx(M,{columns:x,dataSource:f,rowKey:"code",pagination:!1}):e.jsx(M,{columns:x,dataSource:[],rowKey:"code",rowClassName:(a,l)=>l%2===1?t["role-table"]:"",pagination:!1})})]})},{label:s.formatMessage({id:"ho6kY0",defaultMessage:[{type:0,value:"身份鉴权"}]}),key:"auth",children:e.jsx("div",{className:t.tabContent,children:e.jsx("div",{className:t.table,children:Object.keys(r??{}).map(a=>{var l;return e.jsxs("div",{className:t.row,children:[e.jsx("div",{className:t.name,children:a}),e.jsx(B,{checked:(l=r==null?void 0:r[a])==null?void 0:l.enabled,onChange:async F=>{await h.checkHookExist(r[a].path)&&(await d.put("/globalOperation",{apiAuthenticationHooks:{[a]:F}}),k())}}),e.jsx("div",{className:t.btn,onClick:()=>h.show(r[a].path),children:e.jsx(u,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})]},a)})})})}]})]})})}export{ge as default};
