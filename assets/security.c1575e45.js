import{d as H,Z as t,r as h,C as A,c as v,f as a,j as e,F as S,I as M,B as V,g as G}from"./index.e5e6c754.js";import"./iconUtil.31c13224.js";import"./index.5e1fa168.js";import{S as U}from"./index.6926b693.js";import{S as E}from"./index.daad23d2.js";import{i as R}from"./use-immer.module.1d9a0526.js";import{F as O}from"./FormTooltip.a240d273.js";import{s as u}from"./subs.module.a70cc990.js";import{P as k}from"./PlusOutlined.5b3e3b8c.js";import"./KeyCode.9c493596.js";import"./pickAttrs.c5bbb5fc.js";import"./Overflow.321ca619.js";import"./DownOutlined.75881d1e.js";import"./index.60d20720.js";import"./css.7dd30b7b.js";import"./DialogWrap.947e0e2f.js";import"./RightOutlined.73e4cc97.js";const Q="/assets/tip-graphql.bfc09b78.png",D={wrapperCol:{xs:{span:24},sm:{span:16}}};function T(){const m=H(),[g,l]=R([]),[F,c]=R(!1),[r]=t.useForm(),[w,p]=h.exports.useState();return h.exports.useEffect(()=>{v.get("/auth/redirectUrl").then(s=>{l(s),c(!0)})},[w]),e(S,{children:F?e("div",{className:`${u["form-contain"]} `,children:e(t,{form:r,initialValues:{redirectURLs:g},labelAlign:"left",labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:10},sm:{span:9}},children:e(t.Item,{label:m.formatMessage({id:"qZjJ7M",defaultMessage:[{type:0,value:"\u91CD\u5B9A\u5411URL"}]}),wrapperCol:{xs:{span:20},sm:{span:20}},children:e(t.List,{name:"redirectURLs",children:(s,{add:y,remove:b},{errors:L})=>a(S,{children:[s.map((f,i)=>{var B;const o=r.getFieldValue(["redirectURLs",f.name])||"https://",C=(n,d)=>{let[,I="https://",N=""]=(o==null?void 0:o.match(/(^https?:\/\/)(.*)/))||[];n==="protocol"?I=d:N=d;const q=`${I}${N}`;r.setFieldValue(["redirectURLs",f.name],q),n==="protocol"&&x()},x=()=>{const n=r.getFieldValue("redirectURLs").filter(d=>d==null?void 0:d.replace(/https?:\/\//,"").trim());v.post("/auth/redirectUrl",{redirectURLs:n}).then(()=>{p(!w)})};return h.exports.createElement(t.Item,{...D,required:!1,key:f.key},e(t.Item,{validateTrigger:["onChange","onBlur"],noStyle:!0,children:a("div",{children:[e("div",{children:m.formatMessage({id:"tdD1O3",defaultMessage:[{type:0,value:"\u57DF\u540D"}]})+(i+1).toString()+":"}),e(M,{addonBefore:a(E,{defaultValue:(B=o.match(/^https?:\/\//))==null?void 0:B[0],className:"select-before",onChange:n=>C("protocol",n),children:[e(E.Option,{value:"https://",children:"https://"}),e(E.Option,{value:"http://",children:"http://"})]}),placeholder:m.formatMessage({id:"ezUs/G",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u57DF\u540D"}]}),style:{width:"60%"},onChange:n=>C("path",n.target.value),defaultValue:o.replace(/^https?:\/\//,""),onBlur:x,onPressEnter:x}),e("span",{className:`${u["form-delete-icon"]}`,onClick:()=>{v.post("/auth/redirectUrl",{redirectURLs:r.getFieldValue("redirectURLs").filter((n,d)=>d!=i)}).then(()=>{b(i),p(!w)})},children:e("img",{src:"/assets/deleteIcon.svg",alt:" "})})]})}))}),a(t.Item,{wrapperCol:{span:20},className:"mt-4",children:[e(V,{type:"dashed",style:{width:"48%"},icon:e(k,{}),className:"text-gray-500/60",onClick:()=>y(),children:e(G,{id:"uhcx5v",defaultMessage:[{type:0,value:"\u65B0\u589EURL"}]})}),e(t.ErrorList,{errors:L})]})]})})})})}):null})}function oe(){const m=H(),[g]=t.useForm(),[l,F]=R({}),[c,r]=h.exports.useState(),{config:w}=h.exports.useContext(A),p=async(s,y)=>{await v.post("/global",{key:s,val:y})};return h.exports.useEffect(()=>{v.get("/setting/securityConfig").then(s=>{F(s)})},[c]),a("div",{className:"bg-white h-full pt-4 pl-8",children:[l.allowedHosts?e("div",{className:`${u["security-form-contain"]}`,children:a(t,{form:g,name:"dynamic_form_item",initialValues:{allowedHosts:l==null?void 0:l.allowedHosts,enableGraphQLEndpoint:l.enableGraphQLEndpoint},labelAlign:"left",labelCol:{xs:{span:4},sm:{span:4}},wrapperCol:{xs:{span:10},sm:{span:9}},children:[a(t.Item,{label:"GraphQL\u7AEF\u70B9\uFF1A",children:[e(t.Item,{name:"enableGraphQLEndpoint",noStyle:!0,required:!0,children:e(U,{disabled:w.devSwitch,className:u["switch-edit-btn"],checked:l.enableGraphQLEndpoint,size:"small",onChange:s=>{p("enableGraphQLEndpoint",s).then(()=>{r(!c)})}})}),a("span",{className:u.setTitle,children:[e("img",{alt:"zhuyi",src:"assets/iconfont/zhuyi.svg",style:{height:"1em",width:"1em"},className:"mr-1 text-[14px]"}),e("span",{children:"https://localhost:9991/api/main/graphql"})]})]}),a(t.Item,{label:a("div",{children:[e("span",{children:m.formatMessage({id:"HJshAi",defaultMessage:[{type:0,value:"\u5141\u8BB8\u4E3B\u673A"}]})}),e(O,{className:"!left-4",title:e("img",{src:Q,className:"max-w-60vw max-h-60vh",alt:""})})]}),wrapperCol:{xs:{span:2},sm:{span:20}},children:[e(U,{className:u["switch-edit-btn"],checked:l.allowedHostsEnable,size:"small",onChange:s=>{p("allowedHostsEnable",s).then(()=>{r(!c)})}}),e("span",{className:"text-default ml-4",children:m.formatMessage({id:"1jRYJf",defaultMessage:[{type:0,value:"\u5141\u8BB8\u5168\u90E8"}]})})]}),!l.allowedHostsEnable&&e(t.Item,{wrapperCol:{offset:4,xs:{span:2},sm:{span:20}},children:e(t.List,{name:"allowedHosts",children:(s,{add:y,remove:b},{errors:L})=>a(S,{children:[s.map((f,i)=>h.exports.createElement(t.Item,{...D,required:!1,key:f.key},e(t.Item,{...f,validateTrigger:["onChange","onBlur"],noStyle:!0,rules:[],children:a("div",{className:"",children:[e("div",{children:"\u57DF\u540D"+(i+1).toString()+":"}),e(M,{addonBefore:"http(s)://",placeholder:"OIDC\u8DF3\u8F6C\u7684\u56DE\u8C03\u5730\u5740",style:{width:"60%"},defaultValue:l.allowedHosts[i],onBlur:o=>{o.target.value!=""&&p("allowedHosts",g.getFieldValue("allowedHosts")).then(()=>{r(!c)})},onPressEnter:o=>{o.target.value!=""&&p("allowedHosts",g.getFieldValue("allowedHosts")).then(()=>{r(!c)})}}),e("span",{className:`${u["form-delete-icon"]}`,onClick:()=>{v.post("/global",{key:"allowedHosts",val:g.getFieldValue("allowedHosts").filter((o,C)=>C!=i)}).then(()=>{b(i)})},children:e("img",{src:"/assets/deleteIcon.svg",alt:" "})})]})}))),a(t.Item,{wrapperCol:{span:20},className:"mt-4",children:[e(V,{type:"dashed",style:{width:"48%"},onClick:()=>y(),icon:e(k,{}),className:"text-gray-500/60",children:"\u65B0\u589EHOST"}),e(t.ErrorList,{errors:L})]})]})})})]})}):null,e(T,{})]})}export{oe as default};
