import{x as c}from"./x6.fe77169b.js";import{d as N,r as p,j as L,f as B,g as q}from"./index.e5e6c754.js";import{y as A}from"./index.07d786b1.js";import{K as w}from"./index.b6cece06.js";import"./index.3e81d184.js";import"./index.8958a719.js";import"./getDataOrAriaProps.e48b8c96.js";import"./printer.b0e2956d.js";import"./DownOutlined.75881d1e.js";import"./KeyCode.9c493596.js";import"./index.6926b693.js";import"./index.esm.0df65c6e.js";import"./index.esm.e5edd667.js";import"./workbenchContext.a6b76e3b.js";import"./keyBy.400ebaf7.js";import"./_baseGet.6a7418c9.js";import"./_createAggregator.87a98d7b.js";import"./get.131f9f4f.js";const E=32;function M(u){return{position:{distance:.5,offset:{y:-12,x:0}},attrs:{text:{text:u,fill:"#888",fontSize:11,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"}}}}const J=()=>{const u=N(),{schemaAST:h,schema:l}=A(),S=p.exports.useRef(null),v=p.exports.useMemo(()=>{var e,t,d;return Object.keys({...(e=l==null?void 0:l.getQueryType())==null?void 0:e.getFields(),...(t=l==null?void 0:l.getMutationType())==null?void 0:t.getFields(),...(d=l==null?void 0:l.getSubscriptionType())==null?void 0:d.getFields()})},[l]),x=p.exports.useMemo(()=>{var e;return((e=h==null?void 0:h.definitions)==null?void 0:e[0].kind)===w.OPERATION_DEFINITION&&h.definitions[0].selectionSet.selections||[]},[h]),a=p.exports.useMemo(()=>{const e=[],t=[];function d(r,b,y){var s;for(const o of r)if(o.kind===w.FIELD){const i=[],n=o.name.value,f=n.split("_").shift();let g=!1;v.includes(n)&&(b.push({name:n,children:i,from:y,to:f}),g=!0,t.includes(f)||t.push(f)),(s=o.selectionSet)!=null&&s.selections.length&&d(o.selectionSet.selections,g?i:b,g?f:y)}}return d(x,e,""),{sequenceList:e,dataSourceList:t}},[v,x]),m=p.exports.useMemo(()=>{let e=144;function t(d){e+=d.length*E*2;for(const r of d)t(r.children)}return t(a.sequenceList),e},[a.sequenceList]);return p.exports.useEffect(()=>(c.Graph.registerNode("block",{inherit:"rect",width:80,height:32,attrs:{body:{fill:"none",strokeWidth:.5,stroke:"#333",rx:4,ry:4},text:{fontSize:14,fill:"#333333"}}}),c.Graph.registerEdge("block-connector",{attrs:{line:{stroke:"#888",targetMarker:""}}}),c.Graph.registerEdge("flow",{attrs:{line:{stroke:"#666",targetMarker:{name:"block",width:5,height:8}}}}),c.Graph.registerEdge("dash-flow",{attrs:{line:{stroke:"#666",strokeWidth:.5,strokeDasharray:"3 3",targetMarker:{name:"block",width:5,height:8}}}}),()=>{c.Graph.unregisterNode("block"),c.Graph.unregisterEdge("block-connector"),c.Graph.unregisterEdge("flow"),c.Graph.unregisterEdge("dash-flow")}),[]),p.exports.useEffect(()=>{x.length&&setTimeout(()=>{const e=new c.Graph({container:S.current,mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},interacting:{nodeMovable:!1,edgeMovable:!1,edgeLabelMovable:!1,arrowheadMovable:!1,vertexMovable:!1,useEdgeTools:!1},autoResize:!0}),t=[e.createNode({shape:"block",label:u.formatMessage({id:"G5QYm7",defaultMessage:[{type:0,value:"\u5BA2\u6237\u7AEF"}]}),x:12,y:12}),e.createNode({shape:"block",label:u.formatMessage({id:"G5QYm7",defaultMessage:[{type:0,value:"\u5BA2\u6237\u7AEF"}]}),x:12,y:m-40}),e.createNode({shape:"block",label:u.formatMessage({id:"saR+wi",defaultMessage:[{type:0,value:"\u670D\u52A1\u7AEF"}]}),x:148,y:12}),e.createNode({shape:"block",label:u.formatMessage({id:"saR+wi",defaultMessage:[{type:0,value:"\u670D\u52A1\u7AEF"}]}),x:148,y:m-40})];for(const[s,o]of a.dataSourceList.entries()){const i=e.createNode({shape:"block",label:o,x:20+136*(s+2),y:12});t.push(i);const n=e.createNode({shape:"block",label:o,x:20+136*(s+2),y:m-40});t.push(n)}e.addNodes([...t]);for(let s=0;s<t.length;s=s+2)e.addEdge({shape:"block-connector",source:t[s],target:t[s+1]});e.addEdge({shape:"flow",source:{x:52,y:64},target:{x:188,y:64}}).appendLabel(M(u.formatMessage({id:"7hbJjS",defaultMessage:[{type:0,value:"\u53D1\u8D77\u8BF7\u6C42"}]})));let r=56;console.log(a.sequenceList);function b(s){for(const o of s){r+=E;let i,n;if(!o.from)i=t[2];else{const k=a.dataSourceList.indexOf(o.from);i=t[k*2+4]}const f=a.dataSourceList.indexOf(o.to);n=t[f*2+4];const g=e.addEdge({shape:"flow",source:{x:i.getBBox().x+40,y:r},target:{x:n.getBBox().x+40,y:r}});o.name&&g.appendLabel(M(o.name))}for(const o of s)o.children.length&&b(o.children);for(const o of s){r+=E;let i,n;if(!o.from)n=t[2];else{const k=a.dataSourceList.indexOf(o.from);n=t[k*2+4]}const f=a.dataSourceList.indexOf(o.to);i=t[f*2+4];const g=e.addEdge({shape:"dash-flow",source:{x:i.getBBox().x+40,y:r},target:{x:n.getBBox().x+40,y:r}});o.name&&g.appendLabel(M(o.name))}}b(a.sequenceList),r+=E,e.addEdge({shape:"dash-flow",source:{x:188,y:r},target:{x:52,y:r}}).appendLabel(M(u.formatMessage({id:"dvkDbC",defaultMessage:[{type:0,value:"\u8BF7\u6C42\u7ED3\u679C"}]})))},100)},[m,x,a.dataSourceList,a.sequenceList]),L("div",{className:"bg-white rounded shadow p-2",children:L("div",{ref:S,style:{width:`${40+(2+a.dataSourceList.length)*136}px`,height:`${m}px`},children:!x.length&&B("div",{className:"p-4",children:[L(q,{id:"0x6ogM",defaultMessage:[{type:0,value:"\u6682\u65E0\u5185\u5BB9"}]})," "]})})})};export{J as default};
