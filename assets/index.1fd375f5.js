import{r as n,d as R,j as e,F as J,f as c,aH as ee,bS as te,Z as i,u as q,I as M,g as w,B as C,m as W,c as S,b9 as se,ba as ae,b4 as ie,C as ue}from"./index.e5e6c754.js";import{i as re}from"./index.esm.0df65c6e.js";import{W as le}from"./workbenchContext.a6b76e3b.js";import{D as g}from"./index.a76d6f2a.js";import{i as b}from"./use-immer.module.1d9a0526.js";import{E as Y}from"./50x.11335713.js";import{C as ne}from"./index.3e81d184.js";import{R as j}from"./index.8958a719.js";import"./iconUtil.31c13224.js";import"./index.5e1fa168.js";import{S as k}from"./index.daad23d2.js";import{l as oe}from"./Editor.c970b515.js";import{R as de}from"./main.70523ff0.js";import ce from"./index.efdf9744.js";import{u as me}from"./useEnvOptions.b8beba26.js";import{s as V}from"./subs.module.83a5a1f8.js";import"./index.esm.e5edd667.js";import"./index.60d20720.js";import"./css.7dd30b7b.js";import"./DialogWrap.947e0e2f.js";import"./KeyCode.9c493596.js";import"./pickAttrs.c5bbb5fc.js";import"./RightOutlined.73e4cc97.js";import"./getDataOrAriaProps.e48b8c96.js";import"./Overflow.321ca619.js";import"./DownOutlined.75881d1e.js";n.exports.createContext([]);n.exports.createContext({});n.exports.createContext({});const P=n.exports.createContext({});n.exports.createContext({});n.exports.createContext({});function pe({content:a}){var p,F,E,x,y,d,s;const r=R(),[m,t]=b(!1),o=a.config,h=()=>{t(!m)},l=((p=a.switchState)==null?void 0:p.length)==0?r.formatMessage({id:"RQeDK/",defaultMessage:[{type:0,value:"\u4E0D\u5F00\u542F"}]}):((F=a.switchState)==null?void 0:F.length)==2?r.formatMessage({id:"UEEFxl",defaultMessage:[{type:0,value:"\u57FA\u4E8EToken\u548CCookie"}]}):a.switchState[0]=="tokenBased"?r.formatMessage({id:"LWXiI7",defaultMessage:[{type:0,value:"\u57FA\u4E8EToken"}]}):a.switchState[0]=="cookieBased"?r.formatMessage({id:"in3Y3D",defaultMessage:[{type:0,value:"\u57FA\u4E8ECookie"}]}):"";return a?e(J,{children:e("div",{className:"mt-8",children:c(g,{bordered:!0,column:1,size:"small",children:[e(g.Item,{label:r.formatMessage({id:"YJo5EG",defaultMessage:[{type:0,value:"\u4F9B\u5E94\u5546ID"}]}),children:o.id}),e(g.Item,{label:r.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),children:(x=(E=o.clientId)==null?void 0:E.val)!=null?x:""}),e(g.Item,{label:r.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),children:e("span",{onClick:h,children:m?c("div",{children:[(d=(y=o.clientSecret)==null?void 0:y.val)!=null?d:"",e(ee,{className:"ml-6"})]}):(s=o.clientSecret)!=null&&s.val?c("div",{children:["***********",e(te,{className:"ml-6"})]}):""})}),e(g.Item,{label:r.formatMessage({id:"uDcCXN",defaultMessage:[{type:0,value:"Issuer"}]}),children:o.issuer}),e(g.Item,{label:r.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"\u670D\u52A1\u53D1\u73B0\u5730\u5740"}]}),children:`${o.issuer}/.well-known/openid-configuration`}),e(g.Item,{label:r.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),children:o.jwks==0?"URL":"JSON"}),o.jwks===0?e(g.Item,{label:r.formatMessage({id:"kXy8jI",defaultMessage:[{type:0,value:"jwksURL"}]}),children:o.jwksURL}):e(g.Item,{label:r.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),children:e("pre",{children:o.jwksJSON})}),e(g.Item,{label:r.formatMessage({id:"lcCuRt",defaultMessage:[{type:0,value:"\u7528\u6237\u7AEF\u70B9"}]}),children:o.userInfoEndpoint}),e(g.Item,{label:r.formatMessage({id:"8mYf5w",defaultMessage:[{type:0,value:"\u662F\u5426\u5F00\u542F"}]}),children:l})]})})}):e(Y,{})}oe.config({paths:{vs:"/modules/monaco-editor/min/vs"}});function fe({content:a,onChange:r,onTest:m}){const t=R(),o=n.exports.useMemo(()=>[{label:t.formatMessage({id:"in3Y3D",defaultMessage:[{type:0,value:"\u57FA\u4E8ECookie"}]}),value:"cookieBased"},{label:t.formatMessage({id:"LWXiI7",defaultMessage:[{type:0,value:"\u57FA\u4E8EToken"}]}),value:"tokenBased"}],[t]),{handleBottomToggleDesigner:h}=n.exports.useContext(P),[l]=i.useForm(),p=i.useWatch("issuer",l),F=i.useWatch(["clientId","kind"],l),E=i.useWatch(["clientSecret","kind"],l),x=i.useWatch("jwksURL",l),[y,d]=b(""),s=a.config,[D,$]=b(s.jwks==1),[ge,O]=b(!1),X=q(),[U,L]=n.exports.useState({}),[G,T]=n.exports.useState(""),N=n.exports.useRef(""),z=me();if(n.exports.useEffect(()=>{try{L(JSON.parse(String(s.jwksJSON||"{}")))}catch(u){L({}),console.error(u)}T(JSON.stringify(U))},[a]),!a)return e(Y,{});const K=async u=>{if(u.jwks==1)u.jwksJSON=G;else if(!u.jwksURL&&!u.userInfoEndpoint){W.warning(t.formatMessage({id:"aSYY8Y",defaultMessage:[{type:0,value:"\u672A\u89E3\u6790\u5230jwksURL\u548C\u7528\u6237\u7AEF\u70B9"}]}));return}const f={...s,...u},v={...a,switchState:u.switchState,name:u.id};if(a.name==""){const I={...v,config:f};Reflect.deleteProperty(I,"id");const A=await S.post("/auth",I);a.id=A}else await S.put("/auth",{...v,config:f});S.get("/auth").then(I=>{r(I.filter(A=>A.id===a.id)[0])}).then(()=>{h("data",a.id)})},Q=u=>{d(u),$(u=="1")},_=async u=>{const f=`${u.replace(/\/+$/,"")}/.well-known/openid-configuration`;try{new URL(f)}catch{return}N.current=f,l.setFieldValue("jwksURL",""),l.setFieldValue("userInfoEndpoint",""),l.setFieldValue("tokenEndpoint",""),l.setFieldValue("authorizationEndpoint","");try{const v=await se.get("/api/v1/common/proxy",{headers:ae(),params:{url:f}});if(N.current!==f)return;l.setFieldValue("jwksURL",v.data.jwks_uri),l.setFieldValue("userInfoEndpoint",v.data.userinfo_endpoint),l.setFieldValue("tokenEndpoint",v.data.token_endpoint),l.setFieldValue("authorizationEndpoint",v.data.authorization_endpoint)}finally{N.current=""}},H=(u,f)=>{_(String(f.issuer));for(const v in f)if(f[v]==null){O(!0);return}O(!1)},Z=a.name?{id:s.id,clientId:s.clientId||{kind:"0"},clientSecret:s.clientSecret||{kind:"0"},issuer:s.issuer,jwks:s.jwks,jwksJSON:s.jwksJSON,jwksURL:s.jwksURL,userInfoEndpoint:s.userInfoEndpoint,tokenEndpoint:s.tokenEndpoint,authorizationEndpoint:s.authorizationEndpoint,switchState:a.switchState}:{id:"",clientId:{kind:"0"},clientSecret:{kind:"0"},issuer:"",jwks:0,jwksJSON:"",jwksURL:"",userInfoEndpoint:"",tokenEndpoint:"",authorizationEndpoint:"",switchState:[]},B=({updated_src:u})=>{T(JSON.stringify(u))};return c(J,{children:[e("div",{className:`${V["db-check-setting"]}  mt-2 cursor-pointer`,children:e("span",{className:" h-5 w-19 float-right"})}),e("div",{className:`${V["edit-form-contain"]} py-6 rounded-xl mb-4`,children:c(i,{form:l,style:{width:"90%"},name:"basic",labelCol:{span:4},wrapperCol:{span:11},onFinish:u=>{K(u)},onValuesChange:H,autoComplete:"new-password",validateTrigger:"onChange",initialValues:Z,children:[e(i.Item,{label:t.formatMessage({id:"YJo5EG",defaultMessage:[{type:0,value:"\u4F9B\u5E94\u5546ID"}]}),name:"id",rules:[{required:!0,message:t.formatMessage({id:"QaFk/Y",defaultMessage:[{type:0,value:"\u4F9B\u5E94\u5546ID\u4E0D\u80FD\u4E3A\u7A7A"}]})},{pattern:new RegExp("^\\w+$","g"),message:t.formatMessage({id:"DWjAJJ",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u5305\u542B\u5B57\u6BCD\uFF0C\u6570\u5B57\uFF0C\u4E0B\u5212\u7EBF"}]})}],children:e(M,{placeholder:t.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]}),autoComplete:"off",autoFocus:!0})}),e(i.Item,{label:t.formatMessage({id:"NyeMXU",defaultMessage:[{type:0,value:"App ID"}]}),required:!0,children:c(M.Group,{compact:!0,className:"!flex",children:[e(i.Item,{name:["clientId","kind"],noStyle:!0,children:c(k,{className:"flex-0 w-100px",children:[e(k.Option,{value:"0",children:e(w,{id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})}),e(k.Option,{value:"1",children:e(w,{id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})})]})}),e(i.Item,{name:["clientId","val"],noStyle:!0,rules:[{required:!0,message:t.formatMessage({id:"Z4d9SJ",defaultMessage:[{type:0,value:"App ID\u4E0D\u80FD\u4E3A\u7A7A"}]})}],children:F==="0"?e(M,{className:"flex-1",placeholder:t.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(k,{className:"flex-1",options:z})})]})}),e(i.Item,{label:t.formatMessage({id:"NSax9B",defaultMessage:[{type:0,value:"App Secret"}]}),required:!0,children:c(M.Group,{compact:!0,className:"!flex",children:[e(i.Item,{name:["clientSecret","kind"],noStyle:!0,children:c(k,{className:"flex-0 w-100px",children:[e(k.Option,{value:"0",children:e(w,{id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})}),e(k.Option,{value:"1",children:e(w,{id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})})]})}),e(i.Item,{name:["clientSecret","val"],noStyle:!0,rules:[{required:!0,message:t.formatMessage({id:"wCsUWB",defaultMessage:[{type:0,value:"App Secret\u4E0D\u80FD\u4E3A\u7A7A"}]})}],children:E==="0"?e(M,{className:"flex-1",placeholder:t.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(k,{className:"flex-1",options:z})})]})}),e(i.Item,{label:"Issuer",name:"issuer",rules:[{required:!0,message:t.formatMessage({id:"pzponE",defaultMessage:[{type:0,value:"Issuer\u4E0D\u80FD\u4E3A\u7A7A"}]})},{type:"url",message:t.formatMessage({id:"qVqrPb",defaultMessage:[{type:0,value:"\u53EA\u5141\u8BB8\u8F93\u5165\u94FE\u63A5"}]})}],children:e(ce,{placeholder:t.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(i.Item,{label:t.formatMessage({id:"IAf7JP",defaultMessage:[{type:0,value:"\u670D\u52A1\u53D1\u73B0\u5730\u5740"}]}),children:e(M,{value:`${p}/.well-known/openid-configuration`,disabled:!0})}),e(i.Item,{label:t.formatMessage({id:"P9Qnez",defaultMessage:[{type:0,value:"JWKS"}]}),name:"jwks",children:c(j.Group,{onChange:u=>{Q(u.target.value)},value:y,children:[e(j,{value:0,children:"URL"}),e(j,{value:1,children:"JSON"})]})}),D?e(i.Item,{label:t.formatMessage({id:"Oxa91E",defaultMessage:[{type:0,value:"jwksJSON"}]}),className:"mb-5",children:e(de,{onEdit:B,onAdd:B,onDelete:B,src:U,iconStyle:"triangle",name:!1})}):e(i.Item,{label:t.formatMessage({id:"kXy8jI",defaultMessage:[{type:0,value:"jwksURL"}]}),name:"jwksURL",children:e(M,{disabled:!0,suffix:e("div",{className:"cursor-pointer",onClick:()=>{window.open(x,"_blank")},children:e(w,{id:"qVDSm2",defaultMessage:[{type:0,value:"\u6D4F\u89C8"}]})})})}),e(i.Item,{label:t.formatMessage({id:"lcCuRt",defaultMessage:[{type:0,value:"\u7528\u6237\u7AEF\u70B9"}]}),name:"userInfoEndpoint",children:e(M,{disabled:!0})}),e(i.Item,{hidden:!0,name:"tokenEndpoint",children:e(M,{disabled:!0})}),e(i.Item,{hidden:!0,name:"authorizationEndpoint",children:e(M,{disabled:!0})}),e(i.Item,{label:t.formatMessage({id:"8mYf5w",defaultMessage:[{type:0,value:"\u662F\u5426\u5F00\u542F"}]}),name:"switchState",children:e(ne.Group,{options:o})}),c(i.Item,{wrapperCol:{offset:4,span:16},children:[e(C,{className:"btn-cancel",onClick:()=>{if(!(a!=null&&a.id)){X(-1);return}h("data",a.id)},children:e("span",{children:e(w,{id:"2QzYmY",defaultMessage:[{type:0,value:"\u53D6\u6D88"}]})})}),e(C,{className:"ml-4 btn-save",onClick:()=>{l.submit()},children:e(w,{id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})]})})]})}function qe(){const a=R(),{onRefreshMenu:r}=n.exports.useContext(le),[m,t]=n.exports.useState(),[o,h]=n.exports.useState(!1),l=q(),{id:p}=ie(),{config:F}=n.exports.useContext(ue),{data:E}=re(["/auth",p],function(d,s){return S.get(d)});n.exports.useEffect(()=>{if(p==="new"){h(!0),t({point:"",config:{},id:0,name:"",authSupplier:"openid",switchState:[]});return}S.get("/auth").then(d=>{d.forEach(s=>{s.id===Number(p)&&(h(!1),t(s))})})},[p]),n.exports.useEffect(()=>{p!=="create"&&p!=="new"&&(h(!1),t(E==null?void 0:E.find(d=>d.id===Number(p))))},[E,p]);const x=d=>{r("auth"),t(d),l(`/workbench/auth/${d.id}`)},y=()=>{const d=new URL(location.toString());d.hash="#/workbench/userInfo";let s;try{s=new URL((m==null?void 0:m.point)+encodeURIComponent(d.toString()))}catch(D){W.error(a.formatMessage({id:"iW9zfZ",defaultMessage:[{type:0,value:"\u5730\u5740\u5F02\u5E38\uFF0C\u8BF7\u68C0\u67E5\u7CFB\u7EDF\u8BBE\u7F6E\u4E2D\u7684API\u57DF\u540D\u662F\u5426\u6B63\u786E"}]})),console.error(D);return}F.apiHost||(s.protocol=location.protocol,s.hostname=location.hostname,s.port=location.port),window.open(s.toString())};return c("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",c("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[e("img",{src:"/assets/icon/oidc.svg",className:"h-14px mr-1.5 w-14px",alt:"\u6587\u4EF6"}),(m==null?void 0:m.name)||e(w,{id:"AR/s6m",defaultMessage:[{type:0,value:"\u521B\u5EFA\u8EAB\u4EFD\u8BA4\u8BC1\u5668"}]}),e("div",{className:"flex-1"}),o?null:c(J,{children:[e(C,{className:"btn-test  mr-4",onClick:y,children:e(w,{id:"mPsm6o",defaultMessage:[{type:0,value:"\u6D4B\u8BD5"}]})}),e(C,{className:"btn-save  mr-11",onClick:()=>h(!0),children:e(w,{id:"CLqPBU",defaultMessage:[{type:0,value:"\u7F16\u8F91"}]})})]})]}),e("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 pl-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:e(P.Provider,{value:{handleBottomToggleDesigner:()=>h(!o)},children:m?o?e(fe,{content:m,onChange:x,onTest:y}):e(pe,{content:m}):""})})]})}export{qe as default};
