import{t as ps,c as xs,d as St,r as o,e as ht,f as zt,o as vs,_ as ys,A as nt,h as rt,i as qt,k as z,l as Se,p as bs,R as We,I as gt,w as _s,m as js,n as ws,s as Ht,q as et,v as pt,U as Oe,x as ze,S as Ms,y as ks,z as Y,B as Cs,D as Nt,E as Pe,F as Ss,G as Ns,H as It,J as Is,K as ye,C as Vt,L as Wt,b as Ee,M as Ut,N as Kt,j as e,O as bt,u as Re,P as Yt,Q as M,g as xt,T as ee,V as se,W as Gt,X as Qt,Y as As,Z as Es,$ as Ae,a0 as Te,a1 as ut,a2 as at,a3 as Rs,a4 as Zt,a5 as $s,a6 as tt,a7 as Ke,a8 as _t,a9 as Jt,aa as Xt,ab as Fs,ac as Os,ad as qe,ae as vt,af as Ce,ag as Ts,ah as Ds,ai as ve,aj as Ps,ak as Bs}from"./index-85bb8031.js";import{d as Le}from"./dayjs.min-5495be60.js";import{i as Ls}from"./use-immer.module-b1dfddaf.js";import{G as He}from"./globalContext-c31891b2.js";import{W as Ue}from"./workbenchContext-7962b30b.js";import{S as ce}from"./interface-41bd3122.js";import{u as es}from"./engine-c7e5841f.js";import{p as zs,w as qs}from"./db-ed05e835.js";import{J as Hs}from"./index-5857d219.js";import{u as jt}from"./variable-144a75bf.js";import{u as Vs}from"./auth-8ea2ddcf.js";import{r as Ve}from"./hotkey-3a258436.js";import{M as ts}from"./index-a66fc756.js";import{P as ss}from"./index-90ed7434.js";import{P as Ws}from"./PrismaSchemaContext-02f12971.js";import{S as as,L as Us,a as Ks,D as it,M as Ys}from"./index-9749e2b6.js";import{T as Gs}from"./index-ac112fba.js";import{u as wt}from"./validate-904668ce.js";import{u as Qs}from"./store-e605fef9.js";import{u as Zs,g as Js,D as Xs,i as ea}from"./datasource-50247cd6.js";import{P as Mt}from"./index-92948ccf.js";import{I as ta}from"./index-1f66e1b5.js";import{I as sa}from"./index-8375a6c3.js";import{D as aa}from"./DownOutlined-844f57b8.js";import{W as na}from"./WarningOutlined-3c8a6739.js";import{V as ra}from"./index-fd877240.js";import{u as ia}from"./calcTime-9776a66f.js";import{c as oa}from"./index-9649d007.js";import{f as la}from"./utils-9b986f1e.js";import{u as ca}from"./ServiceDiscovery-94517c32.js";import{C as da}from"./CopyOutlined-c11c973b.js";import{S as At}from"./index-4129e33c.js";function ua(t,s,a){return typeof a=="boolean"?a:t.length?!0:ps(s).some(n=>n.type===as)}const fa=t=>{const{componentCls:s,bodyBg:a,lightSiderBg:r,lightTriggerBg:n,lightTriggerColor:l}=t;return{[`${s}-sider-light`]:{background:r,[`${s}-sider-trigger`]:{color:l,background:n},[`${s}-sider-zero-width-trigger`]:{color:l,background:n,border:`1px solid ${a}`,borderInlineStart:0}}}},ma=fa,ha=t=>{const{antCls:s,componentCls:a,colorText:r,triggerColor:n,footerBg:l,triggerBg:c,headerHeight:u,headerPadding:g,headerColor:v,footerPadding:b,triggerHeight:f,zeroTriggerHeight:j,zeroTriggerWidth:k,motionDurationMid:I,motionDurationSlow:A,fontSize:N,borderRadius:_,bodyBg:L,headerBg:W,siderBg:h}=t;return{[a]:Object.assign(Object.assign({display:"flex",flex:"auto",flexDirection:"column",minHeight:0,background:L,"&, *":{boxSizing:"border-box"},[`&${a}-has-sider`]:{flexDirection:"row",[`> ${a}, > ${a}-content`]:{width:0}},[`${a}-header, &${a}-footer`]:{flex:"0 0 auto"},[`${a}-sider`]:{position:"relative",minWidth:0,background:h,transition:`all ${I}, background 0s`,"&-children":{height:"100%",marginTop:-.1,paddingTop:.1,[`${s}-menu${s}-menu-inline-collapsed`]:{width:"auto"}},"&-has-trigger":{paddingBottom:f},"&-right":{order:1},"&-trigger":{position:"fixed",bottom:0,zIndex:1,height:f,color:n,lineHeight:St(f),textAlign:"center",background:c,cursor:"pointer",transition:`all ${I}`},"&-zero-width":{"> *":{overflow:"hidden"},"&-trigger":{position:"absolute",top:u,insetInlineEnd:t.calc(k).mul(-1).equal(),zIndex:1,width:k,height:j,color:n,fontSize:t.fontSizeXL,display:"flex",alignItems:"center",justifyContent:"center",background:h,borderStartStartRadius:0,borderStartEndRadius:_,borderEndEndRadius:_,borderEndStartRadius:0,cursor:"pointer",transition:`background ${A} ease`,"&::after":{position:"absolute",inset:0,background:"transparent",transition:`all ${A}`,content:'""'},"&:hover::after":{background:"rgba(255, 255, 255, 0.2)"},"&-right":{insetInlineStart:t.calc(k).mul(-1).equal(),borderStartStartRadius:_,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:_}}}}},ma(t)),{"&-rtl":{direction:"rtl"}}),[`${a}-header`]:{height:u,padding:g,color:v,lineHeight:St(u),background:W,[`${s}-menu`]:{lineHeight:"inherit"}},[`${a}-footer`]:{padding:b,color:r,fontSize:N,background:l},[`${a}-content`]:{flex:"auto",color:r,minHeight:0}}},ga=t=>{const{colorBgLayout:s,controlHeight:a,controlHeightLG:r,colorText:n,controlHeightSM:l,marginXXS:c,colorTextLightSolid:u,colorBgContainer:g}=t,v=r*1.25;return{colorBgHeader:"#001529",colorBgBody:s,colorBgTrigger:"#002140",bodyBg:s,headerBg:"#001529",headerHeight:a*2,headerPadding:`0 ${v}px`,headerColor:n,footerPadding:`${l}px ${v}px`,footerBg:s,siderBg:"#001529",triggerHeight:r+c*2,triggerBg:"#002140",triggerColor:u,zeroTriggerWidth:r,zeroTriggerHeight:r,lightSiderBg:g,lightTriggerBg:g,lightTriggerColor:n}},ns=xs("Layout",t=>[ha(t)],ga,{deprecatedTokens:[["colorBgBody","bodyBg"],["colorBgHeader","headerBg"],["colorBgTrigger","triggerBg"]]});var rs=globalThis&&globalThis.__rest||function(t,s){var a={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&s.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)s.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(a[r[n]]=t[r[n]]);return a};function ot(t){let{suffixCls:s,tagName:a,displayName:r}=t;return n=>o.forwardRef((c,u)=>o.createElement(n,Object.assign({ref:u,suffixCls:s,tagName:a},c)))}const kt=o.forwardRef((t,s)=>{const{prefixCls:a,suffixCls:r,className:n,tagName:l}=t,c=rs(t,["prefixCls","suffixCls","className","tagName"]),{getPrefixCls:u}=o.useContext(ht),g=u("layout",a),[v,b,f]=ns(g),j=r?`${g}-${r}`:g;return v(o.createElement(l,Object.assign({className:zt(a||j,n,b,f),ref:s},c)))}),pa=o.forwardRef((t,s)=>{const{direction:a}=o.useContext(ht),[r,n]=o.useState([]),{prefixCls:l,className:c,rootClassName:u,children:g,hasSider:v,tagName:b,style:f}=t,j=rs(t,["prefixCls","className","rootClassName","children","hasSider","tagName","style"]),k=vs(j,["suffixCls"]),{getPrefixCls:I,layout:A}=o.useContext(ht),N=I("layout",l),_=ua(r,g,v),[L,W,h]=ns(N),E=zt(N,{[`${N}-has-sider`]:_,[`${N}-rtl`]:a==="rtl"},A==null?void 0:A.className,c,u,W,h),R=o.useMemo(()=>({siderHook:{addSider:B=>{n(S=>[].concat(ys(S),[B]))},removeSider:B=>{n(S=>S.filter(H=>H!==B))}}}),[]);return L(o.createElement(Us.Provider,{value:R},o.createElement(b,Object.assign({ref:s,className:E,style:Object.assign(Object.assign({},A==null?void 0:A.style),f)},k),g)))}),xa=ot({tagName:"div",displayName:"Layout"})(pa),va=ot({suffixCls:"header",tagName:"header",displayName:"Header"})(kt),ya=ot({suffixCls:"footer",tagName:"footer",displayName:"Footer"})(kt),ba=ot({suffixCls:"content",tagName:"main",displayName:"Content"})(kt),_a=xa,De=_a;De.Header=va;De.Footer=ya;De.Content=ba;De.Sider=as;De._InternalSiderContext=Ks;const st=De;var ja={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"};const wa=ja;var Ma=function(s,a){return o.createElement(nt,rt({},s,{ref:a,icon:wa}))},ka=o.forwardRef(Ma);const Ca=ka;var Sa={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm0 76c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm128.01 198.83c.03 0 .05.01.09.06l45.02 45.01a.2.2 0 01.05.09.12.12 0 010 .07c0 .02-.01.04-.05.08L557.25 512l127.87 127.86a.27.27 0 01.05.06v.02a.12.12 0 010 .07c0 .03-.01.05-.05.09l-45.02 45.02a.2.2 0 01-.09.05.12.12 0 01-.07 0c-.02 0-.04-.01-.08-.05L512 557.25 384.14 685.12c-.04.04-.06.05-.08.05a.12.12 0 01-.07 0c-.03 0-.05-.01-.09-.05l-45.02-45.02a.2.2 0 01-.05-.09.12.12 0 010-.07c0-.02.01-.04.06-.08L466.75 512 338.88 384.14a.27.27 0 01-.05-.06l-.01-.02a.12.12 0 010-.07c0-.03.01-.05.05-.09l45.02-45.02a.2.2 0 01.09-.05.12.12 0 01.07 0c.02 0 .04.01.08.06L512 466.75l127.86-127.86c.04-.05.06-.06.08-.06a.12.12 0 01.07 0z"}}]},name:"close-circle",theme:"outlined"};const Na=Sa;var Ia=function(s,a){return o.createElement(nt,rt({},s,{ref:a,icon:Na}))},Aa=o.forwardRef(Ia);const Ea=Aa;var Ra={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"};const $a=Ra;var Fa=function(s,a){return o.createElement(nt,rt({},s,{ref:a,icon:$a}))},Oa=o.forwardRef(Fa);const Ta=Oa;var Da={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"};const Pa=Da;var Ba=function(s,a){return o.createElement(nt,rt({},s,{ref:a,icon:Pa}))},La=o.forwardRef(Ba);const za=La;var te=(t=>(t.Authentication="authentication",t.Configuration="config",t.DataSource="datasource",t.Operation="operation",t.Role="role",t.Storage="storage",t.SDK="sdk",t))(te||{});const is=qt((t,s)=>({logs:[],setLogs:a=>t({logs:a}),questions:[],setQuestions:a=>t({questions:a})})),qa=(t,s)=>z.put("/globalOperation",{globalHttpTransportHooks:{[t]:s}}),Ha=(t,s,a)=>s==="mockResolve"?z.put("/operation",{path:t,hooksConfiguration:{[s]:{enabled:a}}}):z.put("/operation",{path:t,hooksConfiguration:{[s]:a}}),Et="notification.silent",lt=qt((t,s)=>({visible:!1,silentMode:localStorage.getItem(Et)==="1",notifications:[],hide(){t({visible:!1})},toggleVisible(){t({visible:!s().visible})},toggleSilentMode(){t({silentMode:!s().silentMode}),localStorage.setItem(Et,s().silentMode?"1":"0")},addNotification:a=>{s().notifications.some(r=>r.title===a.title)||(t({notifications:[{id:Se.uniqueId(),...a},...s().notifications]}),s().silentMode||t({visible:!0}))},removeNotification(a){t({notifications:s().notifications.filter(r=>r!==a)}),s().notifications.length||t({visible:!1})},removeByTag(a){t({notifications:s().notifications.filter(r=>r.tag!==a)}),s().notifications.length||t({visible:!1})},clear(){t({notifications:[],visible:!1})}}));class Rt{constructor(s){this.cache=void 0,this.cache=s}define(s,a){this.cache[s]=a}get(s){return this.cache[s]}remove(s){delete this.cache[s]}reset(){this.cache={}}load(s){this.cache={...this.cache,...s}}}class ct extends Error{constructor(s){super(s),this.name="Eta Error"}}class os extends ct{constructor(s){super(s),this.name="EtaParser Error"}}class Va extends ct{constructor(s){super(s),this.name="EtaRuntime Error"}}class yt extends ct{constructor(s){super(s),this.name="EtaFileResolution Error"}}class Wa extends ct{constructor(s){super(s),this.name="EtaNameResolution Error"}}function Be(t,s,a){const r=s.slice(0,a).split(/\n/),n=r.length,l=r[n-1].length+1;throw t+=" at line "+n+" col "+l+`:

  `+s.split(/\n/)[n-1]+`
  `+Array(l).join(" ")+"^",new os(t)}function Ua(t,s,a,r){const n=s.split(`
`),l=Math.max(a-3,0),c=Math.min(n.length,a+3),u=r,g=n.slice(l,c).map(function(f,j){const k=j+l+1;return(k==a?" >> ":"    ")+k+"| "+f}).join(`
`),v=u?u+":"+a+`
`:"line "+a+`
`,b=new Va(v+g+`

`+t.message);throw b.name=t.name,b}const Ka=(async function(){}).constructor;function Ya(t,s){const a=this.config,r=s&&s.async?Ka:Function;try{return new r(a.varName,"options",this.compileToString.call(this,t,s))}catch(n){throw n instanceof SyntaxError?new os(`Bad template syntax

`+n.message+`
`+Array(n.message.length+1).join("=")+`
`+this.compileToString.call(this,t,s)+`
`):n}}function Ga(t,s){const a=this.config,r=s&&s.async,n=this.compileBody,l=this.parse.call(this,t);let c=`${a.functionHeader}
let include = (template, data) => this.render(template, data, options);
let includeAsync = (template, data) => this.renderAsync(template, data, options);

let __eta = {res: "", e: this.config.escapeFunction, f: this.config.filterFunction${a.debug?', line: 1, templateStr: "'+t.replace(/\\|"/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n")+'"':""}};

function layout(path, data) {
  __eta.layout = path;
  __eta.layoutData = data;
}${a.debug?"try {":""}${a.useWith?"with("+a.varName+"||{}){":""}

${n.call(this,l)}
if (__eta.layout) {
  __eta.res = ${r?"await includeAsync":"include"} (__eta.layout, {...${a.varName}, body: __eta.res, ...__eta.layoutData});
}
${a.useWith?"}":""}${a.debug?"} catch (e) { this.RuntimeErr(e, __eta.templateStr, __eta.line, options.filepath) }":""}
return __eta.res;
`;if(a.plugins)for(let u=0;u<a.plugins.length;u++){const g=a.plugins[u];g.processFnString&&(c=g.processFnString(c,a))}return c}function Qa(t){const s=this.config;let a=0;const r=t.length;let n="";for(a;a<r;a++){const l=t[a];if(typeof l=="string")n+="__eta.res+='"+l+`'
`;else{const c=l.t;let u=l.val||"";s.debug&&(n+="__eta.line="+l.lineNo+`
`),c==="r"?(s.autoFilter&&(u="__eta.f("+u+")"),n+="__eta.res+="+u+`
`):c==="i"?(s.autoFilter&&(u="__eta.f("+u+")"),s.autoEscape&&(u="__eta.e("+u+")"),n+="__eta.res+="+u+`
`):c==="e"&&(n+=u+`
`)}}return n}function Za(t,s,a,r){let n,l;return Array.isArray(s.autoTrim)?(n=s.autoTrim[1],l=s.autoTrim[0]):n=l=s.autoTrim,(a||a===!1)&&(n=a),(r||r===!1)&&(l=r),!l&&!n?t:n==="slurp"&&l==="slurp"?t.trim():(n==="_"||n==="slurp"?t=t.trimStart():(n==="-"||n==="nl")&&(t=t.replace(/^(?:\r\n|\n|\r)/,"")),l==="_"||l==="slurp"?t=t.trimEnd():(l==="-"||l==="nl")&&(t=t.replace(/(?:\r\n|\n|\r)$/,"")),t)}const Ja={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Xa(t){return Ja[t]}function en(t){const s=String(t);return/[&<>"']/.test(s)?s.replace(/[&<>"']/g,Xa):s}const $t={autoEscape:!0,autoFilter:!1,autoTrim:[!1,"nl"],cache:!1,cacheFilepaths:!0,debug:!1,escapeFunction:en,filterFunction:t=>String(t),functionHeader:"",parse:{exec:"",interpolate:"=",raw:"~"},plugins:[],rmWhitespace:!1,tags:["<%","%>"],useWith:!1,varName:"it",defaultExtension:".eta"},Ye=/`(?:\\[\s\S]|\${(?:[^{}]|{(?:[^{}]|{[^}]*})*})*}|(?!\${)[^\\`])*`/g,Ge=/'(?:\\[\s\w"'\\`]|[^\n\r'\\])*?'/g,Qe=/"(?:\\[\s\w"'\\`]|[^\n\r"\\])*?"/g;function Ze(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}function tn(t,s){return t.slice(0,s).split(`
`).length}function sn(t){const s=this.config;let a=[],r=!1,n=0;const l=s.parse;if(s.plugins)for(let f=0;f<s.plugins.length;f++){const j=s.plugins[f];j.processTemplate&&(t=j.processTemplate(t,s))}s.rmWhitespace&&(t=t.replace(/[\r\n]+/g,`
`).replace(/^\s+|\s+$/gm,"")),Ye.lastIndex=0,Ge.lastIndex=0,Qe.lastIndex=0;function c(f,j){f&&(f=Za(f,s,r,j),f&&(f=f.replace(/\\|'/g,"\\$&").replace(/\r\n|\n|\r/g,"\\n"),a.push(f)))}const u=[l.exec,l.interpolate,l.raw].reduce(function(f,j){return f&&j?f+"|"+Ze(j):j?Ze(j):f},""),g=new RegExp(Ze(s.tags[0])+"(-|_)?\\s*("+u+")?\\s*","g"),v=new RegExp("'|\"|`|\\/\\*|(\\s*(-|_)?"+Ze(s.tags[1])+")","g");let b;for(;b=g.exec(t);){const f=t.slice(n,b.index);n=b[0].length+b.index;const j=b[1],k=b[2]||"";c(f,j),v.lastIndex=n;let I,A=!1;for(;I=v.exec(t);)if(I[1]){const N=t.slice(n,I.index);g.lastIndex=n=v.lastIndex,r=I[2],A={t:k===l.exec?"e":k===l.raw?"r":k===l.interpolate?"i":"",val:N};break}else{const N=I[0];if(N==="/*"){const _=t.indexOf("*/",v.lastIndex);_===-1&&Be("unclosed comment",t,I.index),v.lastIndex=_}else N==="'"?(Ge.lastIndex=I.index,Ge.exec(t)?v.lastIndex=Ge.lastIndex:Be("unclosed string",t,I.index)):N==='"'?(Qe.lastIndex=I.index,Qe.exec(t)?v.lastIndex=Qe.lastIndex:Be("unclosed string",t,I.index)):N==="`"&&(Ye.lastIndex=I.index,Ye.exec(t)?v.lastIndex=Ye.lastIndex:Be("unclosed string",t,I.index))}A?(s.debug&&(A.lineNo=tn(t,b.index)),a.push(A)):Be("unclosed tag",t,b.index)}if(c(t.slice(n,t.length),!1),s.plugins)for(let f=0;f<s.plugins.length;f++){const j=s.plugins[f];j.processAST&&(a=j.processAST(a,s))}return a}function ls(t,s){const a=s&&s.async?this.templatesAsync:this.templatesSync;if(this.resolvePath&&this.readFile&&!t.startsWith("@")){const r=s.filepath,n=a.get(r);if(this.config.cache&&n)return n;{const l=this.readFile(r),c=this.compile(l,s);return this.config.cache&&a.define(r,c),c}}else{const r=a.get(t);if(r)return r;throw new Wa("Failed to get template '"+t+"'")}}function cs(t,s,a){let r;const n={...a,async:!1};return typeof t=="string"?(this.resolvePath&&this.readFile&&!t.startsWith("@")&&(n.filepath=this.resolvePath(t,n)),r=ls.call(this,t,n)):r=t,r.call(this,s,n)}function ds(t,s,a){let r;const n={...a,async:!0};typeof t=="string"?(this.resolvePath&&this.readFile&&!t.startsWith("@")&&(n.filepath=this.resolvePath(t,n)),r=ls.call(this,t,n)):r=t;const l=r.call(this,s,n);return Promise.resolve(l)}function an(t,s){const a=this.compile(t,{async:!1});return cs.call(this,a,s)}function nn(t,s){const a=this.compile(t,{async:!0});return ds.call(this,a,s)}class rn{constructor(s){this.config=void 0,this.RuntimeErr=Ua,this.compile=Ya,this.compileToString=Ga,this.compileBody=Qa,this.parse=sn,this.render=cs,this.renderAsync=ds,this.renderString=an,this.renderStringAsync=nn,this.filepathCache={},this.templatesSync=new Rt({}),this.templatesAsync=new Rt({}),this.resolvePath=null,this.readFile=null,s?this.config={...$t,...s}:this.config={...$t}}configure(s){this.config={...this.config,...s}}withConfig(s){return{...this,config:{...this.config,...s}}}loadTemplate(s,a,r){if(typeof a=="string")(r&&r.async?this.templatesAsync:this.templatesSync).define(s,this.compile(a,r));else{let n=this.templatesSync;(a.constructor.name==="AsyncFunction"||r&&r.async)&&(n=this.templatesAsync),n.define(s,a)}}}function on(t){let s="";try{s=(void 0)(t,"utf8")}catch(a){throw(a==null?void 0:a.code)==="ENOENT"?new yt(`Could not find template: ${t}`):a}return s}function ln(t,s){let a="";const r=this.config.views;if(!r)throw new yt("Views directory is not defined");const n=s&&s.filepath,l=this.config.defaultExtension===void 0?".eta":this.config.defaultExtension,c=JSON.stringify({filename:n,path:t,views:this.config.views});if(t+=(void 0)(t)?"":l,n){if(this.config.cacheFilepaths&&this.filepathCache[c])return this.filepathCache[c];const u=dn.exec(t);if(u&&u.length){const g=t.replace(/^\/*|^\\*/,"");a=(void 0)(r,g)}else a=(void 0)((void 0)(n),t)}else a=(void 0)(r,t);if(!cn(r,a))throw new yt(`Template '${t}' is not in the views directory`)}function cn(t,s){return(void 0)(t,s)}const dn=/^\\|^\//;class un extends rn{constructor(...s){super(...s),this.readFile=on,this.resolvePath=ln}}const fn=new un;function mn(t,s){const a=s.replace(/^\./,"");return`https://raw.git.fireboom.io/fireboomio/files/main/templates/${t.join("/")}.${a}`}async function hn(t,s){let a="";try{a=await z.get(`/vscode/readFile?uri=template/${t.name}/snippets/${s.join("/")}${t.extension}.eta`,{ignoreError:!0})}catch{}return a||(a=await bs(mn([t.language==="go"?"golang":t.language,...s],t.extension))),a}function gn(t,s){return fn.renderString(t,{...s,upperFirst:Se.upperFirst})}async function Ie(t,s,a){const r=await hn(t,s);return gn(r,a)}async function pn(t,s){const a=t.split("/"),r=a.pop().split(".")[0],n=a[a.length-1];let l="";const c={packageName:n,name:r};if(t.match(/custom-\w+\/global\//))l=await Ie(s,["global",r],c);else if(t.match(/custom-\w+\/authentication\//))l=await Ie(s,["authentication",r],c);else if(t.match(/custom-\w+\/customize\//))l=await Ie(s,["custom","customize"],c);else if(t.match(/custom-\w+\/function\//))l=await Ie(s,["custom","function"],c);else if(t.match(/custom-\w+\/proxy\//))l=await Ie(s,["custom","proxy"],c);else if(t.match(/custom-\w+\/storage/)){const u=a.pop(),g=a.pop();l=await Ie(s,["upload",r],{...c,providerName:g,profileName:u})}else{const u=a.slice(2).join("/"),g=a.slice(2).join("__");l=await Ie(s,["operation",r],{...c,operationPath:u,operationName:g})}return l}const xn="_workbench_19yet_1",vn="_header_19yet_1",yn="_footer_19yet_7",bn="_sider_19yet_13",Je={workbench:xn,header:vn,footer:yn,sider:bn},Ft=We.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(t.status="pending",t.then(s=>{t.status="fulfilled",t.value=s},s=>{t.status="rejected",t.reason=s}),t)}),ft={dedupe:!0},_n=(t,s,a)=>{const{cache:r,compare:n,suspense:l,fallbackData:c,revalidateOnMount:u,revalidateIfStale:g,refreshInterval:v,refreshWhenHidden:b,refreshWhenOffline:f,keepPreviousData:j}=a,[k,I,A,N]=Ms.get(r),[_,L]=Ht(t),W=o.useRef(!1),h=o.useRef(!1),E=o.useRef(_),R=o.useRef(s),B=o.useRef(a),S=()=>B.current,H=()=>S().isVisible()&&S().isOnline(),[d,P,$,F]=ks(r,_),ae=o.useRef({}).current,ge=Y(c)?a.fallback[_]:c,x=(O,q)=>{for(const X in ae){const U=X;if(U==="data"){if(!n(O[U],q[U])&&(!Y(O[U])||!n(ue,q[U])))return!1}else if(q[U]!==O[U])return!1}return!0},w=o.useMemo(()=>{const O=(()=>!_||!s?!1:Y(u)?S().isPaused()||l?!1:Y(g)?!0:g:u)(),q=m=>{const D=et(m);return delete D._k,O?{isValidating:!0,isLoading:!0,...D}:D},X=d(),U=F(),ie=q(X),xe=X===U?ie:q(U);let G=ie;return[()=>{const m=q(d());return x(m,G)?(G.data=m.data,G.isLoading=m.isLoading,G.isValidating=m.isValidating,G.error=m.error,G):(G=m,m)},()=>xe]},[r,_]),i=Cs.useSyncExternalStore(o.useCallback(O=>$(_,(q,X)=>{x(X,q)||O()}),[r,_]),w[0],w[1]),p=!W.current,y=k[_]&&k[_].length>0,C=i.data,T=Y(C)?ge:C,re=i.error,de=o.useRef(T),ue=j?Y(C)?de.current:C:T,J=(()=>y&&!Y(re)?!1:p&&!Y(u)?u:S().isPaused()?!1:l?Y(T)?!1:g:Y(T)||g)(),me=!!(_&&s&&p&&J),$e=Y(i.isValidating)?me:i.isValidating,Z=Y(i.isLoading)?me:i.isLoading,pe=o.useCallback(async O=>{const q=R.current;if(!_||!q||h.current||S().isPaused())return!1;let X,U,ie=!0;const xe=O||{},G=!A[_]||!xe.dedupe,m=()=>gt?!h.current&&_===E.current&&W.current:_===E.current,D={isValidating:!1,isLoading:!1},Ne=()=>{P(D)},ne=()=>{const K=A[_];K&&K[1]===U&&delete A[_]},ke={isValidating:!0};Y(d().data)&&(ke.isLoading=!0);try{if(G&&(P(ke),a.loadingTimeout&&Y(d().data)&&setTimeout(()=>{ie&&m()&&S().onLoadingSlow(_,a)},a.loadingTimeout),A[_]=[q(L),pt()]),[X,U]=A[_],X=await X,G&&setTimeout(ne,a.dedupingInterval),!A[_]||A[_][1]!==U)return G&&m()&&S().onDiscarded(_),!1;D.error=Oe;const K=I[_];if(!Y(K)&&(U<=K[0]||U<=K[1]||K[1]===0))return Ne(),G&&m()&&S().onDiscarded(_),!1;const oe=d().data;D.data=n(oe,X)?oe:X,G&&m()&&S().onSuccess(X,_,a)}catch(K){ne();const oe=S(),{shouldRetryOnError:Fe}=oe;oe.isPaused()||(D.error=K,G&&m()&&(oe.onError(K,_,oe),(Fe===!0||Nt(Fe)&&Fe(K))&&(!S().revalidateOnFocus||!S().revalidateOnReconnect||H())&&oe.onErrorRetry(K,_,oe,gs=>{const dt=k[_];dt&&dt[0]&&dt[0](Pe.ERROR_REVALIDATE_EVENT,gs)},{retryCount:(xe.retryCount||0)+1,dedupe:!0})))}return ie=!1,Ne(),!0},[_,r]),Me=o.useCallback((...O)=>Ss(r,E.current,...O),[]);if(ze(()=>{R.current=s,B.current=a,Y(C)||(de.current=C)}),ze(()=>{if(!_)return;const O=pe.bind(Oe,ft);let q=0;const U=Ns(_,k,(ie,xe={})=>{if(ie==Pe.FOCUS_EVENT){const G=Date.now();S().revalidateOnFocus&&G>q&&H()&&(q=G+S().focusThrottleInterval,O())}else if(ie==Pe.RECONNECT_EVENT)S().revalidateOnReconnect&&H()&&O();else{if(ie==Pe.MUTATE_EVENT)return pe();if(ie==Pe.ERROR_REVALIDATE_EVENT)return pe(xe)}});return h.current=!1,E.current=_,W.current=!0,P({_k:L}),J&&(Y(T)||It?O():Is(O)),()=>{h.current=!0,U()}},[_]),ze(()=>{let O;function q(){const U=Nt(v)?v(d().data):v;U&&O!==-1&&(O=setTimeout(X,U))}function X(){!d().error&&(b||S().isVisible())&&(f||S().isOnline())?pe(ft).then(q):q()}return q(),()=>{O&&(clearTimeout(O),O=-1)}},[v,b,f,_]),o.useDebugValue(ue),l&&Y(T)&&_){if(!gt&&It)throw new Error("Fallback data is required when using suspense in SSR.");R.current=s,B.current=a,h.current=!1;const O=N[_];if(!Y(O)){const q=Me(O);Ft(q)}if(Y(re)){const q=pe(ft);Y(ue)||(q.status="fulfilled",q.value=!0),Ft(q)}else throw re}return{mutate:Me,get data(){return ae.data=!0,ue},get error(){return ae.error=!0,re},get isValidating(){return ae.isValidating=!0,$e},get isLoading(){return ae.isLoading=!0,Z}}},jn=js(_n),Ot=gt?t=>{t()}:We.startTransition,wn=t=>{const[,s]=o.useState({}),a=o.useRef(!1),r=o.useRef(t),n=o.useRef({data:!1,error:!1,isValidating:!1}),l=o.useCallback(c=>{let u=!1;const g=r.current;for(const v in c){const b=v;g[b]!==c[b]&&(g[b]=c[b],n.current[b]&&(u=!0))}u&&!a.current&&s({})},[]);return ze(()=>(a.current=!1,()=>{a.current=!0})),[r,n.current,l]},Mn=()=>(t,s,a={})=>{const{mutate:r}=ws(),n=o.useRef(t),l=o.useRef(s),c=o.useRef(a),u=o.useRef(0),[g,v,b]=wn({data:Oe,error:Oe,isMutating:!1}),f=g.current,j=o.useCallback(async(I,A)=>{const[N,_]=Ht(n.current);if(!l.current)throw new Error("Can’t trigger the mutation: missing fetcher.");if(!N)throw new Error("Can’t trigger the mutation: missing key.");const L=et(et({populateCache:!1,throwOnError:!0},c.current),A),W=pt();u.current=W,b({isMutating:!0});try{const h=await r(N,l.current(_,{arg:I}),et(L,{throwOnError:!0}));return u.current<=W&&(Ot(()=>b({data:h,isMutating:!1,error:void 0})),L.onSuccess==null||L.onSuccess.call(L,h,N,L)),h}catch(h){if(u.current<=W&&(Ot(()=>b({error:h,isMutating:!1})),L.onError==null||L.onError.call(L,h,N,L),L.throwOnError))throw h}},[]),k=o.useCallback(()=>{u.current=pt(),b({data:Oe,error:Oe,isMutating:!1})},[]);return ze(()=>{n.current=t,l.current=s,c.current=a}),{trigger:j,reset:k,get data(){return v.data=!0,f.data},get error(){return v.error=!0,f.error},get isMutating(){return v.isMutating=!0,f.isMutating}}},kn=_s(jn,Mn),Cn=""+new URL("fire-9fc0c83e.svg",import.meta.url).href,Sn=""+new URL("logout-b2b05b85.svg",import.meta.url).href,Nn="_entry_1d5ta_1",In="_panel_1d5ta_14",An="_switchLine_1d5ta_33",En="_itemLine_1d5ta_39",Rn="_logoutLine_1d5ta_50",$n="_userInfo_1d5ta_59",Fn="_head_1d5ta_68",On="_fireBg_1d5ta_77",Tn="_content_1d5ta_84",be={entry:Nn,panel:In,switchLine:An,itemLine:En,logoutLine:Rn,userInfo:$n,head:Fn,fireBg:On,content:Tn};function Dn(){const t=ye(),{globalSetting:s}=o.useContext(Vt),{logout:a}=o.useContext(Ue),{doTest:r}=Vs("#/workbench/rapi/loginBack",{closeWindow:!1}),{getConfigurationValue:n}=jt(),{data:l,trigger:c}=kn(`${n(s.nodeOptions.publicNodeUrl)}/auth/cookie/user`,j=>Wt.get(j,{withCredentials:!0}).then(k=>k.data)),{search:u}=Ee();o.useEffect(()=>{c(),Ut()},[u,c]);const g=()=>{a(n(s.nodeOptions.publicNodeUrl)).then(async j=>{location.reload()})},v=async j=>{await r(j.name)},b=Kt()??[],f=b==null?void 0:b.filter(j=>j.name!==(l==null?void 0:l.providerId));return e.jsxs("div",{className:be.entry,children:[e.jsx("img",{src:"./assets/icon/oidc.svg",className:"h-3 mr-2 w-3",alt:""}),e.jsx("span",{children:l?l.providerId:t.formatMessage({id:"4WvYRq",defaultMessage:[{type:0,value:"未登录"}]})}),e.jsxs("div",{className:be.panel,children:[l?e.jsxs("div",{className:be.userInfo,children:[e.jsx("img",{src:Cn,alt:"",className:be.fireBg}),e.jsxs("div",{className:be.head,children:[e.jsx("img",{src:"./assets/icon/oidc.svg",className:"h-6 mr-2 w-6",alt:""}),l.providerId]}),e.jsx("div",{className:be.content,children:e.jsx(Hs,{data:l})})]}):null,f.length>0&&e.jsx("div",{className:be.switchLine,children:t.formatMessage({id:"pywg9X",defaultMessage:[{type:0,value:"切换项目"}]})}),f.map(j=>e.jsxs("div",{className:be.itemLine,onClick:()=>v(j),children:[e.jsx("img",{src:"./assets/icon/oidc.svg",className:"h-4 mr-2.5 w-4",alt:""}),j.name]},j.name)),l!=null&&l.userId?e.jsxs("div",{className:be.logoutLine,onClick:g,children:[e.jsx("img",{src:Sn,className:"h-4 mr-2.5 w-4",alt:""}),t.formatMessage({id:"9Qz9G/",defaultMessage:[{type:0,value:"退出项目"}]})]}):null]})]})}const Pn=""+new URL("github-7bfaf42c.svg",import.meta.url).href,Bn=""+new URL("keyboard-ba711ae3.svg",import.meta.url).href,Ln=""+new URL("preview-2d4783d5.svg",import.meta.url).href,zn=""+new URL("question-82f091a9.svg",import.meta.url).href,qn=""+new URL("refresh-1c66fe10.svg",import.meta.url).href,Hn=""+new URL("setting-12dcc5b5.svg",import.meta.url).href,Vn="_header_gzxoc_1",Wn="_dashboardIcon_gzxoc_9",Un="_dashboardIcon2_gzxoc_15",Kn="_logo_gzxoc_23",Yn="_splitLine_gzxoc_31",Gn="_title_gzxoc_36",Qn="_titleIcon_gzxoc_40",Zn="_headBtn_gzxoc_46",Jn="_compiling_gzxoc_55",Xn="_breath_gzxoc_1",er="_helpIcon_gzxoc_70",tr="_configIcon_gzxoc_78",sr="_avatar_gzxoc_88",le={header:Vn,dashboardIcon:Wn,dashboardIcon2:Un,logo:Kn,splitLine:Yn,title:Gn,titleIcon:Qn,headBtn:Zn,compiling:Jn,breath:Xn,helpIcon:er,configIcon:tr,avatar:sr};function ar(t){const s=ye(),{appRuntime:a}=bt(),r=o.useMemo(()=>[{keys:["alt/^","h"],desc:s.formatMessage({id:"ATIkHk",defaultMessage:[{type:0,value:"打开快捷键提示"}]})},{keys:["alt/^","n"],desc:s.formatMessage({id:"qMKYtF",defaultMessage:[{type:0,value:"新建APi/新建模型"}]})},{keys:["alt/^","b"],desc:s.formatMessage({id:"U1eYS0",defaultMessage:[{type:0,value:"批量新建API"}]})},{keys:["alt/^","c"],desc:s.formatMessage({id:"0uAOrg",defaultMessage:[{type:0,value:"编译"}]})},{keys:["alt/^","m"],desc:s.formatMessage({id:"RuZ3Ak",defaultMessage:[{type:0,value:"切换API设计和模型设计"}]})},{keys:["alt/^","r"],desc:s.formatMessage({id:"7cCd7/",defaultMessage:[{type:0,value:"运行当前Operation"}]})},{keys:["alt/^","t"],desc:s.formatMessage({id:"+MrBgm",defaultMessage:[{type:0,value:"模型设计页切换设计/数据视图"}]})},{keys:["alt/^","shift","d"],desc:s.formatMessage({id:"nwr0JF",defaultMessage:[{type:0,value:"创建当前API的拷贝"}]})},{keys:["alt/^","shift","c"],desc:s.formatMessage({id:"EpuhM8",defaultMessage:[{type:0,value:"复制当前API请求链接"}]})},{keys:["alt/^","shift","t"],desc:s.formatMessage({id:"+jyuQU",defaultMessage:[{type:0,value:"API编辑页切换Json/表单模式，模型设计页切换设计/代码模式"}]})}],[s]),{clear:n}=lt(),l=Re(),{pathname:c}=Ee(),{isHideSide:u}=o.useContext(Ue),g=()=>{if(!a.dev){se.error("生产环境禁止重新编译");return}t.isCompiling||(n(),z.get("/engine/restart").then(()=>void se.success(s.formatMessage({id:"HalctF",defaultMessage:[{type:0,value:"开始编译"}]}))))},{modal:v}=Yt.useApp(),b=o.useCallback(()=>{ts.destroyAll(),v.info({width:"800px",icon:null,title:s.formatMessage({id:"VLmNWR",defaultMessage:[{type:0,value:"页面快捷键"}]}),content:e.jsx("div",{className:"flex flex-wrap",children:r.map(f=>e.jsxs("div",{className:"flex pt-1 pr-4 pb-3 pl-1 w-1/2 items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-40",children:f.keys.map(j=>e.jsx("kbd",{className:"rounded bg-true-gray-200 text-sm mr-1.5 py-1 px-1.5",children:j},j))}),e.jsx("span",{children:f.desc})]},f.desc))}),okText:s.formatMessage({id:"r1IImU",defaultMessage:[{type:0,value:"知道了"}]})})},[r,s,v]);return o.useEffect(()=>{const f=Ve("alt+c,^+c",()=>{g()}),j=Ve("alt+h,^+h",()=>{b()});return()=>{f(),j()}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:le.header,children:[e.jsx("div",{className:u?le.dashboardIcon2:le.dashboardIcon,onClick:()=>t.onToggleSider()}),e.jsx("div",{className:le.logo,onClick:()=>l("/workbench")}),e.jsx("div",{className:le.splitLine}),e.jsx("div",{className:le.title,children:e.jsx(M,{id:"xKCJNb",defaultMessage:[{type:0,value:"飞布控制台"}]})}),e.jsx("div",{className:"flex-1"}),c==="/workbench/rapi"?e.jsxs(e.Fragment,{children:[e.jsx(Dn,{}),e.jsx("div",{className:le.splitLine,style:{margin:"0 26px"}}),e.jsx("div",{className:"cursor-pointer h-5 text-0px",onClick:()=>{window.open(`/api/engine/swagger?auth-key=${xt()}`,"_blank")},children:e.jsx("img",{src:"./assets/download.svg",alt:""})})]}):e.jsxs(e.Fragment,{children:[a.dev?e.jsx("div",{className:le.headBtn,onClick:g,children:e.jsx(ee,{title:e.jsx(M,{id:"0uAOrg",defaultMessage:[{type:0,value:"编译"}]}),children:e.jsx("span",{className:"flex items-center",children:t.isCompiling?e.jsx("img",{src:"./assets/compile.gif",className:le.compiling,alt:"编译"}):e.jsx("img",{src:qn,className:"h-5 w-5.25",alt:"编译"})})})}):null,e.jsx("div",{className:le.headBtn,onClick:()=>window.open("./#/workbench/rapi?t="+Date.now(),"fb_rapi"),children:e.jsx(ee,{title:e.jsx(M,{id:"HtIFFg",defaultMessage:[{type:0,value:"Swagger文档"}]}),children:e.jsx("img",{src:Ln,className:"h-5 w-5",alt:"预览"})})})]}),e.jsx("div",{className:le.splitLine,style:{margin:"0 26px"}}),e.jsx("div",{className:"cursor-pointer flex-0 h-5 mb-1px text-0px w-4",onClick:()=>window.open("https://github.com/fireboomio","_blank"),children:e.jsx("img",{src:Pn,alt:""})}),e.jsx("div",{className:le.helpIcon,onClick:()=>window.open("https://www.fireboom.io/","_blank"),children:e.jsx("img",{src:zn,alt:""})}),e.jsx(ss,{placement:"bottomRight",content:e.jsxs("div",{className:"p-2 bg-white rounded-lg flex flex-col items-center shadow-xl",children:[e.jsx("img",{src:"https://fireboom.oss-cn-hangzhou.aliyuncs.com/img/qun_qr.png",className:"w-45",alt:"qun_qrcode"}),e.jsx("p",{children:"扫码加入开发者交流群"})]}),children:e.jsx("div",{className:"cursor-pointer flex h-5 ml-4 items-center",children:e.jsx(za,{className:"text-[#787D8B] text-base"})})}),e.jsx(ee,{title:s.formatMessage({id:"sRkj0b",defaultMessage:[{type:0,value:"快捷键"}]}),children:e.jsx("div",{className:"cursor-pointer flex h-5 ml-4 items-center",onClick:b,children:e.jsx("img",{src:Bn,alt:""})})}),e.jsx("div",{className:le.configIcon,onClick:()=>l("/workbench/setting"),children:e.jsx("img",{src:Hn,alt:""})})]})})}function us(t,s){var r;const a=[];for(const[n,l]of t.entries())(r=l.children)!=null&&r.length?a.push(...us(l.children,`${s}-${n}`)):a.push({...l,pos:`${s}-${n}`});return a}function nr(t,s,a){if(t&&s&&a.length){const r=us(a,"0"),n=r.findIndex(c=>c.pos===t),l=r.findIndex(c=>c.pos===s);if(n>-1&&l>-1)return n>l?r.slice(l,n+1).map(c=>c.key):r.slice(n,l+1).map(c=>c.key)}return[]}const fs=o.forwardRef((t,s)=>{const a=o.useRef({});o.useImperativeHandle(s,()=>({addItem:P,editItem:$}));const r=o.useRef(null),[n,l]=o.useState(500),[c,u]=o.useState([]),g=ye(),[v,b]=o.useState([]),[f,j]=o.useState(null),[k,I]=o.useState([]),[A,N]=o.useState([]),[_,L]=o.useState(""),W=o.useRef(),[h,E]=o.useState(""),R=o.useRef(!1),B=o.useMemo(()=>{function x(i){var p;w[i.key]=i,(p=i.children)==null||p.forEach(x)}const w={};return v==null||v.forEach(x),w},[v]),S=o.useMemo(()=>{if(!v||!f&&!h)return v;const x=Se.cloneDeep(v),w=mt(x,h);if(w&&(w.isInput=!0),f){const i=mt(x,f==null?void 0:f.parentKey),p={name:"",path:"",key:"temp"+Date.now(),isDir:f.isDir,isInput:!0,isNew:!0,parent:i,pos:""};i?(i.children=i.children??[],i.children.unshift(p)):x.unshift(p)}return x},[v,f,h]);o.useEffect(()=>{const x=Se.cloneDeep(t.treeData);function w(i){var p;(p=i.children)==null||p.forEach(y=>{y.parent=i,w(y)})}x==null||x.map(w),b(x)},[t.treeData]);const H=o.useRef(),d=o.useRef();o.useEffect(()=>{if(!(H.current===t.selectedKey&&d.current===B&&t.selectedKey)&&(H.current=t.selectedKey,N(t.selectedKey?[t.selectedKey]:[]),t.selectedKey)){console.log(B);const x=B[t.selectedKey];if(x){const w=[];let i=x.parent;for(;i;)w.push(i.key),i=i.parent;I(p=>[...p,...w])}}},[t.selectedKey,B]);const P=o.useCallback((x,w=!1,i)=>{const p=w?null:B[i??_],y=p!=null&&p.isDir?p:p==null?void 0:p.parent;j({isDir:x,parentKey:(y==null?void 0:y.key)??""}),I([...k,i??_])},[k,B,_]),$=o.useCallback(x=>{E(x)},[E]),F=o.useCallback((x,w)=>{var p;if(w.node.isInput)return;L(w.node.key);const i=W.current;if(W.current=w.node.pos,w.nativeEvent.shiftKey){if(i){const y=nr(W.current,i,v);N(y)}}else w.nativeEvent.ctrlKey||w.nativeEvent.metaKey?A.includes(w.node.key)?N(A.filter(y=>y!==w.node.key)):N([...A,w.node.key]):(N([w.node.key]),(p=t.onSelectFile)==null||p.call(t,w.node));w.node.isDir&&(k.includes(w.node.key)?I(k.filter(y=>y!==w.node.key)):I([...k,w.node.key]))},[A,t,k]),ae=Se.debounce(async(x,w,i)=>{var p,y,C;if(!R.current){if(R.current=!0,x.isNew)(await((y=t.onCreateItem)==null?void 0:y.call(t,mt(v,((p=x.parent)==null?void 0:p.key)??"")??null,x.isDir,w))||i)&&j(null);else{if(x.name===w){E(""),R.current=!1;return}(await((C=t.onRename)==null?void 0:C.call(t,x,w))||i)&&E("")}R.current=!1}},100),ge=x=>{var i,p;A.includes(x.key)||(N([x.key]),(i=t.onSelectFile)==null||i.call(t,x));const w=A.includes(x.key)?A.map(y=>B[y]):[x];u(((p=t.onContextMenu)==null?void 0:p.call(t,w,rr(w)))??[])};return o.useEffect(()=>{function x(){var i;l(((i=r.current)==null?void 0:i.clientHeight)??0)}x();const w=new ResizeObserver(x);return w.observe(r.current),()=>{w.disconnect()}},[]),e.jsx(it,{className:t.rootClassName,open:c.length>0,onOpenChange:x=>!x&&u([]),menu:{items:c,onClick:()=>u([])},trigger:["contextMenu"],children:e.jsxs("div",{onClick:()=>{N([]),L(""),W.current=""},ref:r,onContextMenu:x=>{Se.get(x,"isFromChild")||u([{key:"1",label:g.formatMessage({id:"tVoPUq",defaultMessage:[{type:0,value:"新建"}]})+(t.fileText||g.formatMessage({id:"saeFbf",defaultMessage:[{type:0,value:"文件"}]})),onClick:()=>P(!1,!0)},{key:"2",label:g.formatMessage({id:"iveGBB",defaultMessage:[{type:0,value:"新建文件夹"}]}),onClick:()=>P(!0,!0)}])},children:[e.jsx(Gs,{onClick:x=>x.stopPropagation(),height:n,rootClassName:t.treeClassName,draggable:t.draggable?{icon:!1}:!1,onDrop:({node:x,dragNode:w,dropToGap:i})=>{var y,C;const p=i?x.parent??null:x;((y=w.parent)==null?void 0:y.key)!==(p==null?void 0:p.key)&&((C=t.onMove)==null||C.call(t,w,i?x.parent??null:x))},allowDrop:({dropNode:x,dropPosition:w})=>!(!x.isDir&&w===0),onDragEnter:x=>{for(const w of Object.keys(a.current))clearTimeout(a.current[w]);a.current[x.node.key]=window.setTimeout(()=>{k.includes(x.node.key)||(console.log("expand",x.node.key),I([...k,x.node.key])),delete a.current[x.node.key]},800)},titleRender:x=>{var w;return x.isInput?e.jsx(Gt,{size:"small",autoFocus:!0,defaultValue:x.name,onPressEnter:i=>{ae(x,Se.get(i,"target.value"),!1)},onBlur:i=>{ae(x,i.target.value,!0)}}):e.jsx("div",{onContextMenu:i=>{Se.set(i,"isFromChild",!0),ge(x)},children:(w=t.titleRender)==null?void 0:w.call(t,x)})},defaultExpandParent:!0,treeData:S,multiple:!0,expandedKeys:k,selectedKeys:A,onSelect:F}),t.footer]})})});fs.displayName="FileTree";const ms=fs;function mt(t,s){const a=[...t];for(;a.length;){const r=a.pop();if(r.key===s)return r;r.children&&a.push(...r.children)}}function rr(t){const s=[...t],a=[];for(;s.length;){const r=s.pop();a.push(r),r.children&&s.push(...r.children)}return a.reverse(),a}const ir="_headerFilter_1a7eo_1",or="_headerConfig_1a7eo_2",lr="_headerRefresh_1a7eo_3",cr="_headerNewFold_1a7eo_4",dr="_headerNewFile_1a7eo_5",ur="_createRowWrapper_1a7eo_25",fr="_createRow_1a7eo_25",mr="_btn_1a7eo_44",hr="_graphqlEntry_1a7eo_48",gr="_treeContainer_1a7eo_59",pr="_treeItem_1a7eo_117",xr="_title_1a7eo_117",vr="_treeItemDir_1a7eo_126",yr="_icon_1a7eo_126",br="_proxyIcon_1a7eo_130",_r="_functionIcon_1a7eo_133",jr="_treeItemFile_1a7eo_136",wr="_treeItemErr_1a7eo_140",Mr="_lighting_1a7eo_144",kr="_treeItemDisable_1a7eo_147",Cr="_suffix_1a7eo_180",Sr="_errLabel_1a7eo_185",Nr="_more_1a7eo_198",Ir="_method_1a7eo_208",Ar="_method_get_1a7eo_214",Er="_method_post_1a7eo_217",Rr="_menuItem_1a7eo_220",V={headerFilter:ir,headerConfig:or,headerRefresh:lr,headerNewFold:cr,headerNewFile:dr,createRowWrapper:ur,createRow:fr,btn:mr,graphqlEntry:hr,treeContainer:gr,treeItem:pr,title:xr,treeItemDir:vr,icon:yr,proxyIcon:br,functionIcon:_r,treeItemFile:jr,treeItemErr:wr,lighting:Mr,treeItemDisable:kr,suffix:Cr,errLabel:Sr,more:Nr,method:Ir,method_get:Ar,method_post:Er,menuItem:Rr},$r="_container_ks0ti_1",Fr="_active_ks0ti_9",Or="_header_ks0ti_16",Tr="_arrow_ks0ti_26",Dr="_headerOpen_ks0ti_33",Pr="_title_ks0ti_36",Br="_add_ks0ti_47",Lr="_action_ks0ti_53",zr="_content_ks0ti_60",_e={container:$r,active:Fr,header:Or,arrow:Tr,headerOpen:Dr,title:Pr,add:Br,action:Lr,content:zr};function Ct(t){const s=ye(),[a,r]=o.useState(!1),n=o.useRef(null);o.useEffect(()=>{t.open!==void 0?l(t.open):t.defaultOpen&&l(!0)},[t.defaultOpen,t.open]),o.useEffect(()=>{var c;t.scrollBottom!==void 0&&(c=n==null?void 0:n.current)!=null&&c.scrollTop&&(n.current.scrollTop=1e6)},[t.scrollBottom]);const l=c=>{r(c),t.onOpen&&t.onOpen(c)};return e.jsxs("div",{className:`${_e.container} ${a?_e.active:""}`,children:[e.jsxs("div",{className:`${_e.header} ${a?_e.headerOpen:""}`,onClick:c=>l(!a),children:[e.jsx("div",{className:_e.arrow}),e.jsx("div",{className:_e.title,children:t.title}),e.jsxs("div",{className:_e.action,onClick:c=>c.stopPropagation(),children:[t.action?t.action:null,t.hideAdd?null:e.jsx(ee,{title:s.formatMessage({id:"tVoPUq",defaultMessage:[{type:0,value:"新建"}]}),children:e.jsx("div",{className:_e.add,onClick:t.onAdd})})]})]}),e.jsx("div",{ref:n,className:`${a?"":"hidden"} ${_e.content}`,children:t.children})]})}function qr(t){const s=ye(),a=Re(),r=Ee(),n=Qt(),{checkSupport:l}=Zs(),c=n["*"],[u,g]=o.useState(),[v,b]=o.useState(!1),[f,j]=o.useState(""),{vscode:k}=o.useContext(He),[I,A]=ts.useModal(),N=o.useRef({addItem:()=>{},editItem:()=>{}}),{computed:{saved:_},autoSave:L}=Qs(),{operation:W}=As();o.useEffect(()=>{const i=Ve("alt+n,^+n",()=>{}),p=Ve("alt+b,^+b",()=>{a("/workbench/apimanage/crud")});return()=>{i(),p()}},[a]),o.useEffect(()=>{if(u&&c){const i=Tt(c,u);i?j(i.key):a("/workbench/apimanage")}},[c,r,a,n,u]),o.useEffect(()=>{t.defaultOpen&&b(!0)},[t.defaultOpen]);const h=Es();o.useEffect(()=>{const i=hs(h??[],"0");g(i)},[h]);function E(i){if(i.isDir)return"";if(i.extra.invalid)return e.jsx("div",{className:V.errLabel,children:e.jsx(M,{id:"n6o1H/",defaultMessage:[{type:0,value:"非法"}]})});if(i.extra.internal)return e.jsx(M,{id:"ptadMC",defaultMessage:[{type:0,value:"内部"}]})}const R=o.useCallback((i,p=!1)=>async(...y)=>{const C=se.loading(s.formatMessage({id:"QpRtOT",defaultMessage:[{type:0,value:"执行中"}]}));try{await i(...y),!p&&await Ae()}catch{}C()},[s]),B=R(async(i,p)=>{const y=i.filter(C=>!C.isDir).map(C=>C.path);await z.put("operation/batch",y.map(C=>({path:C,enabled:p}))),Te.emit({event:"apiEnableChange",data:{pathList:y,enabled:p}})}),S=R(async i=>{I.confirm({title:s.formatMessage({id:"JJvpR5",defaultMessage:[{type:0,value:"是否确认删除选中的API？"}]}),onOk:R(async()=>{const p=i.filter(y=>!y.isDir).map(y=>y.path);await z.delete("operation/batch",{params:{dataNames:p.join(",")}}),p.forEach(y=>localStorage.removeItem(`_api_args_${y}`)),se.success(s.formatMessage({id:"aiBGBs",defaultMessage:[{type:0,value:"删除成功"}]}))}),okText:s.formatMessage({id:"FEb7U2",defaultMessage:[{type:0,value:"确认"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})}),H=R(async i=>{i.isDir?await z.delete(`/operation/deleteParent/${i.path}`):await z.delete(`/operation/${i.path}`),localStorage.removeItem(`_api_args_${i.path}`)}),d=R(async(i,p)=>{p?(await z.post("/vscode/createDirectory",{uri:`${W}/${i}`}),await Ae()):(await z.post("/operation",{path:i}),await Ae(),a(`/workbench/apimanage/${i}`))},!0),P=R(async(i,p)=>{const y=i.path,C=y.replace(/[^/]+$/,p);i.isDir?await z.post("/operation/renameParent",{src:y,dst:C,overload:!1}):(await z.post("/operation/rename",{src:y,dst:C,overload:!1}),i.path===c&&Te.emit({event:"titleChange",data:{title:p,path:C}}))}),$=R(async(i,p,y=!1)=>{var ue;const C=i.path,T=`${p!=null&&p.path?`${p.path}/`:""}${(ue=i.path)==null?void 0:ue.split("/").pop()}`,re=!!Tt(c,[i]);i.isDir?await z.post("/operation/renameParent",{src:C,dst:T,overload:y},{onError:async({code:J,result:me})=>{J==="20000000"&&await F(me,()=>$(i,p,!0))}}):await z.post("/operation/rename",{src:C,dst:T,overload:y},{onError:async({code:J,result:me})=>{J==="20000000"&&await F([me],()=>$(i,p,!0))}});const de=await Ae();if(re){const J=Hr(c,de);J&&Te.emit({event:"titleChange",data:{title:J.path.split("/").pop()??"",path:J.path}})}},!0),F=o.useCallback((i,p)=>{I.confirm({title:s.formatMessage({id:"4godzk",defaultMessage:[{type:0,value:"以下API已存在，是否覆盖？"}]}),content:i.map(y=>e.jsx("div",{children:y.path},y.path)),onOk:p,okText:s.formatMessage({id:"TEs+AV",defaultMessage:[{type:0,value:"覆盖"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})},[s,I]),ae=i=>{var de,ue,J,me,$e;const p=E(i);let y;i.isDir?y=V.treeItemDir:i.extra.invalid?y=V.treeItemErr:i.extra.enabled?y=V.treeItemFile:y=V.treeItemDisable;let C=i.parent;for(;C&&C.parent;)C=C.parent;const T=!i.isDir&&((de=i.extra)==null?void 0:de.engine)!==ut.GraphQL,re=i.isDir&&["function","proxy"].includes((C==null?void 0:C.name)??i.name);return e.jsxs("div",{className:`${V.treeItem} ${y}`,children:[e.jsx("div",{className:at(V.icon,[i.name==="proxy"?V.proxyIcon:i.name==="function"?V.functionIcon:""]),children:(ue=i.extra)!=null&&ue.liveQueryEnabled?e.jsx("div",{className:V.lighting}):null}),e.jsxs(e.Fragment,{children:[((J=i.extra)==null?void 0:J.method)&&e.jsx("div",{className:`${V.method} ${V[`method_${(me=i.extra.method)==null?void 0:me.toLowerCase()}`]}`,children:($e=i.extra.method)==null?void 0:$e.toUpperCase()}),e.jsx("div",{className:V.title,children:i.name}),e.jsx("div",{className:V.suffix,children:p}),!re&&e.jsx("div",{onClick:Z=>Z.stopPropagation(),children:e.jsx(it,{destroyPopupOnHide:!0,menu:{items:[{key:"copy",onClick:async()=>{const Z=`${i.path}Copy${Math.random().toString(36).substring(2,5)}`;await z.post("/operation/copy",{dst:Z,src:i.path,overload:!1}),se.success(s.formatMessage({id:"PvMD53",defaultMessage:[{type:0,value:"已复制接口 "},{type:1,value:"path"}]},{path:Z})),Ae()},label:e.jsx("div",{children:e.jsxs("span",{className:"ml-1.5",children:[e.jsx(M,{id:"qUKj7E",defaultMessage:[{type:0,value:"复制"}]})," "]})})},{key:"rename",onClick:()=>{N.current.editItem(i.key)},label:e.jsx("div",{children:e.jsxs("span",{className:"ml-1.5",children:[e.jsx(M,{id:"JeJAmT",defaultMessage:[{type:0,value:"重命名"}]})," "]})})},{key:"delete",label:e.jsx("div",{onClick:Z=>{var pe,Me;console.log(Z),(Me=(pe=Z.target)==null?void 0:pe.dataset)!=null&&Me.stoppropagation&&Z.stopPropagation()},children:e.jsx(Mt,{zIndex:9999,title:s.formatMessage({id:"9Fxs0Y",defaultMessage:[{type:0,value:"确定删除吗?"}]}),onConfirm:()=>{H(i)},okText:s.formatMessage({id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),placement:"right",children:e.jsx("div",{className:V.menuItem,"data-stoppropagation":"1",children:e.jsx("span",{className:"ml-1.5",children:e.jsx(M,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})})})})})}].filter(Z=>T?Z.key==="delete":Z.key!=="copy"||!i.isDir)},trigger:["click"],placement:"bottomRight",children:e.jsx("div",{className:V.more,onClick:Z=>Z.preventDefault()})})})]})]})},{validateAPI:ge}=wt(),x=(i,p=!1)=>{const y=ge(i);return y?(se.error(y),!1):!0},w=o.useCallback((i,p)=>{if(i.some(T=>{var re,de;return T.isDir&&((re=T.path)==null?void 0:re.match(/^(proxy|function)/))||((de=T.extra)==null?void 0:de.engine)!==ut.GraphQL}))return[];const y=[{key:"on",onClick:()=>void B(p,!0),disabled:!p.some(T=>!T.isDir&&!T.extra.enabled&&!T.extra.invalid),label:e.jsx(M,{id:"WiL7+z",defaultMessage:[{type:0,value:"上线"}]})},{key:"off",onClick:()=>void B(p,!1),disabled:!p.some(T=>!T.isDir&&T.extra.enabled),label:e.jsx(M,{id:"MFe3Kw",defaultMessage:[{type:0,value:"下线"}]})}];return i.some(T=>!T.isDir)&&y.push({key:"delete",onClick:()=>void S(i),label:e.jsx(M,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})}),y},[S,B]);return e.jsxs(Ct,{...t,title:s.formatMessage({id:"zQEdCX",defaultMessage:[{type:0,value:"API管理"}]}),hideAdd:!0,open:v,onOpen:i=>{b(i),t.onOpen&&t.onOpen(i)},action:e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:"筛选",children:e.jsx("div",{className:V.headerFilter,onClick:()=>{Te.emit({event:"openApiSearch"})}})}),e.jsx(ee,{title:s.formatMessage({id:"IQIvYd",defaultMessage:[{type:0,value:"刷新列表"}]}),children:e.jsx("div",{className:V.headerRefresh,onClick:()=>{Ae()}})}),e.jsx(ee,{title:s.formatMessage({id:"aI3L5g",defaultMessage:[{type:0,value:"全局设置"}]}),children:e.jsx("div",{className:V.headerConfig,onClick:()=>{a("/workbench/setting/global-api-setting")}})}),e.jsx(ee,{title:s.formatMessage({id:"AatDue",defaultMessage:[{type:0,value:"新建目录"}]}),children:e.jsx("div",{className:V.headerNewFold,onClick:()=>{b(!0),N.current.addItem(!0)}})}),e.jsx(ee,{title:s.formatMessage({id:"QarRBC",defaultMessage:[{type:0,value:"新建API"}]}),children:e.jsx("div",{className:V.headerNewFile,onClick:()=>{b(!0),N.current.addItem(!1)}})})]}),children:[e.jsx(ms,{draggable:!0,fileText:"API",ref:N,onSelectFile:async i=>{var p;i.isDir||(_||await I.confirm({content:s.formatMessage({id:"A+dL0F",defaultMessage:[{type:0,value:"当前 API 未保存，是否保存"}]}),okText:s.formatMessage({id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]}),cancelText:s.formatMessage({id:"YG2xru",defaultMessage:[{type:0,value:"不保存"}]}),cancelButtonProps:{danger:!0}})&&(se.open({type:"loading",content:s.formatMessage({id:"lUmMMK",defaultMessage:[{type:0,value:"自动保存中"}]})}),await L(),se.destroy()),((p=i.extra)==null?void 0:p.engine)===ut.GraphQL?a(`/workbench/apimanage/${i.path}`):a(`/workbench/apimanage/custom/${i.path}`))},onCreateItem:async(i,p,y)=>{if(y&&x(y,p)){let C=i;for(;C!=null&&C.parent;)C=C==null?void 0:C.parent;if((C==null?void 0:C.name)==="function"||(C==null?void 0:C.name)==="proxy"){if(await l(C.name)){const T=await z.get("/sdk/enabledServer");T!=null&&T.extension&&await k.show(`${T.outputPath}/${i==null?void 0:i.path}/${y}${T.extension}`)&&se.info(s.formatMessage({id:"qd+Bp3",defaultMessage:[{type:0,value:"数据源创建成功，请在编辑完成后重启钩子服务"}]}))}return!0}else try{return await d(i!=null&&i.path?`${i==null?void 0:i.path}/${y}`:y,p),!0}catch(T){return console.error(T),!1}}return!1},onRename:async(i,p)=>{if(p&&x(p,i.isDir))try{return await P(i,p),!0}catch(y){return console.error(y),!1}return!1},onMove:$,onContextMenu:w,selectedKey:f,rootClassName:"h-full",treeClassName:V.treeContainer,treeData:u??[],titleRender:ae,footer:e.jsxs("div",{className:V.createRowWrapper,children:[e.jsxs("div",{className:V.createRow,onContextMenu:i=>i.stopPropagation(),children:[e.jsx("span",{className:V.btn,onClick:()=>N.current.addItem(!1),children:e.jsx(M,{id:"tVoPUq",defaultMessage:[{type:0,value:"新建"}]})}),e.jsxs("span",{children:[" ",e.jsx(M,{id:"/g7pR0",defaultMessage:[{type:0,value:"或者"}]})," "]}),e.jsx("span",{className:V.btn,onClick:()=>a("/workbench/apimanage/crud"),children:e.jsx(M,{id:"SJbKgr",defaultMessage:[{type:0,value:"批量新建"}]})})]}),e.jsx(ee,{title:s.formatMessage({id:"mPsm6o",defaultMessage:[{type:0,value:"测试"}]}),children:e.jsx("div",{onContextMenu:i=>i.stopPropagation(),className:V.graphqlEntry,onClick:()=>{window.open(`${window.location.origin}/app/main/graphql`,"_blank")},children:e.jsx("img",{alt:"",src:"./assets/icon/graphql2.svg"})})})]})}),A]})}function hs(t,s="0"){return t?t.map((a,r)=>({...a,key:`${a.isDir?0:1}-${a.path}`,children:hs(a.items??[],`${s}-${r}`)})):[]}function Tt(t,s=[]){const a=[...s];for(;a.length;){const r=a.pop();if(r.path===t)return r;r.children&&a.push(...r.children)}}function Hr(t,s=[]){const a=[...s];for(;a.length;){const r=a.pop();if(r.path===t)return r;r.children&&a.push(...r.children)}}function Vr(){return Rs("/hook/model")}const Wr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAMAAACf4xmcAAAAyVBMVEX///8AAADk5u7r6+vl5fDh5ezh4+zo6P/i5u7p6fTn5+/k5PLh4uzh4+zj4+7l5e/h5e7////////i5O3t7e3h4+zh4+vh5O3g5Ozg4+y5u8Osr7i3ucGprbbg4+zg4+vi4+u0ucHh4+zh4+3h4+ydoqz////KzNL7+/tvb2/a2tp4eHjn5+fz8/P4+PiIiIi9vb2dnZ2WlpaQkJCMjIx1dXXs7Oze3t7V1dXNzc3Kysq6urqkpKSFhYWAgIDBwcG2tra0tLSvr6+PjHOpAAAAJnRSTlMFABsNMU1uCisWHxKykUgmOggHYA5sZlVCjfHx6emtppyZh354ZROrV6sAAAGMSURBVDjLjdTHloIwFIDhSEsCMwFE7L0gKIi965T3f6jRSJGBiP/Cjd+CnHPvBYUwkFH85+O3qEPIp4JQLwaAIlhSMOZSYayU4A1SBnRe4WQVIeFfCKkyp/A6oKzIY3nUHGfWGsmYL94ZgIqMWhajJpIVCO6sxKnamMXGmsqV7kxXZIGwGRFkRb8xiFWtwmYVTcWwAADEqGqwmVFFGAIAeA6RcszsH391eGJlgjieMkE0Y3a+HOebY8xMUYiYFDHPcS1rvo6ZlMm2jmdZh0ses/zzbOv/5jLXd5zFLI/ZrrufuK79knkLJ2jhvWDrpWvT3NWKzfbT6KNm0wmTnZZW1HLOZN+LJ3Zisvnajl7sfzGZd91MgzZXj/3S2W4StLMZL02VZiabmZRFY8koGks65HUWazyGPFiZXmOcWb1HVyZcQGNY63baH4nanW5taNAFDNdZNKRBv/aZqNYfSIZI1zk8DhqpGGVTSmSWjQrR6HEIT40qaFVCxESEVDVBpafm/cOVfwbfP6pvnug/q0l7fEavwhQAAAAASUVORK5CYII=",Ur="_container_13jx4_1",Kr="_row_13jx4_4",Yr="_active_13jx4_16",Gr="_rowDisable_13jx4_30",Qr="_icon_13jx4_30",Zr="_title_13jx4_33",Jr="_tip_13jx4_54",Xr="_more_13jx4_65",ei="_bottomRowWrapper_13jx4_75",ti="_bottomRow_13jx4_75",si="_btn_13jx4_94",fe={container:Ur,row:Kr,active:Yr,rowDisable:Gr,icon:Qr,title:Zr,tip:Jr,more:Xr,bottomRowWrapper:ei,bottomRow:ti,btn:si};function Dt(t){var H;const s=ye(),{validateName:a}=wt(),{vscode:r}=o.useContext(He),n=Re(),l=Zt(),c=$s(),u=Kt(),{getConfigurationValue:g}=jt(),v=o.useMemo(()=>{if(t.type==="dataSource")return c?c.map(d=>{var ge,x;let P="other",$=Js(d),F="",ae=d.kind===Xs.Graphql&&d.customGraphql.customized;if(ea(d))if(((ge=d.customDatabase)==null?void 0:ge.kind)===1)F=d.customDatabase.databaseAlone.database;else{const w=g(d.customDatabase.databaseUrl);w&&(F=((x=zs(w))==null?void 0:x.dbName)??"")}return{readonly:ae||d.readonly,name:d.name,icon:P,sourceType:d.sourceType,tip:F,enabled:d.enabled,_row:d,svg:$}}):[];if(t.type==="auth")return u?u.map(d=>{const P="other",$="OIDC";return{name:d.name,icon:P,tip:$,enabled:d.oidcConfigEnabled||d.jwksProviderEnabled,_row:d,svg:"./assets/icon/oidc.svg"}}):[];if(t.type==="storage")return l?l.map(d=>{const P="other",$="";return{name:d.name,icon:P,tip:$,enabled:d.enabled,_row:d,svg:"./assets/icon/file.svg"}}):[]},[c,u,l,t.type]),b=o.useMemo(()=>({dataSource:{title:s.formatMessage({id:"C5D7TM",defaultMessage:[{type:0,value:"数据源"}]}),openItem:d=>`/workbench/data-source/${d}`,newItem:"/workbench/data-source/new",request:{getList:()=>{tt()},editItem:async d=>await z.post("/datasource/rename",d),delItem:async d=>await z.delete(`/datasource/${d}`)},navMenu:d=>d.sourceType===4?d.enabled?[{key:"disable",label:e.jsx("div",{onClick:async()=>{await z.put("/datasource",{name:d.name,enabled:!1}),tt()},children:e.jsx("span",{className:"ml-1.5",children:e.jsx(M,{id:"jryv+i",defaultMessage:[{type:0,value:"停用"}]})})})}]:[{key:"enable",label:e.jsx("div",{onClick:async()=>{await z.put("/datasource",{name:d.name,enabled:!0}),tt()},children:e.jsx("span",{className:"ml-1.5",children:e.jsx(M,{id:"sZSyGZ",defaultMessage:[{type:0,value:"启用"}]})})})}]:[]},auth:{title:s.formatMessage({id:"UEiMSy",defaultMessage:[{type:0,value:"身份验证"}]}),openItem:d=>`/workbench/auth/${d}`,newItem:"/workbench/auth/new",navAction:[{icon:Wr,path:"/workbench/auth/role/role",tooltip:s.formatMessage({id:"WWNrrS",defaultMessage:[{type:0,value:"权限管理"}]})}],bottom:e.jsx("div",{className:fe.bottomRowWrapper,children:e.jsx("div",{className:fe.bottomRow,children:e.jsx("span",{className:fe.btn,onClick:()=>n("/workbench/setting/security"),children:e.jsx(M,{id:"xzl0Bm",defaultMessage:[{type:0,value:"配置登录回调"}]})})})}),request:{getList:()=>{Ut()},editItem:async d=>await z.post("/authentication/rename",d),delItem:async d=>await z.delete(`/authentication/${d}`)}}}),[s,n,r.toggleOperationHook]),f=o.useMemo(()=>b[t.type],[b,t.type]),j=Ee(),[k,I]=o.useState(),[A,N]=o.useState(),{refreshMap:_,navCheck:L}=o.useContext(Ue),[W,h]=o.useState(!1);if(!v)return null;const E=d=>{var $;const P=[{key:"rename",disabled:d.readonly,label:e.jsx("div",{onClick:()=>!d.readonly&&I(d),children:e.jsx("span",{className:"ml-1.5",children:e.jsx(M,{id:"JeJAmT",defaultMessage:[{type:0,value:"重命名"}]})})})},{key:"delete",disabled:d.readonly,label:e.jsx(Mt,{zIndex:9999,placement:"right",title:s.formatMessage({id:"I0f7tt",defaultMessage:[{type:0,value:"确认删除吗？"}]}),onConfirm:()=>void R(A),okText:s.formatMessage({id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),overlayClassName:fe["delete-label"],okType:"danger",trigger:d.readonly?"":"click",children:e.jsx("div",{children:e.jsx("span",{className:"ml-1.5",children:e.jsx(M,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})})})})}];return f.navMenu&&P.unshift(...(($=f.navMenu)==null?void 0:$.call(f,d))??[]),e.jsx(Ys,{onClick:F=>{F.key!=="delete"&&N(void 0)},items:P})},R=async d=>{if(d&&(await f.request.delItem(d),f.request.getList(),N(void 0),f.openItem(d)===j.pathname)){const P=v.findIndex($=>$.name!==d);P>=0?S(v[P]):n(f.newItem)}},B=async d=>{const P=k==null?void 0:k._row;if(P===void 0)return;const $=a(d);if($){se.error($);return}await f.request.editItem({src:P.name,dst:d,overload:!1}),f.request.getList(),I(void 0),Vr()},S=d=>{if(d.openInNewPage){window.open(d.openInNewPage);return}const P=f.openItem(d.name);L().then($=>{$&&n(P)})};return e.jsx(Ct,{title:f.title,onAdd:()=>n(f.newItem),onOpen:d=>h(d),defaultOpen:t.defaultOpen,action:e.jsx(e.Fragment,{children:(H=f.navAction)==null?void 0:H.map(d=>e.jsxs(ee,{title:d.tooltip,children:[e.jsx("div",{className:"flex mr-1.5",onClick:()=>n(d.path),children:e.jsx("img",{width:19,height:19,src:d.icon,alt:"头像"})})," "]},d.path))}),children:e.jsxs("div",{className:fe.container,children:[v.map(d=>{const P=f.openItem(d.name);return e.jsxs("div",{className:`${fe.row} ${d.enabled?"":fe.rowDisable} ${P===j.pathname?fe.active:""}`,onClick:()=>S(d),children:[(k==null?void 0:k.name)===d.name&&k?e.jsx(Gt,{onPressEnter:$=>void B($.target.value),onBlur:$=>void B($.target.value),onKeyUp:$=>{$.key=="Escape"&&I(void 0)},className:"font-normal h-5 text-sm leading-4 w-5/7",defaultValue:k.name,autoFocus:!0,placeholder:s.formatMessage({id:"nooQRz",defaultMessage:[{type:0,value:"请输入外部数据源名"}]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:fe.icon,children:e.jsx(ta,{width:12,height:12,preview:!1,alt:d.name,src:d.svg??"./assets/icon/github-fill.svg"})}),e.jsx("div",{className:fe.title,children:d.name}),e.jsx("div",{className:fe.tip,title:d.tip,children:d.tip})]}),e.jsx("div",{onClick:$=>$.stopPropagation(),children:e.jsx(it,{dropdownRender:()=>E(d),trigger:["click"],open:A===d.name,onOpenChange:$=>{N($?d.name:void 0)},placement:"bottomRight",children:e.jsx("div",{className:fe.more,onClick:$=>$.preventDefault()})})})]},d.name)}),f.bottom]})})}const ai="_headerFilter_1fjqx_1",ni="_headerConfig_1fjqx_2",ri="_headerRefresh_1fjqx_3",ii="_headerNewFold_1fjqx_4",oi="_headerNewFile_1fjqx_5",li="_createRowWrapper_1fjqx_25",ci="_createRow_1fjqx_25",di="_btn_1fjqx_44",ui="_graphqlEntry_1fjqx_48",fi="_treeContainer_1fjqx_59",mi="_treeItem_1fjqx_117",hi="_title_1fjqx_117",gi="_treeItemDir_1fjqx_126",pi="_icon_1fjqx_126",xi="_treeItemFile_1fjqx_130",vi="_lighting_1fjqx_138",yi="_suffix_1fjqx_160",bi="_errLabel_1fjqx_165",_i="_more_1fjqx_178",ji="_method_1fjqx_188",wi="_method_get_1fjqx_193",Mi="_method_post_1fjqx_196",ki="_menuItem_1fjqx_199",he={headerFilter:ai,headerConfig:ni,headerRefresh:ri,headerNewFold:ii,headerNewFile:oi,createRowWrapper:li,createRow:ci,btn:di,graphqlEntry:ui,treeContainer:fi,treeItem:mi,title:hi,treeItemDir:gi,icon:pi,treeItemFile:xi,lighting:vi,suffix:yi,errLabel:bi,more:_i,method:ji,method_get:wi,method_post:Mi,menuItem:ki};function Ci(t){const s=ye(),a=Re(),r=Ee(),n=Qt(),[l,c]=o.useState(),[u,g]=o.useState(!1),[v,b]=o.useState(""),{validateName:f}=wt(),j=o.useRef({addItem:()=>{},editItem:()=>{}});o.useEffect(()=>{var E;if(!l||!n.name||n.name==="new"||!r.pathname.startsWith("/workbench/storage")){b("");return}const h=l.find(R=>R.data.name===n.name);if(!h){a("/workbench/storage",{replace:!0});return}if(n.profile&&!((E=h.children)!=null&&E.find(R=>R.key===`${n.name}_${n.profile}`))){a(`/workbench/storage/${n.name}`,{replace:!0});return}b((n.profile?`${n.name}_${n.profile}`:n.name)??"")},[r,a,n,l]),o.useEffect(()=>{t.defaultOpen&&g(!0)},[t.defaultOpen]);const k=Zt();o.useEffect(()=>{const h=(k??[]).map(E=>{const R={data:E,key:E.name,name:E.name,isDir:!0},B=Object.entries(E.uploadProfiles??{}).map(([S,H])=>({data:H,key:`${E.name}_${S}`,name:S,isDir:!1,parent:R}));return R.children=B,R});c(h)},[k]);const I=o.useCallback(function(h,E=!1){return async(...R)=>{const B=se.loading(s.formatMessage({id:"QpRtOT",defaultMessage:[{type:0,value:"执行中"}]}));try{await h(...R),!E&&await Ke()}catch{}B()}},[s]),A=I(async h=>{h.isDir?await z.delete(`/storage/${h.data.name}`):await z.put("/storage",{name:h.parent.data.name,uploadProfiles:{[h.name]:null}})}),N=(h,E=!1)=>{let R=f(h);return R?(se.error(R),!1):!0},_=I(async(h,E)=>{h.isDir?(await z.post("/storage/rename",{src:h.data.name,dst:E,overload:!1}),await Ke()):(await z.put("/storage",{name:h.parent.data.name,uploadProfiles:{[h.name]:null,[E]:h.data}}),await Ke(),n.name===h.parent.data.name&&n.profile===h.name&&a(`/workbench/storage/${h.parent.data.name}/profile/${E}`))},!0),L=async(h,E,R)=>{try{return await z.put("/storage",{name:h.name,uploadProfiles:{[R]:{hooks:{},maxAllowedUploadSizeBytes:10*2**20,maxAllowedFiles:1}}}),await Ke(),a(`/workbench/storage/${h.name}/profile/${R}`),!0}catch{return!1}},W=h=>{var R,B;let E;return h.isDir?E=he.treeItemDir:E=he.treeItemFile,e.jsxs("div",{className:`${he.treeItem} ${E}`,children:[e.jsx("div",{className:he.icon}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${he.method} ${he[`method_${(R=h.data.method)==null?void 0:R.toLowerCase()}`]}`,children:(B=h.data.method)==null?void 0:B.toUpperCase()}),e.jsx("div",{className:he.title,children:h.name}),e.jsx("div",{onClick:S=>S.stopPropagation(),children:e.jsx(it,{destroyPopupOnHide:!0,menu:{items:[{key:"profile",onClick:async()=>{j.current.addItem(!1,!1,h.key)},label:e.jsx(M,{id:"WeEtDm",defaultMessage:[{type:0,value:"新建 Profile"}]})},{key:"detail",onClick:()=>{a(`/workbench/storage/${h.data.name}`)},label:e.jsx(M,{id:"cDZ00w",defaultMessage:[{type:0,value:"查看"}]})},{key:"rename",onClick:()=>{j.current.editItem(h.key)},label:e.jsx(M,{id:"JeJAmT",defaultMessage:[{type:0,value:"重命名"}]})},{key:"delete",label:e.jsx("div",{onClick:S=>{var H,d;(d=(H=S.target)==null?void 0:H.dataset)!=null&&d.stoppropagation&&S.stopPropagation()},children:e.jsx(Mt,{zIndex:9999,title:s.formatMessage({id:"9Fxs0Y",defaultMessage:[{type:0,value:"确定删除吗?"}]}),onConfirm:()=>{A(h)},okText:s.formatMessage({id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]}),cancelText:s.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]}),placement:"right",children:e.jsx("div",{className:he.menuItem,"data-stoppropagation":"1",children:e.jsx(M,{id:"XeiAal",defaultMessage:[{type:0,value:"删除"}]})})})})}].filter(S=>["delete","rename"].includes(S.key)||h.isDir)},trigger:["click"],placement:"bottomRight",children:e.jsx("div",{className:he.more,onClick:S=>S.preventDefault()})})})]})]})};return e.jsx(Ct,{...t,title:s.formatMessage({id:"E6yn6S",defaultMessage:[{type:0,value:"文件存储"}]}),hideAdd:!0,open:u,onOpen:h=>{g(h),t.onOpen&&t.onOpen(h)},action:e.jsx(e.Fragment,{children:e.jsx(ee,{title:s.formatMessage({id:"tVoPUq",defaultMessage:[{type:0,value:"新建"}]}),children:e.jsx("div",{className:he.headerNewFile,onClick:()=>{g(!0),a("/workbench/storage/new")}})})}),children:e.jsx(ms,{draggable:!1,fileText:s.formatMessage({id:"E6yn6S",defaultMessage:[{type:0,value:"文件存储"}]}),ref:j,onSelectFile:h=>{h.isDir?a(`/workbench/storage/${h.data.name}/manage`):a(`/workbench/storage/${h.parent.data.name}/profile/${h.name}`)},onRename:async(h,E)=>{if(E&&N(E,h.isDir))try{return await _(h,E),!0}catch(R){return console.error(R),!1}return!1},onCreateItem:L,selectedKey:v,rootClassName:"h-full",treeClassName:he.treeContainer,treeData:l??[],titleRender:W})})}const Si="_container_oquhq_1",Ni="_tabs_oquhq_6",Ii="_tabs_inner_oquhq_11",Ai="_tabs_tab_oquhq_19",Ei="_tabs_tab__active_oquhq_30",Ri="_apiIcon_oquhq_36",$i="_dataIcon_oquhq_42",Fi="_panels_oquhq_60",je={container:Si,tabs:Ni,tabs_inner:Ii,tabs_tab:Ai,tabs_tab__active:Ei,apiIcon:Ri,dataIcon:$i,panels:Fi},Oi=We.lazy(()=>_t(()=>import("./index-0182cb07.js"),["./index-0182cb07.js","./index-85bb8031.js","./index-6143c70c.css","./fireBoomAPIOperator-e87ec016.js","./toNumber-2d7cfcea.js","./fireBoomConstants-acaaa4c8.js","./PrismaSchemaContext-02f12971.js","./ModelingHelpers-2b9af83e.js","./PrismaSchemaActions-5cb76651.js","./useEntities-01208d52.js","./useCurrentEntity-109c1dca.js","./hotkey-3a258436.js","./datasource-50247cd6.js","./ServiceDiscovery-94517c32.js","./index-66168e0d.js","./useShowArrow-54ebbb87.js","./index-b3ff9150.js","./DownOutlined-844f57b8.js","./PurePanel-25c62dc8.js","./use-immer.module-b1dfddaf.js","./index-9749e2b6.js","./LeftOutlined-7ceb1db4.js","./index-79ebc17f.js","./index-92948ccf.js","./index-90ed7434.js","./index-78f224a4.css"],import.meta.url)),Pt={api:"/workbench",data:"/workbench/modeling"};function Ti(){const[t,s]=o.useState(""),a=Ee(),r=Re();o.useContext(Ue),o.useEffect(()=>Ve("alt+m,^+m",()=>{a.pathname.startsWith("/workbench/modeling")?r("/workbench"):r("/workbench/modeling"),s(t)}),[]),o.useEffect(()=>{const f=a.pathname.startsWith("/workbench/modeling")?"data":"api";s(f)},[a.pathname]);const{panel:n}=o.useContext(Ws),{handleToggleDesigner:l,handleClickEntity:c,handleChangeSource:u,setShowType:g,dataSources:v}=n||{},b=f=>{Pt[t]=a.pathname,r(Pt[f])};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:je.tabs,children:e.jsxs("div",{className:je.tabs_inner,children:[e.jsxs("div",{className:`${je.tabs_tab} ${t==="api"?je.tabs_tab__active:""}`,onClick:()=>{b("api")},children:[e.jsx("div",{className:je.apiIcon}),e.jsx(M,{id:"aj1rA6",defaultMessage:[{type:0,value:"API设计"}]})]}),e.jsxs("div",{className:`${je.tabs_tab}  ${t==="data"?je.tabs_tab__active:""}`,onClick:()=>{b("data")},children:[e.jsx("div",{className:je.dataIcon}),e.jsx(M,{id:"ueuJlz",defaultMessage:[{type:0,value:"数据建模"}]})]})]})}),t==="api"?e.jsxs("div",{className:je.panels,children:[e.jsx(qr,{defaultOpen:a.pathname.startsWith("/workbench/apimanage/")}),e.jsx(Dt,{type:"dataSource",defaultOpen:a.pathname.startsWith("/workbench/data-source/")}),e.jsx(Dt,{type:"auth",defaultOpen:a.pathname.startsWith("/workbench/auth/")}),e.jsx(Ci,{defaultOpen:a.pathname.startsWith("/workbench/storage/")})]}):null,t==="data"&&n?e.jsx(o.Suspense,{children:e.jsx(Oi,{setShowType:g,changeToER:()=>g("erDiagram"),addNewModel:()=>g("newModel"),addNewEnum:()=>g("newEnum"),sourceOptions:v,onChangeSource:f=>u(f),onClickEntity:c,onToggleDesigner:l})}):null]})}const Di={success:e.jsx(Ca,{className:"text-[#52c41a]"}),info:e.jsx(Ta,{className:"text-[#1677ff]"}),warning:e.jsx(na,{className:"text-[#faad14]"}),error:e.jsx(Ea,{className:"text-[#ff4d4f]"})},Pi=t=>{const{silentMode:s,visible:a,toggleVisible:r}=lt();return e.jsxs(e.Fragment,{children:[e.jsx("span",{...t,onClick:r,children:s?e.jsx(Jt,{className:"cursor-pointer"}):e.jsx(Xt,{className:"cursor-pointer"})}),e.jsx(Bi,{})]})},Bi=t=>{const{silentMode:s,visible:a,hide:r,removeNotification:n,toggleSilentMode:l,notifications:c,clear:u}=lt();return a?e.jsxs("div",{className:"shadow-lg rounded absolute right-2 bottom-9 z-1000 bg-white min-w-100 max-w-150 overflow-hidden",children:[e.jsxs("div",{className:"px-2 py-2 bg-[#e3e3d3] flex items-center text-xs",children:[e.jsx("span",{className:"mr-auto",children:e.jsx(M,{id:"2QhCqB",defaultMessage:[{type:0,value:"通知"}]})}),e.jsx(Fs,{onClick:u,className:"cursor-pointer"}),s?e.jsx(Jt,{className:"ml-3 cursor-pointer",onClick:l}):e.jsx(Xt,{className:"ml-3 cursor-pointer",onClick:l}),e.jsx(aa,{className:"ml-3 cursor-pointer",onClick:r})]}),e.jsx("div",{className:"max-h-[80vh] overflow-y-auto",children:c.map(g=>{var v,b;return e.jsxs("div",{className:"p-3 border border-solid border-[transparent] focus:border-[#e92e5e] text-xs",tabIndex:0,style:{boxShadow:"0 1px 0 0 rgba(0,0,0,0.05)"},children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"flex-shrink-0 leading-5",children:Di[g.type??"info"]}),e.jsx("div",{className:"flex-1 ml-2 text-[#333] leading-5",children:g.title}),e.jsx("span",{className:"ml-4 leading-5",children:e.jsx(Os,{className:"flex-shrink-0 cursor-pointer text-[#333]",onClick:()=>n(g)})})]}),(g.source||((v=g.buttons)==null?void 0:v.length))&&e.jsxs("div",{className:"mt-2 flex",children:[g.source&&e.jsxs("span",{className:"text-[#999] mr-auto",children:[e.jsx(M,{id:"gHh5tj",defaultMessage:[{type:0,value:"来源:"}]}),"  ",g.source]}),(b=g.buttons)==null?void 0:b.map((f,j)=>e.jsx(qe,{className:at([j===g.buttons.length-1?"":"mr-1.5",j===0?"ml-auto":"","!text-xs"]),type:f.type,size:"small",onClick:async()=>{await f.handler(),f.closeAfterHandler!==!1&&n(g)},children:f.label},j))]})]},g.id)})})]}):null},Li="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAALVBMVEUAAADcMzfbMzjcMzjcMzfbMzjbMzjbMzjcNDfcMjjbMzncMjndMDrMMzPcMzhS8Fk3AAAADnRSTlMA2oN7v/Kkl4p+VVE1BYqnDOIAAAB9SURBVAjXY2Bg4F0mGph1gQEENj4sNpeTBrE4nhxgYODxawAy+wxAAswvGBi4HzOAgd0GhosOLBMYGDgdWGQZ1h3gfMTAoDeB5xVDIpBWYALyxBjEGRiYHukpMDAUMgQzAIUfAQlTZCZCAbI2hGHIViAsRjgH1ZEIpyM8BADg2ivV/Yu2FwAAAABJRU5ErkJggg==",zi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAASFBMVEUAAAD/phH/phD/phD/phH/phH/phH/phH/phH/phH/phH/pxD/mQD/pRL/phD/pxD/pxP/qBL/pxH/phH/pxH/pg//pRD/pxEWxSq2AAAAF3RSTlMAcsnYz/Lct6SRilEFVTAuGlXFvnZFQZ7lVmoAAACWSURBVBjTbZFZDsMgDESHsAdIIBv3v2lFXbCI6g+MnjR4POBbMTmptXQpYlQwVfpLeFVN6GytdqPbZuvamWgt53YKooEYzhNEAxCNJcGyULcmotR9hlstcAozhHKQ/g29hBZvKPQfeGmWH8eQ86Dn4UGpW8q5W0psXqlhnte877EmBwJiHJP9vbu36Dhk5QWHTBXL9B0fJhYGQqr75V8AAAAASUVORK5CYII=",qi="_dot_137ba_1",Hi="_dotError_137ba_9",Vi="_notSupport_137ba_24",we={dot:qi,dotError:Hi,notSupport:Vi},Wi=({existed:t,defaultLimits:s,userLimits:a,userCode:r,expireTime:n,type:l})=>{const c=ye(),{data:u}=ca("license.json"),g=Le(n).isBefore(Le()),v=Le(n).diff(Le(),"day"),b=v<=7,f={community:c.formatMessage({id:"G8MZAS",defaultMessage:[{type:0,value:"社区版"}]}),professional:c.formatMessage({id:"x7YUWW",defaultMessage:[{type:0,value:"专业版"}]}),enterprise:c.formatMessage({id:"cjjAzK",defaultMessage:[{type:0,value:"企业版"}]}),prismaDatasource:c.formatMessage({id:"1t+raV",defaultMessage:[{type:0,value:"Prisma数据源"}]})},j=k=>k===-1?e.jsx(M,{id:"fDOkY1",defaultMessage:[{type:0,value:"不限制"}]}):k;return e.jsx(ss,{placement:"topRight",arrow:!1,content:e.jsxs("div",{className:"w-160 px-3 pt-4.5 pb-5",children:[e.jsxs("div",{className:"text-[#333]",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{id:"8N6B3R",defaultMessage:[{type:0,value:"机器码"}]}),e.jsx("span",{className:"ml-8",children:r}),e.jsx(da,{className:"ml-3 cursor",onClick:()=>{oa(r),se.success(c.formatMessage({id:"aIrpM5",defaultMessage:[{type:0,value:"已复制"}]}))}})]}),e.jsx("div",{className:"mt-5 mb-2 text-[rgba(95,98,105,0.6)] text-xs",children:e.jsx(M,{id:"DJsFlH",defaultMessage:[{type:0,value:"权益"}]})}),e.jsxs("div",{className:"flex items-center flex-wrap",children:[e.jsxs("div",{className:"min-w-1/4 leading-10 flex items-center",children:[e.jsx("div",{className:we.dot}),e.jsx(M,{id:"Y+NWSo",defaultMessage:[{type:0,value:"API数量"}]}),e.jsx("span",{className:"ml-5",children:j(a==null?void 0:a.operation)})]}),e.jsxs("div",{className:"min-w-1/4 leading-10 flex items-center",children:[e.jsx("div",{className:we.dot}),e.jsx(M,{id:"isALfz",defaultMessage:[{type:0,value:"数据源数量"}]}),e.jsx("span",{className:"ml-5",children:j(a==null?void 0:a.datasource)})]}),(a==null?void 0:a.incrementBuild)===1?e.jsxs("div",{className:"min-w-1/4 leading-10 flex items-center",children:[e.jsx("div",{className:we.dot}),e.jsx(M,{id:"zVrDoA",defaultMessage:[{type:0,value:"增量编译"}]})]}):e.jsx(ee,{title:c.formatMessage({id:"BWZSk1",defaultMessage:[{type:0,value:"请购买商业授权"}]}),children:e.jsxs("a",{className:at("min-w-1/4 leading-10 flex items-center",we.notSupport),href:u==null?void 0:u.buyLicenseUrl,target:"_blank",rel:"noreferrer",children:[e.jsx("div",{className:we.dotError,children:"x"}),e.jsx(M,{id:"zVrDoA",defaultMessage:[{type:0,value:"增量编译"}]})]})}),(a==null?void 0:a.prismaDatasource)===1?e.jsxs("div",{className:"min-w-1/4 leading-10 flex items-center",children:[e.jsx("div",{className:we.dot}),e.jsx(M,{id:"1t+raV",defaultMessage:[{type:0,value:"Prisma数据源"}]})]}):e.jsx(ee,{title:c.formatMessage({id:"BWZSk1",defaultMessage:[{type:0,value:"请购买商业授权"}]}),children:e.jsxs("a",{className:at("min-w-1/4 leading-10 flex items-center",we.notSupport),href:u==null?void 0:u.buyLicenseUrl,target:"_blank",rel:"noreferrer",children:[e.jsx("div",{className:we.dotError,children:"x"}),e.jsx(M,{id:"1t+raV",defaultMessage:[{type:0,value:"Prisma数据源"}]})]})}),e.jsxs("div",{className:"min-w-1/4 leading-10 flex items-center",children:[e.jsx("div",{className:we.dot}),e.jsx(M,{id:"oEls6O",defaultMessage:[{type:0,value:"客服支持"}]})]})]})]}),e.jsx("div",{className:"mt-4 mb-5 h-1px",style:{border:"none",borderTop:"1px dashed #979797"}}),e.jsxs("div",{className:"flex items-center",children:[n&&t&&a&&e.jsxs(e.Fragment,{children:[e.jsx(M,{id:"b/np9H",defaultMessage:[{type:0,value:"过期时间"}]}),e.jsxs("div",{className:"ml-2 flex items-center h-8 bg-[#F8F9FD] px-3 w-69",style:{color:g||b?"#F21212":void 0},children:[la(n),g&&e.jsx("span",{className:"ml-2 text-[10px] bg-[rgba(241,18,18,0.8)] text-white rounded px-1 py-1 scale-75 transform",children:e.jsx(M,{id:"RclhRU",defaultMessage:[{type:0,value:"已过期"}]})}),b&&e.jsxs("span",{className:"ml-2",children:["(",e.jsx(M,{id:"s1uqMz",defaultMessage:[{type:0,value:"剩余"},{type:1,value:"left"},{type:0,value:"天"}],values:{left:v}}),")"]})]})]}),e.jsx(qe,{className:"ml-auto",onClick:()=>window.open(u==null?void 0:u.buyLicenseUrl,"_blank"),children:e.jsx(M,{id:"It/5QC",defaultMessage:[{type:0,value:"购买授权"}]})}),(u==null?void 0:u.freeGiftUrl)&&e.jsxs("div",{className:"relative ml-4",children:[e.jsx(qe,{type:"primary",onClick:()=>window.open(u==null?void 0:u.freeGiftUrl,"_blank"),style:{backgroundImage:"linear-gradient(36deg, #FFAE72 0%, #FF5E5E 100%)",boxShadow:"0px 2px 4px 0px rgba(255,116,99,0.5)",border:"none"},children:e.jsx(M,{id:"naK/qg",defaultMessage:[{type:0,value:"免费获取"}]})}),(u==null?void 0:u.isLimittedTime)&&e.jsx("div",{className:"absolute -right-2 -top-3 z-99 bg-[#F44848] text-white scale-75 transform px-1.5 py-0.5 text-xs rounded border border-solid border-white",children:e.jsx(M,{id:"+Ma7BJ",defaultMessage:[{type:0,value:"限时"}]})})]})]})]}),trigger:"click",children:e.jsx("span",{className:"text-[#326d9f] bg-white rounded-sm cursor-pointer text-xs py-0.5 px-1",children:t&&!a?e.jsx(M,{id:"QdaK6D",defaultMessage:[{type:0,value:"非法授权"}]}):f[l]})})},Ui="_info_enemk_9",Ki="_gitIcon_enemk_17",Yi="_errLabel_enemk_23",Gi="_split_enemk_27",Qi="_hookEntry_enemk_33",Zi="_statusLabel_enemk_36",Ji="_entry_enemk_39",Xi="_label_enemk_44",eo="_hookMask_enemk_47",to="_hookContainer_enemk_55",Q={"status-bar":"_status-bar_enemk_1",info:Ui,gitIcon:Ki,errLabel:Yi,split:Gi,hookEntry:Qi,statusLabel:Zi,entry:Ji,label:Xi,hookMask:eo,hookContainer:to},Bt="dev.tip",so=({className:t,menuWidth:s,toggleWindow:a,license:r})=>{var P,$;const n=ye(),{engineStartTime:l,fbCommit:c,fbVersion:u,engineStatus:g,hookStatus:v}=es(),[b,f]=o.useState(localStorage.getItem(Bt)!=="false"),{getConfigurationValue:j}=jt(),k=ia(),{questions:I}=is(F=>({questions:F.questions})),A=o.useMemo(()=>({[ce.Building]:n.formatMessage({id:"T0bxDG",defaultMessage:[{type:0,value:"编译中"}]}),[ce.EngineIncrementBuild]:n.formatMessage({id:"QyStY8",defaultMessage:[{type:0,value:"增量编译中"}]}),[ce.Built]:n.formatMessage({id:"Zz7nBV",defaultMessage:[{type:0,value:"已编译"}]}),[ce.BuildFailed]:n.formatMessage({id:"rbmyiL",defaultMessage:[{type:0,value:"编译失败"}]}),[ce.Starting]:n.formatMessage({id:"h3R9PB",defaultMessage:[{type:0,value:"启动中"}]}),[ce.EngineIncrementStart]:n.formatMessage({id:"NaeJNm",defaultMessage:[{type:0,value:"增量启动中"}]}),[ce.Started]:n.formatMessage({id:"PpQOV5",defaultMessage:[{type:0,value:"已启动"}]}),[ce.StartFailed]:n.formatMessage({id:"Xz2JYA",defaultMessage:[{type:0,value:"启动失败"}]})}),[n]),[N,_]=o.useState(),[L,W]=o.useState(),{globalSetting:h,appRuntime:E,updateGlobalSetting:R}=bt(),B=Re(),{vscode:S}=o.useContext(He),{data:H}=vt("/sdk",z.get);o.useEffect(()=>{if(!l)return;_(k(l));const F=setInterval(()=>{_(k(l))},6e4);return()=>{clearInterval(F)}},[l,k]);const d=()=>{localStorage.setItem(Bt,"false"),f(!1)};return e.jsxs("div",{className:t,children:[e.jsxs("div",{className:Q["status-bar"],children:[e.jsxs("span",{className:Q.info,children:[e.jsx("span",{className:Q["info-env"]+" mr-2",children:E.dev?e.jsx(ee,{open:b,arrow:!0,title:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{id:"ZhU+bx",defaultMessage:[{type:0,value:"请勿将开发模式用于生产"}]}),e.jsx("span",{className:"ml-4 cursor-pointer",onClick:d,children:e.jsx(M,{id:"r1IImU",defaultMessage:[{type:0,value:"知道了"}]})})]}),children:e.jsx("span",{children:e.jsx(M,{id:"uY5Slp",defaultMessage:[{type:0,value:"开发模式"}]})})}):e.jsx(M,{id:"WeuMpp",defaultMessage:[{type:0,value:"生产模式"}]})}),e.jsxs("span",{className:Q["info-version"]+" mr-2",children:[e.jsx("span",{children:"FB:"}),e.jsx(ee,{title:c,children:e.jsx("span",{className:"",children:u})})]}),e.jsx("span",{onClick:()=>{a("0")},className:Q.errLabel+" mr-2 cursor-pointer",children:e.jsx("span",{children:e.jsx(M,{id:"608d8o",defaultMessage:[{type:0,value:"日志"}]})})}),e.jsxs("span",{onClick:()=>{a("1")},className:"cursor-pointer flex items-center",children:[e.jsxs("span",{className:Q.errLabel,children:[e.jsx("img",{height:14,width:14,src:Li,alt:"错误"}),e.jsx("span",{className:"ml-2",children:I.filter(F=>F.level==="error").length})]}),e.jsxs("span",{className:Q.errLabel,style:{marginLeft:8},children:[e.jsx("img",{height:14,width:14,src:zi,alt:"警告"}),e.jsx("span",{className:"ml-2",children:I.filter(F=>F.level==="warn").length})]})]}),e.jsxs("span",{className:"ml-3",children:[" ",e.jsx(M,{id:"Ipvx+S",defaultMessage:[{type:0,value:"引擎"}]}),":"," "]}),e.jsx("span",{className:Q.errLabel+" ml-1",children:g===ce.BuildFailed||g===ce.StartFailed?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-[#cd3021] rounded-3px h-3px w-3px"}),e.jsx(ee,{open:!0,title:n.formatMessage({id:"XIRdkO",defaultMessage:[{type:0,value:"请检查项目配置并重启fireboom"}]}),children:e.jsx("span",{className:"ml-1 text-[#cd3021]",children:A[g]??""})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-[#50C772] rounded-3px h-3px w-3px"}),e.jsx("span",{className:"ml-1 text-[#50C772]",children:A[g]??""})]})}),e.jsxs("span",{className:"ml-3",children:[" ",e.jsx(M,{id:"UU3d6B",defaultMessage:[{type:0,value:"钩子"}]}),":"," "]}),e.jsxs("span",{className:Q.errLabel+" cursor-pointer ml-1",children:[e.jsxs("div",{className:"flex h-full items-center",children:[e.jsx("div",{className:"rounded-3px h-3px w-3px"+(v?" bg-[#50C772]":" bg-[#f0b763]")}),e.jsx("span",{className:"ml-1 "+(v?"text-[#50C772]":"text-[#f0b763]"),children:v?n.formatMessage({id:"PpQOV5",defaultMessage:[{type:0,value:"已启动"}]}):n.formatMessage({id:"GbiB/D",defaultMessage:[{type:0,value:"未启动"}]})}),e.jsx("div",{className:"flex h-full pl-1 items-center",onClick:F=>{Ce({channel:"hookReport",event:"pull"}),F.stopPropagation()},children:e.jsx("img",{alt:"",src:"./assets/refresh.svg"})})]}),e.jsx("div",{className:Q.split}),e.jsxs("div",{className:"flex h-full items-center",onClick:()=>W(!0),children:[e.jsx("div",{className:Q.hookEntry,children:j(h.serverOptions.serverUrl)}),e.jsx("div",{className:"mr-5px ml-8px",style:{transform:L?"rotate(180deg)":""},children:e.jsx("img",{alt:"",src:"./assets/hook-arrow.svg"})})]}),L&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:Q.hookMask,onClick:F=>{F.stopPropagation(),W(!1)}}),e.jsx("div",{className:Q.hookContainer+" common-form",onClick:F=>{F.stopPropagation()},children:e.jsxs(Ts,{initialValues:h.serverOptions,onFinish:F=>{R({serverOptions:{...h.serverOptions,...F}})},children:[e.jsx("div",{className:"pt-2 text-[#999] text-sm",children:e.jsx(M,{id:"OzNfBQ",defaultMessage:[{type:0,value:"钩子服务地址"}]})}),e.jsxs("div",{className:"mt-2 flex items-center flex-1",children:[e.jsx(sa,{formItemProps:{name:"serverUrl",className:"flex-1"},inputProps:{placeholder:"http://localhost:9992"},required:!0}),e.jsx(qe,{htmlType:"submit",className:"ml-2 mb-5",type:"primary",children:"保存"})]})]})})]})]}),e.jsxs("div",{className:Q.entry+" cursor-pointer",onClick:()=>B("/workbench/sdk-template"),children:[e.jsx(M,{id:"p5GCek",defaultMessage:[{type:0,value:"钩子模版"}]}),":",e.jsx("span",{className:Q.label,children:((P=H==null?void 0:H.find(F=>F.type==="server"&&F.enabled))==null?void 0:P.language)??"未选择"})]}),e.jsxs("div",{className:Q.entry+" cursor-pointer",onClick:()=>B("/workbench/sdk-template"),children:[e.jsx(M,{id:"gRp6eK",defaultMessage:[{type:0,value:"客户端模版"}]}),":",e.jsx("span",{className:Q.label,children:(($=H==null?void 0:H.filter(F=>F.type==="client"))==null?void 0:$.length)??0})]}),e.jsxs("div",{className:Q.entry,children:[e.jsx(M,{id:"wZkLCJ",defaultMessage:[{type:0,value:"编译时间"}]}),":",e.jsx("span",{className:Q.label,children:N})]})]}),e.jsx("span",{className:"ml-auto",children:r&&e.jsx(Wi,{...r})}),e.jsx("span",{className:"bg-white rounded-sm cursor-pointer ml-4 text-xs py-0.5 px-1 text-[#326d9f]",onClick:()=>{var F;(F=S==null?void 0:S.options)!=null&&F.visible?S.hide():S.show()},children:e.jsx(M,{id:"IOCqZm",defaultMessage:[{type:0,value:"钩子编辑器⇪"}]})}),e.jsx(Pi,{className:"bg-white rounded-sm cursor-pointer ml-4 text-xs py-0.5 px-1 text-[#326d9f] inline-flex items-center"})]}),e.jsx(ra,{className:"top-9 z-1000 fixed",style:{left:`${s}px`,width:`calc(100vw - ${s}px)`,height:"calc(100vh - 64px)"}})]})},ao=so,no=We.lazy(()=>_t(()=>import("./modelingWrapper-c09bdbcf.js"),["./modelingWrapper-c09bdbcf.js","./index-85bb8031.js","./index-6143c70c.css","./use-immer.module-b1dfddaf.js","./PrismaSchemaActions-5cb76651.js","./fireBoomAPIOperator-e87ec016.js","./toNumber-2d7cfcea.js","./fireBoomConstants-acaaa4c8.js","./PrismaSchemaContext-02f12971.js","./ModelingHelpers-2b9af83e.js","./networkStatus-ce5110c5.js","./store-e605fef9.js","./parser-cf485565.js","./predicates-1f5a5148.js","./datasource-50247cd6.js","./ServiceDiscovery-94517c32.js"],import.meta.url)),ro=We.lazy(()=>_t(()=>import("./index-34395cfc.js"),["./index-34395cfc.js","./index-85bb8031.js","./index-6143c70c.css","./datasource-50247cd6.js","./ServiceDiscovery-94517c32.js","./index-b3ff9150.js","./dayjs.min-5495be60.js","./use-immer.module-b1dfddaf.js","./globalContext-c31891b2.js","./workbenchContext-7962b30b.js","./interface-41bd3122.js","./engine-c7e5841f.js","./db-ed05e835.js","./index-5857d219.js","./variable-144a75bf.js","./common-7ac8785d.js","./auth-8ea2ddcf.js","./hotkey-3a258436.js","./index-a66fc756.js","./PurePanel-25c62dc8.js","./index-90ed7434.js","./PrismaSchemaContext-02f12971.js","./index-9749e2b6.js","./LeftOutlined-7ceb1db4.js","./index-79ebc17f.js","./index-ac112fba.js","./useShowArrow-54ebbb87.js","./DownOutlined-844f57b8.js","./conductUtil-09d91ceb.js","./index-cdb771f1.js","./validate-904668ce.js","./store-e605fef9.js","./parser-cf485565.js","./index-92948ccf.js","./index-1f66e1b5.js","./addEventListener-23b0fde6.js","./index-8375a6c3.js","./index-66168e0d.js","./index-f4dd4804.js","./WarningOutlined-3c8a6739.js","./index-fd877240.js","./calcTime-9776a66f.js","./index-9649d007.js","./utils-9b986f1e.js","./CopyOutlined-c11c973b.js","./index-4129e33c.js","./index-9e52deba.css"],import.meta.url)),{Header:io,Footer:oo,Sider:lo,Content:co}=st,Xe=230;function uo(t){const s=ye(),[a,r]=se.useMessage(),{engineStatus:n,setEngineState:l,computed:{isCompiling:c}}=es(),[u,g]=o.useState(null),{setVersion:v}=bt(),[b,f]=o.useState(!1),[j,k]=o.useState(),[I,A]=o.useState(!1),[N,_]=o.useState(!1),[L,W]=o.useState(!1),h=o.useRef(),{addNotification:E,removeByTag:R,clear:B}=lt(),S={datasource:s.formatMessage({id:"C5D7TM",defaultMessage:[{type:0,value:"数据源"}]}),operation:s.formatMessage({id:"xwEc8K",defaultMessage:[{type:0,value:"API"}]}),teamwork:s.formatMessage({id:"5PSP/z",defaultMessage:[{type:0,value:"团队"}]}),prismaDatasource:s.formatMessage({id:"1t+raV",defaultMessage:[{type:0,value:"Prisma数据源"}]})},[H,d]=o.useState({visible:!1,currentPath:"",config:{}}),[P,$]=o.useState(""),[F,ae]=o.useState(!1),[ge,x]=Ls({api:!1,auth:!1,dataSource:!1,storage:!1}),{setLogs:w,logs:i,questions:p,setQuestions:y}=is(m=>({logs:m.logs,setLogs:m.setLogs,questions:m.questions,setQuestions:m.setQuestions})),C=o.useMemo(()=>({[te.Authentication]:s.formatMessage({id:"OJbZDt",defaultMessage:[{type:0,value:"身份认证"}]}),[te.Configuration]:s.formatMessage({id:"xE1H+X",defaultMessage:[{type:0,value:"设置"}]}),[te.DataSource]:s.formatMessage({id:"C5D7TM",defaultMessage:[{type:0,value:"数据源"}]}),[te.Operation]:s.formatMessage({id:"xwEc8K",defaultMessage:[{type:0,value:"API"}]}),[te.Role]:s.formatMessage({id:"/F5ua7",defaultMessage:[{type:0,value:"角色管理"}]}),[te.SDK]:s.formatMessage({id:"pCG/0m",defaultMessage:[{type:0,value:"钩子模板"}]}),[te.Storage]:s.formatMessage({id:"E6yn6S",defaultMessage:[{type:0,value:"文件存储"}]})}),[s]),T=o.useMemo(()=>({[te.Authentication]:"/auth/{name}",[te.Configuration]:"/setting",[te.DataSource]:"/data-source/{name}",[te.Operation]:"/apimanage/{name}",[te.Role]:"/auth/role/role",[te.SDK]:"/sdk-template",[te.Storage]:"/storage/{name}"}),[]),re=xt();o.useEffect(()=>{Ds(re??"")},[re]),ve("engine","pull",m=>{v({fbVersion:m.fbVersion??"",fbCommit:m.fbCommit??""}),l(m),m.engineStatus===ce.Started&&Te.emit({event:"compileFinish",value:{first:!0}})}),ve("engine","push",m=>{l({engineStatus:m.engineStatus,engineStartTime:m.engineStartTime}),m.engineStatus===ce.Started&&(Ce({channel:"question",event:"pull"}),Ae(),tt(),Te.emit({event:"compileFinish"}))}),ve("hookReport","pull",m=>{let D=!1;m&&(D=new Date(m).getFullYear()>1970),l({hookStatus:D})}),ve("hookReport","push",m=>{let D=!1;m&&(D=new Date(m).getFullYear()>1970),l({hookStatus:D})}),ve("log","pull",m=>{w(Lt(m))}),ve("log","push",m=>{w(i.concat(Lt([m])))}),ve("question","pull",m=>{R("question"),y(m||[]),m!=null&&m.length&&E({tag:"question",title:s.formatMessage({id:"B/j4Mh",defaultMessage:[{type:0,value:"构建中存在"},{type:1,value:"count"},{type:0,value:"条问题， 请检查"}]},{count:m.length}),buttons:[{label:e.jsx(M,{id:"cDZ00w",defaultMessage:[{type:0,value:"查看"}]}),handler:()=>{f(!0),k("1")},type:"primary"}]})}),ve("question","push",m=>{y([...p,m]),E({tag:"question-detail",title:m.msg,source:`${C[m.model]}[${m.name}]`,type:m.model===te.DataSource?"error":"warning",buttons:[{label:e.jsx(M,{id:"vR0fTF",defaultMessage:[{type:0,value:"前往查看"}]}),handler:()=>{Me(`/workbench${T[m.model].replace("{name}",m.name)}`)},type:"primary"}]})}),ve("license","pull",m=>{g(m)}),ve("license","push",m=>{a.error(e.jsxs("div",{className:"inline-flex flex-col items-start",children:[e.jsx("div",{children:m.msg}),e.jsx("div",{children:e.jsx(M,{id:"ydOjls",defaultMessage:[{type:0,value:"当前"},{type:1,value:"model"},{type:0,value:"超出"},{type:1,value:"limit"},{type:0,value:"的限制"}],values:{model:S[m.data.function],limit:m.data.limits}})}),e.jsxs("div",{children:[e.jsx(M,{id:"TanXXK",defaultMessage:[{type:0,value:"请访问"}]}),e.jsx("a",{className:"mx-1",href:m.data.contractAddress,target:"_blank",rel:"noreferrer",children:m.data.contractAddress}),e.jsx(M,{id:"a4KYcJ",defaultMessage:[{type:0,value:"获取商业授权"}]})]}),e.jsx("div",{className:"mt-2 flex w-full",children:e.jsx(qe,{size:"small",type:"primary",className:"ml-auto",onClick:()=>a.destroy(),children:s.formatMessage({id:"r1IImU",defaultMessage:[{type:0,value:"知道了"}]})})})]}),0),Ce({channel:"license",event:"pull"})}),o.useEffect(()=>{Ce({channel:"engine",event:"pull"}),Ce({channel:"hookReport",event:"pull"}),Ce({channel:"log",event:"pull"}),Ce({channel:"question",event:"pull"}),Ce({channel:"license",event:"pull"})},[]),o.useEffect(()=>{const m=new AbortController;return new Headers().set("X-FB-Authentication",xt()??""),()=>{m.abort()}},[L]),o.useEffect(()=>{n===ce.Building&&(y([]),w([]))},[n,w,y]);const de=m=>{x(D=>{D[m]=!D[m]})},ue=m=>{ae(m)},{modal:J}=Yt.useApp(),me=o.useCallback(async()=>F?await new Promise(m=>{J.confirm({title:s.formatMessage({id:"5gzWCE",defaultMessage:[{type:0,value:"即将离开当前页面，未保存的内容将被丢失，是否确认？"}]}),onOk:()=>{ae(!1),m(!0)},onCancel:()=>m(!1)})}):!0,[F,s,J]),$e=o.useCallback(async(m,D)=>{var ke;const ne=(ke=(await Wt.get(`${m}/auth/cookie/user/logout`,{headers:Ps(),params:{logout_openid_connect_provider:(D==null?void 0:D.logoutProvider)??!0},withCredentials:!0})).data)==null?void 0:ke.redirect;if(ne){const K=document.createElement("iframe");K.src=ne,document.body.appendChild(K),setTimeout(()=>{document.body.removeChild(K)},5e3)}((D==null?void 0:D.closeWindow)??!0)&&(se.info(s.formatMessage({id:"7xvRgU",defaultMessage:[{type:0,value:"登出成功，即将关闭当前页面"}]})),setTimeout(()=>{window.close()},3e3))},[s]),Z=e.jsxs(st,{className:`h-100vh ${Je.workbench}`,children:[!N&&e.jsx(io,{className:Je.header,children:e.jsx(ar,{onToggleSider:()=>A(!I),isCompiling:c})}),e.jsxs(st,{children:[e.jsx(lo,{width:Xe,style:{marginLeft:I||N?-1*Xe:0},theme:"light",className:Je.sider,children:e.jsx(Ti,{})}),e.jsxs(st,{className:"relative",children:[e.jsx(co,{className:"bg-[#FBFBFB]",children:t.children}),b?e.jsx(o.Suspense,{children:e.jsx(ro,{style:{left:0,right:0,bottom:0},toggleWindow:()=>f(!b),defaultTab:j})}):e.jsx(e.Fragment,{})]})]}),!N&&e.jsx(oo,{className:Je.footer,children:e.jsx(ao,{license:u,menuWidth:N?0:Xe,toggleWindow:m=>{k(m),f(!b)}})})]}),pe=Ee(),Me=Re(),{data:O}=vt("/sdk/enabledServer",z),{data:q,mutate:X}=vt("/sdk",z.get),U=O==null?void 0:O.language,ie=(!!U&&(q==null?void 0:q.some(m=>m.type==="server")))??!1,xe=async(m,D=!1,Ne=!1)=>{try{if(!ie)return Me("/workbench/sdk-template"),se.warning(s.formatMessage({id:"PbJmb7",defaultMessage:[{type:0,value:"请选择钩子模版"}]})),!1;let ne=O!=null&&O.extension&&m.includes(O.extension)?m:`${m}.${O==null?void 0:O.extension.replace(/^\./,"")}`.replace(/^\//,"");if(O!=null&&O.upperFirst){const K=ne.split("/"),oe=K[K.length-1];ne=`${K.slice(0,K.length-1).join("/")}/${oe[0].toUpperCase()}${oe.slice(1)}`}let ke=!1;try{await z.get(`/vscode/state?uri=${ne}`,{ignoreError:!0}),ke=!0}catch{}if(!ke){if(!Ne&&(!await new Promise(Fe=>{J.confirm({title:s.formatMessage({id:"73X0pe",defaultMessage:[{type:0,value:"钩子脚本不存在，是否创建？"}]}),onOk:()=>Fe(!0),onCancel:()=>Fe(!1),zIndex:99999})})||!U))return!1;$("钩子模板创建中，请稍候");const K=await pn(ne,O);return await qs(ne,K),!0}return!0}catch(ne){return $(""),console.error(ne),!1}finally{$("")}},G={vscode:{options:H,isHookServerSelected:ie,checkHookExist:xe,toggleOperationHook:async(m,D,Ne,ne=!1)=>{m&&!await xe(D,ne)||(D.match(/custom-\w+\/global\//)?await qa(D.split("/").pop(),m):await Ha(Ne,D.split("/").pop(),m))},hide:()=>{d({visible:!1,currentPath:"",config:{}})},show:async(m,D)=>m&&!await xe(m??"")?!1:(d({visible:!0,currentPath:m??"",config:D??{}}),!0)}};return pe.pathname.match(/^\/workbench\/modeling($|\/)/)?e.jsxs(o.Suspense,{children:[r,e.jsx(He.Provider,{value:G,children:e.jsx(At,{tip:P,spinning:!!P,children:e.jsx(no,{children:Z})})})]}):e.jsxs(He.Provider,{value:G,children:[r,e.jsx(At,{tip:P,spinning:!!P,children:e.jsx(Ue.Provider,{value:{engineStatus:n,triggerPageEvent:m=>{var D;(D=h.current)==null||D.call(h,m)},registerPageListener:m=>{h.current=m},refreshMap:ge,onRefreshMenu:de,onRefreshState:()=>W(!L),editFlag:F,markEdit:ue,navCheck:me,setFullscreen:_,isFullscreen:N,menuWidth:N?0:Xe,setHideSide:A,isHideSide:I,logout:$e},children:Z})})]})}function Lt(t){const s=[];let a;return t==null||t.forEach(r=>{const[,n,l,c]=r.match(/([\d\w-:.+]+) (\w+) (.*)/)||[];n?(a={time:Le(n).format("YYYY-MM-DD HH:mm:ss"),level:l,msg:c},s.push(a)):a&&(a.msg+=`
`+r.trim())}),s}function fo(){const{globalSetting:t}=o.useContext(Vt);return t?e.jsx(uo,{children:e.jsx(o.Suspense,{children:e.jsx(Bs,{})})}):null}const Wo=Object.freeze(Object.defineProperty({__proto__:null,default:fo},Symbol.toStringTag,{value:"Module"}));export{te as Q,is as u,Wo as w};
