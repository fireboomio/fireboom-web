import{c as ne,aV as ce,d as V,r as l,e as de,f as L,aT as me,bG as ue,dH as pe,ac as fe,dv as ge,dS as he,bT as be,d5 as xe,cT as ve,c6 as ye,c7 as Ce,dT as Se,K as F,j as t,ad as w,Q as $,u as je,ag as I,a4 as Ie,W as Me,V as P,k as E,a7 as we,X as $e}from"./index-dff05267.js";import{i as q}from"./use-immer.module-7cdb69e9.js";import{g as N}from"./variable-00226f1e.js";import{D as S}from"./index-ca2f3000.js";import{I as k}from"./index-c446e979.js";import{u as Ne}from"./validate-f5ff3856.js";import{W as ke}from"./workbenchContext-7ddce57a.js";import{u as _e}from"./lock-36a5c1a5.js";import{S as H}from"./index-2614564e.js";import"./common-7ac8785d.js";import"./useBreakpoint-e3e538db.js";import"./useForceUpdate-b3ee90cd.js";import"./index-7e1d2382.js";import"./index-9a3959ae.js";import"./useShowArrow-2d77d596.js";import"./index-8aed1cf0.js";import"./DownOutlined-0e50052c.js";import"./PurePanel-fa294c78.js";import"./index-3c2a0365.js";const _=(e,s,o,r,a)=>({background:e,border:`${V(r.lineWidth)} ${r.lineType} ${s}`,[`${a}-icon`]:{color:o}}),Ee=e=>{const{componentCls:s,motionDurationSlow:o,marginXS:r,marginSM:a,fontSize:c,fontSizeLG:d,lineHeight:p,borderRadiusLG:u,motionEaseInOutCirc:m,withDescriptionIconSize:x,colorText:v,colorTextHeading:y,withDescriptionPadding:C,defaultPadding:n}=e;return{[s]:Object.assign(Object.assign({},ce(e)),{position:"relative",display:"flex",alignItems:"center",padding:n,wordWrap:"break-word",borderRadius:u,[`&${s}-rtl`]:{direction:"rtl"},[`${s}-content`]:{flex:1,minWidth:0},[`${s}-icon`]:{marginInlineEnd:r,lineHeight:0},"&-description":{display:"none",fontSize:c,lineHeight:p},"&-message":{color:y},[`&${s}-motion-leave`]:{overflow:"hidden",opacity:1,transition:`max-height ${o} ${m}, opacity ${o} ${m},
        padding-top ${o} ${m}, padding-bottom ${o} ${m},
        margin-bottom ${o} ${m}`},[`&${s}-motion-leave-active`]:{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}}),[`${s}-with-description`]:{alignItems:"flex-start",padding:C,[`${s}-icon`]:{marginInlineEnd:a,fontSize:x,lineHeight:0},[`${s}-message`]:{display:"block",marginBottom:r,color:y,fontSize:d},[`${s}-description`]:{display:"block",color:v}},[`${s}-banner`]:{marginBottom:0,border:"0 !important",borderRadius:0}}},Pe=e=>{const{componentCls:s,colorSuccess:o,colorSuccessBorder:r,colorSuccessBg:a,colorWarning:c,colorWarningBorder:d,colorWarningBg:p,colorError:u,colorErrorBorder:m,colorErrorBg:x,colorInfo:v,colorInfoBorder:y,colorInfoBg:C}=e;return{[s]:{"&-success":_(a,r,o,e,s),"&-info":_(C,y,v,e,s),"&-warning":_(p,d,c,e,s),"&-error":Object.assign(Object.assign({},_(x,m,u,e,s)),{[`${s}-description > pre`]:{margin:0,padding:0}})}}},Le=e=>{const{componentCls:s,iconCls:o,motionDurationMid:r,marginXS:a,fontSizeIcon:c,colorIcon:d,colorIconHover:p}=e;return{[s]:{"&-action":{marginInlineStart:a},[`${s}-close-icon`]:{marginInlineStart:a,padding:0,overflow:"hidden",fontSize:c,lineHeight:V(c),backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer",[`${o}-close`]:{color:d,transition:`color ${r}`,"&:hover":{color:p}}},"&-close-text":{color:d,transition:`color ${r}`,"&:hover":{color:p}}}}},Fe=e=>({withDescriptionIconSize:e.fontSizeHeading3,defaultPadding:`${e.paddingContentVerticalSM}px 12px`,withDescriptionPadding:`${e.paddingMD}px ${e.paddingContentHorizontalLG}px`}),Be=ne("Alert",e=>[Ee(e),Pe(e),Le(e)],Fe);var R=globalThis&&globalThis.__rest||function(e,s){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&s.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)s.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(o[r[a]]=e[r[a]]);return o};const Te={success:ge,info:he,error:be,warning:xe},De=e=>{const{icon:s,prefixCls:o,type:r}=e,a=Te[r]||null;return s?pe(s,l.createElement("span",{className:`${o}-icon`},s),()=>({className:L(`${o}-icon`,{[s.props.className]:s.props.className})})):l.createElement(a,{className:`${o}-icon`})},Oe=e=>{const{isClosable:s,prefixCls:o,closeIcon:r,handleClose:a,ariaProps:c}=e,d=r===!0||r===void 0?l.createElement(fe,null):r;return s?l.createElement("button",Object.assign({type:"button",onClick:a,className:`${o}-close-icon`,tabIndex:0},c),d):null},ze=l.forwardRef((e,s)=>{const{description:o,prefixCls:r,message:a,banner:c,className:d,rootClassName:p,style:u,onMouseEnter:m,onMouseLeave:x,onClick:v,afterClose:y,showIcon:C,closable:n,closeText:h,closeIcon:j,action:T,id:G}=e,K=R(e,["description","prefixCls","message","banner","className","rootClassName","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action","id"]),[D,Q]=l.useState(!1),O=l.useRef(null);l.useImperativeHandle(s,()=>({nativeElement:O.current}));const{getPrefixCls:X,direction:Z,alert:i}=l.useContext(de),f=X("alert",r),[Y,J,ee]=Be(f),se=g=>{var b;Q(!0),(b=e.onClose)===null||b===void 0||b.call(e,g)},z=l.useMemo(()=>e.type!==void 0?e.type:c?"warning":"info",[e.type,c]),te=l.useMemo(()=>typeof n=="object"&&n.closeIcon||h?!0:typeof n=="boolean"?n:j!==!1&&j!==null&&j!==void 0?!0:!!(i!=null&&i.closable),[h,j,n,i==null?void 0:i.closable]),A=c&&C===void 0?!0:C,oe=L(f,`${f}-${z}`,{[`${f}-with-description`]:!!o,[`${f}-no-icon`]:!A,[`${f}-banner`]:!!c,[`${f}-rtl`]:Z==="rtl"},i==null?void 0:i.className,d,p,ee,J),re=me(K,{aria:!0,data:!0}),ae=l.useMemo(()=>{var g,b;return typeof n=="object"&&n.closeIcon?n.closeIcon:h||(j!==void 0?j:typeof(i==null?void 0:i.closable)=="object"&&(!((g=i==null?void 0:i.closable)===null||g===void 0)&&g.closeIcon)?(b=i==null?void 0:i.closable)===null||b===void 0?void 0:b.closeIcon:i==null?void 0:i.closeIcon)},[j,n,h,i==null?void 0:i.closeIcon]),le=l.useMemo(()=>{const g=n??(i==null?void 0:i.closable);return typeof g=="object"?R(g,["closeIcon"]):{}},[n,i==null?void 0:i.closable]);return Y(l.createElement(ue,{visible:!D,motionName:`${f}-motion`,motionAppear:!1,motionEnter:!1,onLeaveStart:g=>({maxHeight:g.offsetHeight}),onLeaveEnd:y},g=>{let{className:b,style:ie}=g;return l.createElement("div",Object.assign({id:G,ref:O,"data-show":!D,className:L(oe,b),style:Object.assign(Object.assign(Object.assign({},i==null?void 0:i.style),u),ie),onMouseEnter:m,onMouseLeave:x,onClick:v,role:"alert"},re),A?l.createElement(De,{description:o,icon:e.icon,prefixCls:f,type:z}):null,l.createElement("div",{className:`${f}-content`},a?l.createElement("div",{className:`${f}-message`},a):null,o?l.createElement("div",{className:`${f}-description`},o):null),T?l.createElement("div",{className:`${f}-action`},T):null,l.createElement(Oe,{isClosable:te,prefixCls:f,closeIcon:ae,handleClose:se,ariaProps:le}))}))}),W=ze;let Ae=function(e){function s(){var o;return Ce(this,s),o=Se(this,s,arguments),o.state={error:void 0,info:{componentStack:""}},o}return ve(s,e),ye(s,[{key:"componentDidCatch",value:function(r,a){this.setState({error:r,info:a})}},{key:"render",value:function(){const{message:r,description:a,id:c,children:d}=this.props,{error:p,info:u}=this.state,m=u&&u.componentStack?u.componentStack:null,x=typeof r>"u"?(p||"").toString():r,v=typeof a>"u"?m:a;return p?l.createElement(W,{id:c,type:"error",message:x,description:l.createElement("pre",{style:{fontSize:"0.9em",overflowX:"auto"}},v)}):d}}])}(l.Component);const He=Ae,U=W;U.ErrorBoundary=He;const Re=U;l.createContext([]);l.createContext({});l.createContext({});const B=l.createContext({}),Ve=""+new URL("file-90b07208.svg",import.meta.url).href,qe="_supportList_k47rm_86",We="_supportItem_k47rm_96",M={"save-btn":"_save-btn_k47rm_1","center-btn":"_center-btn_k47rm_19","switch-check-btn":"_switch-check-btn_k47rm_27","ssl-open-btn":"_ssl-open-btn_k47rm_34","ssl-close-btn":"_ssl-close-btn_k47rm_47","switch-set-btn":"_switch-set-btn_k47rm_64","form-contain":"_form-contain_k47rm_71","panel-style":"_panel-style_k47rm_74","form-item-icon":"_form-item-icon_k47rm_81",supportList:qe,supportItem:We};function Ue({content:e}){const s=F(),[o,r]=q(!1);return t.jsx(t.Fragment,{children:t.jsx("div",{className:"pr-110px",children:t.jsxs(S,{bordered:!0,column:1,size:"small",children:[t.jsx(S.Item,{label:s.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"名称"}]}),children:e==null?void 0:e.name}),t.jsx(S.Item,{label:s.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"服务地址"}]}),children:N(e==null?void 0:e.endpoint)}),t.jsx(S.Item,{label:s.formatMessage({id:"WfVg3t",defaultMessage:[{type:0,value:"APP ID"}]}),children:N(e==null?void 0:e.accessKeyID)}),t.jsx(S.Item,{label:s.formatMessage({id:"FYqDZK",defaultMessage:[{type:0,value:"APP Secret"}]}),children:N(e==null?void 0:e.secretAccessKey,{enableVisible:!0,visible:o,onVisibleChange:a=>{r(a)}})}),t.jsx(S.Item,{label:s.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"区域"}]}),children:N(e==null?void 0:e.bucketLocation)}),t.jsx(S.Item,{label:s.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"桶名称"}]}),children:N(e==null?void 0:e.bucketName)}),t.jsx(S.Item,{label:s.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"开启SSL"}]}),children:e!=null&&e.useSSL?t.jsx(w,{className:M["ssl-open-btn"],children:t.jsx($,{id:"ZUPzqr",defaultMessage:[{type:0,value:"开启"}]})}):t.jsx(w,{className:M["ssl-close-btn"],children:t.jsx($,{id:"47GdDb",defaultMessage:[{type:0,value:"关闭"}]})})})]})})})}const Ge=""+new URL("ali-d7c63952.png",import.meta.url).href,Ke=""+new URL("google-4099bb07.png",import.meta.url).href,Qe=""+new URL("minio-e7f537ea.png",import.meta.url).href,Xe=""+new URL("tencent-a92b2b75.png",import.meta.url).href,Ze=[{img:Ge,link:"https://help.aliyun.com/product/31815.html"},{img:Xe,link:"https://cloud.tencent.com/document/product/436"},{img:Ke,link:"https://cloud.google.com/storage/docs"},{img:Qe,link:"https://docs.min.io/docs/minio-quickstart-guide.html"}];function Ye({content:e,showErr:s}){console.log(e);const o=F(),{ruleMap:r}=Ne(),{handleSwitch:a}=l.useContext(B),c=je();l.useContext(ke);const[d]=I.useForm(),[p,u]=l.useState(!1),m=Ie(),{loading:x,fun:v}=_e(async n=>{if(m!=null&&m.find(h=>h.name===n.name&&h.name!==(e==null?void 0:e.name))){P.error(o.formatMessage({id:"gZoAue",defaultMessage:[{type:0,value:"名称不能重复"}]}));return}e?await E.put("/storage",n):await E.post("/storage",n),await we(),c(`/workbench/storage/${n.name}`,{replace:!0}),a("detail",n.name)},[e,a,o,c,m]),y=n=>{P.error(o.formatMessage({id:"7MUg0d",defaultMessage:[{type:0,value:"保存失败！"}]}))},C=async()=>{u(!0);const n=d.getFieldsValue();try{await E.post("/storageClient/ping",n),P.success(o.formatMessage({id:"JDIfhr",defaultMessage:[{type:0,value:"连接成功"}]}))}catch{}u(!1)};return t.jsxs("div",{className:`${M["form-contain"]} flex`,children:[t.jsxs("div",{className:"flex-1",children:[s&&t.jsx("div",{className:"-mt-4 pb-4",children:t.jsx(Re,{className:"w-full",message:t.jsx($,{id:"p7ywbO",defaultMessage:[{type:0,value:"配置信息有误，无法连接，请修改后再试"}]}),type:"error"})}),t.jsxs(I,{form:d,name:"basic",labelCol:{span:7},wrapperCol:{span:17},onFinish:v,onFinishFailed:y,autoComplete:"off",validateTrigger:"onBlur",className:"ml-3",initialValues:{enabled:!0,...e},children:[t.jsx(I.Item,{name:"enabled",hidden:!0,valuePropName:"checked",children:t.jsx(H,{defaultChecked:!0})}),t.jsx(I.Item,{label:o.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"名称"}]}),rules:[{required:!0,message:o.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"请输入名称"}]})},...r.name],name:"name",children:t.jsx(Me,{disabled:!!(e!=null&&e.name),placeholder:o.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"请输入"}]})})}),t.jsx(k,{formItemProps:{name:"endpoint",label:o.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"服务地址"}]})},required:!0,inputProps:{addonBefore:"http(s)://"}}),t.jsx(k,{formItemProps:{name:"accessKeyID",label:"App ID"},required:!0}),t.jsx(k,{formItemProps:{name:"secretAccessKey",label:"App Secret"},required:!0}),t.jsx(k,{formItemProps:{name:"bucketLocation",label:o.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"区域"}]})},required:!0}),t.jsx(k,{formItemProps:{name:"bucketName",label:o.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"桶名称"}]})},required:!0}),t.jsx(I.Item,{label:o.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"开启SSL"}]}),style:{marginTop:"29px"},name:"useSSL",valuePropName:"checked",children:t.jsx(H,{className:M["switch-set-btn"],size:"small"})}),t.jsxs(I.Item,{wrapperCol:{offset:7,span:17},children:[t.jsx(w,{className:"btn-cancel",onClick:()=>{if(!(e!=null&&e.name)){c(-1);return}a("detail",e==null?void 0:e.name)},children:t.jsx("span",{children:o.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"取消"}]})})}),t.jsx(w,{className:"ml-4 btn-test",onClick:()=>C(),loading:p,children:t.jsx($,{id:"mPsm6o",defaultMessage:[{type:0,value:"测试"}]})}),t.jsx(w,{loading:x,className:"ml-4 btn-save",onClick:()=>d.submit(),children:t.jsx($,{id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]})})]})]})]}),t.jsxs("div",{className:`w-2/5 ${M.supportList}`,children:[t.jsx("div",{className:"title",children:o.formatMessage({id:"DzVs1L",defaultMessage:[{type:0,value:"我们支持"}]})}),Ze.map((n,h)=>t.jsx("a",{className:M.supportItem,href:n.link,target:"_blank",rel:"noreferrer",children:t.jsx("img",{src:n.img,alt:"",className:"w-40"})},h))]})]})}function Je({content:e,showType:s,showErr:o}){const r=F(),{handleSwitch:a}=l.useContext(B);return t.jsxs("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[t.jsxs("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[t.jsx("img",{src:Ve,className:"h-14px mr-1.5 w-14px",alt:"文件"}),(e==null?void 0:e.name)||r.formatMessage({id:"32k+gD",defaultMessage:[{type:0,value:"创建文件存储"}]}),t.jsx("div",{className:"flex-1"}),s==="detail"?t.jsx(t.Fragment,{children:t.jsx(w,{className:"btn-save  ml-4 mr-11",onClick:()=>a("form",e==null?void 0:e.name),children:t.jsx($,{id:"CLqPBU",defaultMessage:[{type:0,value:"编辑"}]})})}):null]}),t.jsx("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 px-8 pt-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:s==="detail"?t.jsx(Ue,{content:e}):s==="form"?t.jsx(Ye,{content:e,showErr:o}):""})]})}function vs(){const{name:e}=$e(),[s,o]=q("detail"),[r,a]=l.useState(),[c,d]=l.useState(!1);l.useEffect(()=>{if(e==="new"){o("form"),a(void 0),d(!1);return}else e===sessionStorage.getItem("storageError")?(sessionStorage.removeItem("storageError"),d(!0),o("form")):(d(!1),o("detail"))},[e,o]),l.useEffect(()=>{s==="detail"&&c&&d(!1),e!=="new"&&E.get(`/storage/${e}`).then(u=>{a(u)})},[e,c,s]);function p(u,m){o(u)}return t.jsx(t.Fragment,{children:t.jsx(B.Provider,{value:{handleSwitch:p},children:t.jsx(Je,{showType:s,content:r,showErr:c})})})}export{vs as default};
