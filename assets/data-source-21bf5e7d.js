import{u as h,r as o,X as p,a5 as w,j as c,a6 as x,ak as g}from"./index-8780653b.js";import{i as v}from"./use-immer.module-ce0f4a1e.js";import{D,a as k}from"./datasource-context-a3ee9a62.js";import{W as j}from"./workbenchContext-e7b3db2b.js";function C(e,t){switch(t.type){case"fetched":return t.data;case"selected":return e;case"added":return[...e,t.data];case"changed":return e.map(n=>n.name===t.data.name?t.data:n);case"deleted":return e.filter(n=>n.name!==t.data.name);default:return e}}function P(){const e=h();o.useContext(j);const[t,n]=o.useReducer(C,[]),[i,u]=o.useState(),{name:a}=p(),[f,s]=v("detail"),d=w();o.useEffect(()=>{if(a==="create"){i||e("/workbench/data-source/new",{replace:!0});return}if(a==="new"){u(void 0);return}s("detail")},[a]),o.useEffect(()=>{a!=="create"&&a!=="new"&&(s("detail"),u(d==null?void 0:d.find(r=>r.name===a)))},[d,a]);const m=(r,l,S)=>{location.pathname==="/workbench/data-source/create"?e("/workbench/data-source/new",{replace:!0}):s(r)};return c.jsx(c.Fragment,{children:c.jsx(D.Provider,{value:n,children:c.jsx(k.Provider,{value:{showType:f,content:i,handleToggleDesigner:m,handleSave:r=>{const l={...i,...r};x(),u(l),s("detail"),e(`/workbench/data-source/${l.name}`)},handleCreate:r=>{s("form"),u(r),e("/workbench/data-source/create")}},children:c.jsx(g,{})})})})}export{P as default};
