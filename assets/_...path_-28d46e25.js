import{aB as X,K as G,r as M,X as Z,aS as Y,C as ee,ae as re,k as N,j as u,T as te,ax as ne,ad as P,Q as C,ag as x,au as b,V as q}from"./index-c082ee01.js";import{c as $}from"./index-d2a993c8.js";import{J as D}from"./index-299e0913.js";import{i as ie}from"./index-654d8384.js";import{G as ae}from"./globalContext-cfd99866.js";import{u as le}from"./variable-e4136148.js";import{B as L}from"./Breadcrumb-1c108b8b.js";import{S as U}from"./index-0648a755.js";import{I as se}from"./index-f949a94c.js";import{T as oe}from"./Table-c84828cb.js";import{S as ue}from"./index-65909486.js";import"./common-7ac8785d.js";import"./DownOutlined-c4d26d52.js";import"./index-68a041d2.js";import"./LeftOutlined-1247d3c6.js";import"./PurePanel-92d18808.js";import"./index-3572d1d0.js";import"./index-ea751460.js";import"./addEventListener-e21f6df2.js";import"./useShowArrow-545d66c2.js";import"./index-403df20a.js";import"./conductUtil-157a2da1.js";import"./index-7a6b6ac3.js";import"./index-fe2a4b61.js";import"./useBreakpoint-e763fd9c.js";import"./useForceUpdate-a1e12dd7.js";import"./index-abdff8d3.js";function j(e){return e<10?"0"+e:e}function fe(e,r,t,i){var n=t?"":e.getUTCFullYear()+"-"+j(e.getUTCMonth()+1)+"-"+j(e.getUTCDate());return r||(n+="T"+j(e.getUTCHours())+":"+j(e.getUTCMinutes())+":"+j(e.getUTCSeconds())+(i?"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5):"")+"Z"),n}function K(e,r){return r>e.length?e.repeat(Math.trunc(r/e.length)+1).substring(0,r):e}function R(...e){const r=t=>t&&typeof t=="object";return e.reduce((t,i)=>(Object.keys(i).forEach(n=>{const a=t[n],l=i[n];r(a)&&r(l)?t[n]=R(a,l):t[n]=l}),t),Array.isArray(e[e.length-1])?[]:{})}function pe(e){var r=ce(e),t=me(r,r,r,r),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{var a=t()*16%16|0;return(n=="x"?a:a&3|8).toString(16)});return i}function k(e){return{value:e==="object"?{}:e==="array"?[]:void 0}}function S(e,r){r&&e.pop()}function ce(e){var r=0;if(e.length==0)return r;for(var t=0;t<e.length;t++){var i=e.charCodeAt(t);r=(r<<5)-r+i,r=r&r}return r}function me(e,r,t,i){return function(){e|=0,r|=0,t|=0,i|=0;var n=e-(r<<27|r>>>5)|0;return e=r^(t<<17|t>>>15),r=t+i|0,t=i+n|0,i=e+n|0,(i>>>0)/4294967296}}function de(e,r,t,i,n){let a=g(e,t,i);const l=[];for(let o of r){const{type:p,readOnly:m,writeOnly:d,value:s}=g({type:a.type,...o},t,i,n);a.type&&p&&p!==a.type&&(console.warn("allOf: schemas with different types can't be merged"),a.type=p),a.type=a.type||p,a.readOnly=a.readOnly||m,a.writeOnly=a.writeOnly||d,s!=null&&l.push(s)}if(a.type==="object")return a.value=R(a.value||{},...l.filter(o=>typeof o=="object")),a;{a.type==="array"&&(t.quiet||console.warn('JSON Schema Sampler: found allOf with "array" type. Result may be incorrect'));const o=l[l.length-1];return a.value=o??a.value,a}}const _={multipleOf:"number",maximum:"number",exclusiveMaximum:"number",minimum:"number",exclusiveMinimum:"number",maxLength:"string",minLength:"string",pattern:"string",items:"array",maxItems:"array",minItems:"array",uniqueItems:"array",additionalItems:"array",maxProperties:"object",minProperties:"object",required:"object",additionalProperties:"object",properties:"object",patternProperties:"object",dependencies:"object"};function A(e){if(e.type!==void 0)return Array.isArray(e.type)?e.type.length===0?null:e.type[0]:e.type;const r=Object.keys(_);for(var t=0;t<r.length;t++){let i=r[t],n=_[i];if(e[i]!==void 0)return n}return null}var ye=Object.prototype.hasOwnProperty,ge=Object.prototype.toString,ve=function(r,t,i){if(ge.call(t)!=="[object Function]")throw new TypeError("iterator must be a function");var n=r.length;if(n===+n)for(var a=0;a<n;a++)t.call(i,r[a],a,r);else for(var l in r)ye.call(r,l)&&t.call(i,r[l],l,r)},xe=ve,he=f;function f(e,r,t){if(arguments.length===3)return f.set(e,r,t);if(arguments.length===2)return f.get(e,r);var i=f.bind(f,e);for(var n in f)f.hasOwnProperty(n)&&(i[n]=f[n].bind(i,e));return i}f.get=function(r,t){for(var i=Array.isArray(t)?t:f.parse(t),n=0;n<i.length;++n){var a=i[n];if(!(typeof r=="object"&&a in r))throw new Error("Invalid reference token: "+a);r=r[a]}return r};f.set=function(r,t,i){var n=Array.isArray(t)?t:f.parse(t),a=n[0];if(n.length===0)throw Error("Can not set the root object");for(var l=0;l<n.length-1;++l){var o=n[l];typeof o!="string"&&typeof o!="number"&&(o=String(o)),!(o==="__proto__"||o==="constructor"||o==="prototype")&&(o==="-"&&Array.isArray(r)&&(o=r.length),a=n[l+1],o in r||(a.match(/^(\d+|-)$/)?r[o]=[]:r[o]={}),r=r[o])}return a==="-"&&Array.isArray(r)&&(a=r.length),r[a]=i,this};f.remove=function(e,r){var t=Array.isArray(r)?r:f.parse(r),i=t[t.length-1];if(i===void 0)throw new Error('Invalid JSON pointer for remove: "'+r+'"');var n=f.get(e,t.slice(0,-1));if(Array.isArray(n)){var a=+i;if(i===""&&isNaN(a))throw new Error('Invalid array index: "'+i+'"');Array.prototype.splice.call(n,a,1)}else delete n[i]};f.dict=function(r,t){var i={};return f.walk(r,function(n,a){i[a]=n},t),i};f.walk=function(r,t,i){var n=[];i=i||function(a){var l=Object.prototype.toString.call(a);return l==="[object Object]"||l==="[object Array]"},function a(l){xe(l,function(o,p){n.push(String(p)),i(o)?a(o):t(o,f.compile(n)),n.pop()})}(r)};f.has=function(r,t){try{f.get(r,t)}catch{return!1}return!0};f.escape=function(r){return r.toString().replace(/~/g,"~0").replace(/\//g,"~1")};f.unescape=function(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")};f.parse=function(r){if(r==="")return[];if(r.charAt(0)!=="/")throw new Error("Invalid JSON pointer: "+r);return r.substring(1).split(/\//).map(f.unescape)};f.compile=function(r){return r.length===0?"":"/"+r.map(f.escape).join("/")};const Se=X(he);let T={},v=[];function we(){T={},v=[]}function I(e){Error.call(this,e)}I.prototype=Object.create(Error.prototype);I.prototype.constructor=I;function g(e,r,t,i){if(r.ticks-=1,r.ticks===0)throw new I(`Schema size exceeded: over ${r.startingTicks} properties. For more info, visit https://docs.stoplight.io/docs/platform/zumkfdc16oypw-json-schema-editor#generate-examples`);if(v.includes(e))return k(A(e));if(v.push(e),i&&i.depth>r.maxSampleDepth)return S(v,i),k(A(e));if(e.$ref){let l=decodeURIComponent(e.$ref);l.startsWith("#")&&(l=l.substring(1));const o=Se.get(t,l);let p;if(T[l]!==!0)T[l]=!0,p=g(o,r,t,i),T[l]=!1;else{const m=A(o);p=k(m)}return S(v,i),p}if(e.example!==void 0)return S(v,i),{value:e.example,readOnly:e.readOnly,writeOnly:e.writeOnly,type:e.type};if(e.allOf!==void 0)return S(v,i),de({...e,allOf:void 0},e.allOf,r,t,i);if(e.oneOf&&e.oneOf.length)return e.anyOf&&(r.quiet||console.warn("oneOf and anyOf are not supported on the same level. Skipping anyOf")),S(v,i),g(e.oneOf[0],r,t,i);if(e.anyOf&&e.anyOf.length)return S(v,i),g(e.anyOf[0],r,t,i);if(e.if&&e.then)return g(R(e.if,e.then),r,t,i);let n=null,a=null;if(e.default!==void 0)n=e.default;else if(e.const!==void 0)n=e.const;else if(e.enum!==void 0&&e.enum.length)n=e.enum[0];else if(e.examples!==void 0&&e.examples.length)n=e.examples[0];else{a=e.type,Array.isArray(a)&&e.type.length>0&&(a=e.type[0]),a||(a=A(e));let l=B[a];l&&(n=l(e,r,t,i))}return S(v,i),{value:n,readOnly:e.readOnly,writeOnly:e.writeOnly,type:a}}function Oe(e,r={},t,i){const n=i&&i.depth||1;let a=Math.min("maxItems"in e?e.maxItems:1/0,e.minItems||1);const l=e.items||e.contains;Array.isArray(l)&&(a=Math.max(a,l.length));let o=m=>Array.isArray(e.items)?l[m]||{}:l||{},p=[];if(!l)return p;for(let m=0;m<a;m++){let d=o(m),{value:s}=g(d,r,t,{depth:n+1});p.push(s)}return p}function Me(e){return!0}function V(e){if("minimum"in e)return e.minimum;let r=0;return"exclusiveMinimum"in e?(r=e.exclusiveMinimum+1,r===e.exclusiveMaximum&&(r=(r+e.exclusiveMaximum-1)/2)):"exclusiveMaximum"in e?r=e.exclusiveMaximum-1:"maximum"in e&&(r=e.maximum),r}function be(e,r={},t,i){let n={};const a=i&&i.depth||1;if(e&&typeof e.properties=="object"){let o=(Array.isArray(e.required)?e.required:[]).reduce((p,m)=>(p[m]=!0,p),{});Object.keys(e.properties).forEach(p=>{if(r.skipNonRequired&&!o.hasOwnProperty(p))return;const m=g(e.properties[p],r,t,{propertyName:p,depth:a+1});r.skipReadOnly&&m.readOnly||r.skipWriteOnly&&m.writeOnly||(n[p]=m.value)})}return e&&typeof e.additionalProperties=="object"&&(n.property1=g(e.additionalProperties,r,t,{depth:a+1}).value,n.property2=g(e.additionalProperties,r,t,{depth:a+1}).value),n}const je="qwerty!@#$%^123456";function Ae(){return"user@example.com"}function Te(){return"пользователь@пример.ру"}function Ie(e,r){let t="pa$$word";return e>t.length&&(t+="_",t+=K(je,e-t.length).substring(0,e-t.length)),t}function F({min:e,max:r,omitTime:t,omitDate:i}){let n=fe(new Date("2019-08-24T14:15:22.123Z"),t,i,!1);return n.length<e&&console.warn(`Using minLength = ${e} is incorrect with format "date-time"`),r&&n.length>r&&console.warn(`Using maxLength = ${r} is incorrect with format "date-time"`),n}function Ne(e,r){return F({min:e,max:r,omitTime:!1,omitDate:!1})}function Pe(e,r){return F({min:e,max:r,omitTime:!0,omitDate:!1})}function Ce(e,r){return F({min:e,max:r,omitTime:!1,omitDate:!0}).slice(1)}function z(e,r){let t=K("string",e);return r&&t.length>r&&(t=t.substring(0,r)),t}function qe(){return"192.168.0.1"}function $e(){return"2001:0db8:85a3:0000:0000:8a2e:0370:7334"}function ke(){return"example.com"}function Ee(){return"пример.ру"}function Re(){return"http://example.com"}function Fe(){return"../dictionary"}function Je(){return"http://example.com/{endpoint}"}function De(){return"http://пример.ру"}function Le(){return"../словарь"}function Ue(e,r,t){return pe(t||"id")}function _e(){return"/json/pointer"}function Ke(){return"1/relative/json/pointer"}function Ve(){return"/regex/"}const ze={email:Ae,"idn-email":Te,password:Ie,"date-time":Ne,date:Pe,time:Ce,ipv4:qe,ipv6:$e,hostname:ke,"idn-hostname":Ee,iri:De,"iri-reference":Le,uri:Re,"uri-reference":Fe,"uri-template":Je,uuid:Ue,default:z,"json-pointer":_e,"relative-json-pointer":Ke,regex:Ve};function Be(e,r,t,i){let n=e.format||"default",a=ze[n]||z,l=i&&i.propertyName;return a(e.minLength|0,e.maxLength,l)}var B={};const E={skipReadOnly:!1,maxSampleDepth:15,ticks:1e3};function He(e,r,t=e){E.startingTicks=E.ticks;let i=Object.assign({},E,r);return we(),g(e,i,t).value}function w(e,r){B[e]=r}w("array",Oe);w("boolean",Me);w("integer",V);w("number",V);w("object",be);w("string",Be);const wr=()=>{const e=G(),[r,t]=M.useState(!1),n=Z()["*"],a=n==null?void 0:n.startsWith("proxy"),{roles:l}=Y(),{vscode:o}=M.useContext(ae),{globalSetting:p}=M.useContext(ee),{getConfigurationValue:m}=le(),{data:d}=re("/sdk/enabledServer",N.get),[s,J]=M.useState(null),H=()=>{o.show(`${d==null?void 0:d.outputPath}/${n}${d==null?void 0:d.extension}`)},W=()=>{var c;let y=`${m(p.nodeOptions.publicNodeUrl)??""}/operations/${n}`;if(!y){q.error(e.formatMessage({id:"p/HR+X",defaultMessage:[{type:0,value:"接口异常"}]}));return}if(a)$(y);else{const h=s!=null&&s.variablesSchema?He(JSON.parse(s.variablesSchema.replace(/\$defs/,"definitions"))):null;if((s==null?void 0:s.operationType)===b.Mutation)$(`curl ${y} \\
  -X POST \\
  -H 'Content-Type: application/json' \\
  --data-raw '${JSON.stringify(h)}' \\
  --compressed`);else{const O=[];h&&O.push(`wg_variables=${JSON.stringify(h)}`),(s==null?void 0:s.operationType)===b.Subscription&&O.push("wg_sse=true"),(c=s==null?void 0:s.liveQueryConfig)!=null&&c.enabled&&(s==null?void 0:s.operationType)===b.Query&&O.push("wg_live=true"),O.length&&(y+="?"+O.join("&")),$(y)}}q.success(e.formatMessage({id:"WtlUhL",defaultMessage:[{type:0,value:"URL 地址已复制"}]}))},Q=async y=>{const c={...s,...y};try{await N.post(`/operation/${n}`,c),J(c),q.success(e.formatMessage({id:"jhfb/7",defaultMessage:[{type:0,value:"保存成功"}]}))}catch{}};return M.useEffect(()=>{t(!1),d!=null&&d.outputPath&&N.get(`/vscode/readFile?uri=${d.outputPath}/${n}.json`).then(y=>{var h;const c=(h=y.authorizationConfig)==null?void 0:h.roleConfig;c&&(c.denyMatchAll||(c.denyMatchAll=void 0),c.denyMatchAny||(c.denyMatchAny=void 0),c.requireMatchAll||(c.requireMatchAll=void 0),c.requireMatchAny||(c.requireMatchAny=void 0)),J(y),t(!0)})},[d==null?void 0:d.outputPath,n]),u.jsxs("div",{className:"h-full flex flex-col",children:[u.jsxs("div",{className:"flex items-center bg-white mb-3 px-5 py-3",children:[u.jsx(L,{children:n==null?void 0:n.split("/").map((y,c)=>u.jsx(L.Item,{children:y},c))}),u.jsx(te,{title:e.formatMessage({id:"MtdXBS",defaultMessage:[{type:0,value:"复制接口URL地址"}]}),children:u.jsx(ne,{className:"cursor-pointer ml-8 text-[#6F6F6F]",onClick:W})}),u.jsx(P,{className:"ml-auto",type:"primary",onClick:H,children:u.jsx(C,{id:"SOBHgO",defaultMessage:[{type:0,value:"编辑代码"}]})})]}),u.jsx("div",{className:"px-3 flex-1 overflow-y-auto",children:u.jsx("div",{className:"p-5 bg-white rounded shadow",children:r&&u.jsxs(x,{className:"common-form",labelCol:{span:4},wrapperCol:{span:16},onFinish:Q,initialValues:s??{},children:[!a&&u.jsx(x.Item,{label:e.formatMessage({id:"vrfpyb",defaultMessage:[{type:0,value:"入参定义"}]}),name:"variablesSchema",children:u.jsx(D,{data:JSON.parse((s==null?void 0:s.variablesSchema)||"{}"),collapsed:1})}),!a&&u.jsx(x.Item,{label:e.formatMessage({id:"vVk87K",defaultMessage:[{type:0,value:"出参定义"}]}),name:"responseSchema",children:u.jsx(D,{data:JSON.parse((s==null?void 0:s.responseSchema)||"{}"),collapsed:1})}),u.jsx(x.Item,{label:e.formatMessage({id:"slEoee",defaultMessage:[{type:0,value:"是否需要认证"}]}),name:["authenticationConfig","authRequired"],valuePropName:"checked",children:u.jsx(U,{})}),!a&&(s==null?void 0:s.operationType)!==b.Mutation&&u.jsx(x.Item,{label:e.formatMessage({id:"2DHz6I",defaultMessage:[{type:0,value:"实时查询"}]}),name:["liveQueryConfig","enabled"],valuePropName:"checked",children:u.jsx(U,{})}),!a&&(s==null?void 0:s.operationType)!==b.Mutation&&u.jsx(x.Item,{label:e.formatMessage({id:"Aj9NiL",defaultMessage:[{type:0,value:"轮询间隔"}]}),name:["liveQueryConfig","pollingIntervalSeconds"],children:u.jsx(se,{addonAfter:"s"})}),u.jsx(x.Item,{label:e.formatMessage({id:"HKRFyb",defaultMessage:[{type:0,value:"角色设置"}]}),children:u.jsx(oe,{rowKey:"name",className:"mt-2",pagination:!1,columns:[{title:e.formatMessage({id:"1hWTAI",defaultMessage:[{type:0,value:"策略"}]}),dataIndex:"name",width:"200px",render:(y,c)=>u.jsxs("div",{className:"flex flex-col items-center justify-center",children:[u.jsx("div",{className:"mb-2",children:y}),ie[y]]})},{title:e.formatMessage({id:"zbqD5q",defaultMessage:[{type:0,value:"值"}]}),key:"value",dataIndex:"name",render:(y,c)=>u.jsx(x.Item,{name:["authorizationConfig","roleConfig",y],children:u.jsx(ue,{mode:"multiple",className:"min-w-full",placeholder:e.formatMessage({id:"0pf8N0",defaultMessage:[{type:0,value:"请选择关联的角色"}]}),options:l,fieldNames:{label:"code",value:"code"}})})}],dataSource:[{name:"requireMatchAll"},{name:"requireMatchAny"},{name:"denyMatchAll"},{name:"denyMatchAny"}]})}),u.jsxs(x.Item,{label:" ",colon:!1,children:[u.jsx(P,{className:"btn-cancel",children:u.jsx(C,{id:"r2dEd/",defaultMessage:[{type:0,value:"重置"}]})}),u.jsx(P,{className:"btn-save ml-4",htmlType:"submit",children:u.jsx(C,{id:"b5l2vN",defaultMessage:[{type:0,value:"保存"}]})})]})]})})})]},n)};export{wr as default};
