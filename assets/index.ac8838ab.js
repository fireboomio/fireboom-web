import{r,d as k,j as e,F as N,f as i,aH as P,bS as z,B as y,g as m,u as O,Z as u,I as h,m as D,c as x,b4 as L}from"./index.e5e6c754.js";import{i as _}from"./use-immer.module.1d9a0526.js";import{D as v}from"./index.a76d6f2a.js";import{A as V}from"./index.9bef8de7.js";import"./iconUtil.31c13224.js";import"./index.5e1fa168.js";import{S as W}from"./index.6926b693.js";import{S as F}from"./index.daad23d2.js";import{u as U}from"./storage.aee759da.js";import{W as Z}from"./workbenchContext.a6b76e3b.js";import{u as J}from"./useEnvOptions.b8beba26.js";import"./getDataOrAriaProps.e48b8c96.js";import"./KeyCode.9c493596.js";import"./pickAttrs.c5bbb5fc.js";import"./Overflow.321ca619.js";import"./DownOutlined.75881d1e.js";import"./index.esm.0df65c6e.js";import"./index.esm.e5edd667.js";r.exports.createContext([]);r.exports.createContext({});r.exports.createContext({});const C=r.exports.createContext({}),S={"save-btn":"_save-btn_dfcko_1","center-btn":"_center-btn_dfcko_19","switch-check-btn":"_switch-check-btn_dfcko_27","ssl-open-btn":"_ssl-open-btn_dfcko_34","ssl-close-btn":"_ssl-close-btn_dfcko_47","switch-set-btn":"_switch-set-btn_dfcko_64","form-contain":"_form-contain_dfcko_71","panel-style":"_panel-style_dfcko_74","form-item-icon":"_form-item-icon_dfcko_81"};function Q({content:s}){var M,n,d,o,g;const l=k(),[a,c]=_(!1),t=r.exports.useMemo(()=>s==null?void 0:s.config,[s==null?void 0:s.config]);return e(N,{children:e("div",{className:"pr-110px",children:i(v,{bordered:!0,column:1,size:"small",children:[e(v.Item,{label:l.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]}),children:s==null?void 0:s.name}),i(v.Item,{label:l.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"\u670D\u52A1\u5730\u5740"}]}),children:["http(s)://",t==null?void 0:t.endPoint]}),i(v.Item,{label:l.formatMessage({id:"WfVg3t",defaultMessage:[{type:0,value:"APP ID"}]}),children:[(M=t==null?void 0:t.accessKeyID)==null?void 0:M.val," "]}),e(v.Item,{label:l.formatMessage({id:"FYqDZK",defaultMessage:[{type:0,value:"APP Secret"}]}),children:e("span",{children:a?i("div",{children:[(d=(n=t==null?void 0:t.secretAccessKey)==null?void 0:n.val)!=null?d:"",e(P,{className:"cursor-pointer ml-6",onClick:()=>c(!a)})]}):i("div",{children:[((g=(o=t==null?void 0:t.secretAccessKey)==null?void 0:o.val)!=null?g:"").replaceAll(/./g,"*"),e(z,{className:"cursor-pointer ml-6",onClick:()=>c(!a)})]})})}),e(v.Item,{label:l.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"\u533A\u57DF"}]}),children:t==null?void 0:t.bucketLocation}),e(v.Item,{label:l.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"\u6876\u540D\u79F0"}]}),children:t==null?void 0:t.bucketName}),e(v.Item,{label:l.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"\u5F00\u542FSSL"}]}),children:t!=null&&t.useSSL?e(y,{className:S["ssl-open-btn"],children:e(m,{id:"ZUPzqr",defaultMessage:[{type:0,value:"\u5F00\u542F"}]})}):e(y,{className:S["ssl-close-btn"],children:e(m,{id:"47GdDb",defaultMessage:[{type:0,value:"\u5173\u95ED"}]})})})]})})})}function j({content:s,showErr:l}){const a=k(),{handleSwitch:c}=r.exports.useContext(C),t=O(),{onRefreshMenu:M}=r.exports.useContext(Z),n=r.exports.useMemo(()=>s==null?void 0:s.config,[s]),[d]=u.useForm(),o=u.useWatch(["accessKeyID","kind"],d),g=u.useWatch(["secretAccessKey","kind"],d),[I,E]=r.exports.useState(!1),w=J(),{data:A}=U();r.exports.useEffect(()=>{d.resetFields()},[s]);const q=async p=>{if(A!=null&&A.find(B=>B.name===p.name&&B.id!==(s==null?void 0:s.id))){D.error(a.formatMessage({id:"gZoAue",defaultMessage:[{type:0,value:"\u540D\u79F0\u4E0D\u80FD\u91CD\u590D"}]}));return}const f={name:p.name,config:p,useSSL:!0};let b;s?b=await x.put("/storageBucket ",{...f,id:s.id}):b=await x.post("/storageBucket ",f),t(`/workbench/storage/${b.id}`,{replace:!0}),M("storage"),c("detail",b.id)},K=p=>{D.error(a.formatMessage({id:"7MUg0d",defaultMessage:[{type:0,value:"\u4FDD\u5B58\u5931\u8D25\uFF01"}]}))},T=()=>{E(!0);const p=d.getFieldsValue();x.post("/s3Upload/checkConn",{config:{...p},name:p.name}).then(f=>{f!=null&&f.status?D.success(a.formatMessage({id:"JDIfhr",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u6210\u529F"}]})):D.error((f==null?void 0:f.msg)||a.formatMessage({id:"9yQugt",defaultMessage:[{type:0,value:"\u8FDE\u63A5\u5931\u8D25"}]}))}).finally(()=>{E(!1)})};return i("div",{className:`${S["form-contain"]}`,children:[l&&e("div",{className:"-mt-4 pb-4",children:e(V,{className:"w-full",message:e(m,{id:"p7ywbO",defaultMessage:[{type:0,value:"\u914D\u7F6E\u4FE1\u606F\u6709\u8BEF\uFF0C\u65E0\u6CD5\u8FDE\u63A5\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u8BD5"}]}),type:"error"})}),i(u,{form:d,name:"basic",labelCol:{span:4},wrapperCol:{span:11},onFinish:p=>void q(p),onFinishFailed:K,autoComplete:"off",validateTrigger:"onBlur",className:"ml-3",initialValues:{accessKeyID:{kind:"0"},secretAccessKey:{kind:"0"},...n},children:[e(u.Item,{label:a.formatMessage({id:"ekxzlF",defaultMessage:[{type:0,value:"\u540D\u79F0"}]}),rules:[{required:!0,message:a.formatMessage({id:"7nyFdZ",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u540D\u79F0"}]})}],name:"name",children:e(h,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(u.Item,{label:a.formatMessage({id:"2a+U1g",defaultMessage:[{type:0,value:"\u670D\u52A1\u5730\u5740"}]}),name:"endPoint",rules:[{required:!0,message:a.formatMessage({id:"ig9iLd",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u670D\u52A1\u5730\u5740"}]})}],children:e(h,{addonBefore:"http(s)://",placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(u.Item,{label:"App ID",required:!0,children:i(h.Group,{compact:!0,className:"!flex",children:[e(u.Item,{name:["accessKeyID","kind"],noStyle:!0,children:i(F,{className:"flex-0 w-100px",children:[e(F.Option,{value:"0",children:e(m,{id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})}),e(F.Option,{value:"1",children:e(m,{id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})})]})}),e(u.Item,{name:["accessKeyID","val"],noStyle:!0,rules:[{required:!0,message:a.formatMessage({id:"Z4d9SJ",defaultMessage:[{type:0,value:"App ID\u4E0D\u80FD\u4E3A\u7A7A"}]})}],children:o==="0"?e(h,{className:"flex-1",placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(F,{className:"flex-1",options:w})})]})}),e(u.Item,{label:"App Secret",required:!0,children:i(h.Group,{compact:!0,className:"!flex",children:[e(u.Item,{name:["secretAccessKey","kind"],noStyle:!0,children:i(F,{className:"flex-0 w-100px",children:[e(F.Option,{value:"0",children:e(m,{id:"zbqD5q",defaultMessage:[{type:0,value:"\u503C"}]})}),e(F.Option,{value:"1",children:e(m,{id:"txDRJz",defaultMessage:[{type:0,value:"\u73AF\u5883\u53D8\u91CF"}]})})]})}),e(u.Item,{name:["secretAccessKey","val"],noStyle:!0,rules:[{required:!0,message:a.formatMessage({id:"wCsUWB",defaultMessage:[{type:0,value:"App Secret\u4E0D\u80FD\u4E3A\u7A7A"}]})}],children:g==="0"?e(h,{className:"flex-1",placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})}):e(F,{className:"flex-1",options:w})})]})}),e(u.Item,{label:a.formatMessage({id:"aqQg0p",defaultMessage:[{type:0,value:"\u533A\u57DF"}]}),name:"bucketLocation",rules:[{required:!0,message:a.formatMessage({id:"uOSn0p",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165\u533A\u57DF"}]})}],children:e(h,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(u.Item,{label:a.formatMessage({id:"FpWcg2",defaultMessage:[{type:0,value:"\u6876\u540D\u79F0"}]}),name:"bucketName",rules:[{required:!0,message:a.formatMessage({id:"fJh8DQ",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165bucketName"}]})}],children:e(h,{placeholder:a.formatMessage({id:"vr5TVT",defaultMessage:[{type:0,value:"\u8BF7\u8F93\u5165"}]})})}),e(u.Item,{label:a.formatMessage({id:"PbEf10",defaultMessage:[{type:0,value:"\u5F00\u542FSSL"}]}),style:{marginTop:"29px"},name:"useSSL",valuePropName:"checked",children:e(W,{className:S["switch-set-btn"],size:"small"})}),i(u.Item,{wrapperCol:{offset:4,span:16},children:[e(y,{className:"btn-cancel",onClick:()=>{if(!(s!=null&&s.id)){t(-1);return}c("detail",s==null?void 0:s.id)},children:e("span",{children:a.formatMessage({id:"2QzYmY",defaultMessage:[{type:0,value:"\u53D6\u6D88"}]})})}),e(y,{className:"ml-4 btn-test",onClick:()=>T(),loading:I,children:e(m,{id:"mPsm6o",defaultMessage:[{type:0,value:"\u6D4B\u8BD5"}]})}),e(y,{className:"ml-4 btn-save",onClick:()=>d.submit(),children:e(m,{id:"b5l2vN",defaultMessage:[{type:0,value:"\u4FDD\u5B58"}]})})]})]})]})}function R({content:s,showType:l,showErr:a}){const c=k(),{handleSwitch:t}=r.exports.useContext(C);return i("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[i("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[e("img",{src:"/assets/ant-tree/file.png",className:"h-14px mr-1.5 w-14px",alt:"\u6587\u4EF6"}),(s==null?void 0:s.name)||c.formatMessage({id:"32k+gD",defaultMessage:[{type:0,value:"\u521B\u5EFA\u6587\u4EF6\u5B58\u50A8"}]}),e("div",{className:"flex-1"}),l==="detail"?e(N,{children:e(y,{className:"btn-save  ml-4 mr-11",onClick:()=>t("form",s==null?void 0:s.id),children:e(m,{id:"CLqPBU",defaultMessage:[{type:0,value:"\u7F16\u8F91"}]})})}):null]}),e("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 px-8 pt-8 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:l==="detail"?e(Q,{content:s}):l==="form"?e(j,{content:s,showErr:a}):""})]})}function pe(){k();const{id:s}=L(),[l,a]=_("detail"),[c,t]=r.exports.useState(),[M,n]=r.exports.useState(!1);r.exports.useEffect(()=>{if(s==="new"){a("form"),t(void 0),n(!1);return}else s===sessionStorage.getItem("storageError")?(sessionStorage.removeItem("storageError"),n(!0),a("form")):(n(!1),a("detail"))},[s]),r.exports.useEffect(()=>{console.log(123123),l==="detail"&&M&&n(!1),s!=="new"&&x.get("/storageBucket").then(o=>{var g;t((g=o==null?void 0:o.filter(I=>I.id===Number(s)))==null?void 0:g[0])})},[l]);function d(o,g){a(o)}return e(N,{children:e(C.Provider,{value:{handleSwitch:d},children:e(R,{showType:l,content:c,showErr:M})})})}export{pe as default};
